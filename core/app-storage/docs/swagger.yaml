definitions:
  dto.BatchGetUploadTokenReq:
    properties:
      files:
        description: 文件列表（最多100个）
        items:
          $ref: '#/definitions/dto.GetUploadTokenReq'
        maxItems: 100
        minItems: 1
        type: array
      upload_source:
        allOf:
        - $ref: '#/definitions/dto.UploadSource'
        description: ✨ 上传来源：browser（浏览器）或 server（服务端），默认为 browser
    required:
    - files
    type: object
  dto.BatchGetUploadTokenResp:
    properties:
      tokens:
        description: 上传凭证列表
        items:
          $ref: '#/definitions/dto.GetUploadTokenResp'
        type: array
    type: object
  dto.BatchUploadCompleteItem:
    properties:
      content_type:
        description: ✨ 文件类型（上传成功后需要，用于记录）
        type: string
      error:
        description: 错误信息（如果失败）
        type: string
      file_name:
        description: ✨ 文件名（上传成功后需要，用于记录）
        type: string
      file_size:
        description: ✨ 文件大小（上传成功后需要，用于记录）
        type: integer
      hash:
        description: ✨ 文件hash（可选，用于秒传）
        type: string
      key:
        description: 文件 Key
        type: string
      router:
        description: ✨ 函数路径（上传成功后需要，用于记录）
        type: string
      success:
        description: 是否成功
        type: boolean
    required:
    - key
    type: object
  dto.BatchUploadCompleteReq:
    properties:
      items:
        description: 上传结果列表（最多100个）
        items:
          $ref: '#/definitions/dto.BatchUploadCompleteItem'
        maxItems: 100
        minItems: 1
        type: array
    required:
    - items
    type: object
  dto.BatchUploadCompleteResp:
    properties:
      results:
        description: 处理结果列表
        items:
          $ref: '#/definitions/dto.BatchUploadCompleteResult'
        type: array
    type: object
  dto.BatchUploadCompleteResult:
    properties:
      download_url:
        description: ✨ 外部访问的下载地址（前端使用）
        type: string
      error:
        description: 错误信息（如果失败）
        type: string
      hash:
        description: ✨ 文件hash（用于文件缓存去重）
        type: string
      key:
        description: 文件 Key
        type: string
      server_download_url:
        description: ✨ 内部访问的下载地址（服务端使用）
        type: string
      status:
        description: 状态：completed/failed
        type: string
    type: object
  dto.DeleteFilesByRouterReq:
    properties:
      router:
        description: 函数路径
        type: string
    required:
    - router
    type: object
  dto.DeleteFilesByRouterResp:
    properties:
      deleted_count:
        type: integer
      router:
        type: string
    type: object
  dto.GetFileInfoResp:
    properties:
      content_type:
        type: string
      etag:
        type: string
      key:
        type: string
      last_modified:
        type: string
      size:
        type: integer
    type: object
  dto.GetStorageStatsResp:
    properties:
      file_count:
        type: integer
      router:
        type: string
      size_human:
        description: 人类可读的大小，例如：10.5 MB
        type: string
      total_size:
        type: integer
    type: object
  dto.GetUploadTokenReq:
    properties:
      content_type:
        type: string
      file_name:
        type: string
      file_size:
        type: integer
      hash:
        description: 文件 hash（预留，用于秒传）
        type: string
      router:
        description: 函数路径，例如：luobei/test88888/plugins/cashier_desk（可选，未提供时使用默认路由：/{username}/default）
        type: string
      upload_source:
        allOf:
        - $ref: '#/definitions/dto.UploadSource'
        description: ✨ 上传来源：browser（浏览器）或 server（服务端），默认为 browser
    required:
    - file_name
    type: object
  dto.GetUploadTokenResp:
    properties:
      bucket:
        description: 存储桶
        type: string
      cdn_domain:
        description: CDN 域名（可选，用于下载访问）
        type: string
      download_url:
        description: ✨ 预期的下载地址（在获取token时预先构建，上传成功后可直接使用）
        type: string
      expire:
        description: 过期时间
        type: string
      form_data:
        additionalProperties:
          type: string
        description: 表单上传（七牛云、又拍云等）
        type: object
      headers:
        additionalProperties:
          type: string
        description: 请求头
        type: object
      key:
        description: 通用字段
        type: string
      method:
        allOf:
        - $ref: '#/definitions/dto.UploadMethod'
        description: 上传方式 ✨ 新增
      post_url:
        description: POST 地址
        type: string
      sdk_config:
        additionalProperties: true
        description: SDK 上传（特殊云存储）
        type: object
      server_download_url:
        description: ✨ 内部访问的下载地址（服务端/SDK使用）
        type: string
      server_url:
        description: ✨ 内部访问的预签名 URL（服务端/SDK使用）
        type: string
      storage:
        description: ✨ 存储引擎（minio/qiniu/tencentcos/aliyunoss/awss3）
        type: string
      upload_domain:
        description: 上传完整域名（例如：http://localhost:9000，用于日志、调试）
        type: string
      upload_host:
        description: 上传域名信息 ✨ 新增
        type: string
      url:
        description: 预签名 URL 上传（MinIO、COS、OSS、S3）
        type: string
      username:
        description: ✨ 当前登录用户的用户名
        type: string
    type: object
  dto.ListFilesResp:
    properties:
      count:
        type: integer
      files:
        items:
          type: string
        type: array
      router:
        type: string
    type: object
  dto.UploadCompleteReq:
    properties:
      content_type:
        description: ✨ 文件类型（上传成功后需要，用于记录）
        type: string
      error:
        description: 错误信息（如果失败）
        type: string
      file_name:
        description: ✨ 文件名（上传成功后需要，用于记录）
        type: string
      file_size:
        description: ✨ 文件大小（上传成功后需要，用于记录）
        type: integer
      hash:
        description: ✨ 文件hash（可选，用于秒传）
        type: string
      key:
        description: 文件 Key
        type: string
      router:
        description: ✨ 函数路径（上传成功后需要，用于记录）
        type: string
      success:
        description: 是否成功
        type: boolean
    required:
    - key
    type: object
  dto.UploadCompleteResp:
    properties:
      download_url:
        description: ✨ 外部访问的下载地址（前端使用）
        type: string
      expire:
        description: 过期时间
        type: string
      message:
        description: 消息
        type: string
      server_download_url:
        description: ✨ 内部访问的下载地址（服务端使用）
        type: string
    type: object
  dto.UploadMethod:
    enum:
    - presigned_url
    - form_upload
    - sdk_upload
    type: string
    x-enum-comments:
      UploadMethodFormUpload: 表单上传（七牛云等）
      UploadMethodPresignedURL: 预签名 URL（标准 S3 协议）
      UploadMethodSDKUpload: SDK 上传（特殊云存储）
    x-enum-descriptions:
    - 预签名 URL（标准 S3 协议）
    - 表单上传（七牛云等）
    - SDK 上传（特殊云存储）
    x-enum-varnames:
    - UploadMethodPresignedURL
    - UploadMethodFormUpload
    - UploadMethodSDKUpload
  dto.UploadSource:
    enum:
    - browser
    - server
    type: string
    x-enum-comments:
      UploadSourceBrowser: 浏览器上传
      UploadSourceServer: 服务端上传（容器内SDK）
    x-enum-descriptions:
    - 浏览器上传
    - 服务端上传（容器内SDK）
    x-enum-varnames:
    - UploadSourceBrowser
    - UploadSourceServer
host: localhost:9092
info:
  contact: {}
  description: AI Agent OS 存储服务 API 文档
  title: AI Agent OS Storage API
  version: "1.0"
paths:
  /api/v1/storage/batch_delete:
    post:
      consumes:
      - application/json
      description: 批量删除某个函数路径下的所有文件（危险操作）
      parameters:
      - description: 删除请求
        in: body
        name: request
        required: true
        schema:
          $ref: '#/definitions/dto.DeleteFilesByRouterReq'
      produces:
      - application/json
      responses:
        "200":
          description: 删除成功
          schema:
            $ref: '#/definitions/dto.DeleteFilesByRouterResp'
        "400":
          description: 请求参数错误
          schema:
            type: string
        "500":
          description: 服务器内部错误
          schema:
            type: string
      summary: 删除函数路径下的所有文件
      tags:
      - 存储管理
  /api/v1/storage/batch_upload_complete:
    post:
      consumes:
      - application/json
      description: 批量通知后端创建上传记录（仅在上传成功时记录）
      parameters:
      - description: 批量上传完成请求
        in: body
        name: request
        required: true
        schema:
          $ref: '#/definitions/dto.BatchUploadCompleteReq'
      produces:
      - application/json
      responses:
        "200":
          description: 通知成功
          schema:
            $ref: '#/definitions/dto.BatchUploadCompleteResp'
        "400":
          description: 请求参数错误
          schema:
            type: string
        "500":
          description: 服务器内部错误
          schema:
            type: string
      summary: 批量上传完成通知
      tags:
      - 存储管理
  /api/v1/storage/batch_upload_token:
    post:
      consumes:
      - application/json
      description: 批量获取多个文件的上传凭证，支持多种存储方式（presigned_url/form_upload/sdk_upload）。如果某个文件未提供
        router，将使用默认路由：/{username}/default
      parameters:
      - description: 批量获取上传凭证请求
        in: body
        name: request
        required: true
        schema:
          $ref: '#/definitions/dto.BatchGetUploadTokenReq'
      produces:
      - application/json
      responses:
        "200":
          description: 获取成功
          schema:
            $ref: '#/definitions/dto.BatchGetUploadTokenResp'
        "400":
          description: 请求参数错误
          schema:
            type: string
        "500":
          description: 服务器内部错误
          schema:
            type: string
      summary: 批量获取上传凭证
      tags:
      - 存储管理
  /api/v1/storage/download/{key}:
    get:
      consumes:
      - application/json
      description: 直接代理下载文件，返回文件流（无需复杂的预签名 URL 参数）
      parameters:
      - description: 文件 Key
        in: path
        name: key
        required: true
        type: string
      produces:
      - application/octet-stream
      responses:
        "200":
          description: 文件内容
          schema:
            type: file
        "400":
          description: 请求参数错误
          schema:
            type: string
        "500":
          description: 服务器内部错误
          schema:
            type: string
      summary: 下载文件
      tags:
      - 存储管理
  /api/v1/storage/files:
    get:
      consumes:
      - application/json
      description: 列举某个函数路径下的所有文件
      parameters:
      - description: 函数路径
        in: query
        name: router
        required: true
        type: string
      produces:
      - application/json
      responses:
        "200":
          description: 获取成功
          schema:
            $ref: '#/definitions/dto.ListFilesResp'
        "400":
          description: 请求参数错误
          schema:
            type: string
        "500":
          description: 服务器内部错误
          schema:
            type: string
      summary: 列举文件
      tags:
      - 存储管理
  /api/v1/storage/files/{key}:
    delete:
      consumes:
      - application/json
      description: 删除存储的文件
      parameters:
      - description: 文件 Key
        in: path
        name: key
        required: true
        type: string
      produces:
      - application/json
      responses:
        "200":
          description: 删除成功
          schema:
            type: string
        "400":
          description: 请求参数错误
          schema:
            type: string
        "500":
          description: 服务器内部错误
          schema:
            type: string
      summary: 删除文件
      tags:
      - 存储管理
  /api/v1/storage/files/{key}/info:
    get:
      consumes:
      - application/json
      description: 获取文件的元数据信息
      parameters:
      - description: 文件 Key
        in: path
        name: key
        required: true
        type: string
      produces:
      - application/json
      responses:
        "200":
          description: 获取成功
          schema:
            $ref: '#/definitions/dto.GetFileInfoResp'
        "400":
          description: 请求参数错误
          schema:
            type: string
        "500":
          description: 服务器内部错误
          schema:
            type: string
      summary: 获取文件信息
      tags:
      - 存储管理
  /api/v1/storage/stats:
    get:
      consumes:
      - application/json
      description: 获取某个函数路径下的文件数量和总大小
      parameters:
      - description: 函数路径，例如：luobei/test88888/plugins/cashier_desk
        in: query
        name: router
        required: true
        type: string
      produces:
      - application/json
      responses:
        "200":
          description: 获取成功
          schema:
            $ref: '#/definitions/dto.GetStorageStatsResp'
        "400":
          description: 请求参数错误
          schema:
            type: string
        "500":
          description: 服务器内部错误
          schema:
            type: string
      summary: 获取存储统计信息
      tags:
      - 存储管理
  /api/v1/storage/upload_complete:
    post:
      consumes:
      - application/json
      description: 前端上传完成后，通知后端创建上传记录（仅在上传成功时记录）
      parameters:
      - description: 上传完成请求
        in: body
        name: request
        required: true
        schema:
          $ref: '#/definitions/dto.UploadCompleteReq'
      produces:
      - application/json
      responses:
        "200":
          description: 通知成功
          schema:
            $ref: '#/definitions/dto.UploadCompleteResp'
        "400":
          description: 请求参数错误
          schema:
            type: string
        "500":
          description: 服务器内部错误
          schema:
            type: string
      summary: 上传完成通知
      tags:
      - 存储管理
  /api/v1/storage/upload_token:
    post:
      consumes:
      - application/json
      description: 获取文件上传的预签名 URL，文件将按函数路径分类存储。如果未提供 router，将使用默认路由：/{username}/default
      parameters:
      - description: 获取上传凭证请求
        in: body
        name: request
        required: true
        schema:
          $ref: '#/definitions/dto.GetUploadTokenReq'
      produces:
      - application/json
      responses:
        "200":
          description: 获取成功
          schema:
            $ref: '#/definitions/dto.GetUploadTokenResp'
        "400":
          description: 请求参数错误
          schema:
            type: string
        "500":
          description: 服务器内部错误
          schema:
            type: string
      summary: 获取上传凭证
      tags:
      - 存储管理
securityDefinitions:
  ApiKeyAuth:
    in: header
    name: X-Token
    type: apiKey
swagger: "2.0"
