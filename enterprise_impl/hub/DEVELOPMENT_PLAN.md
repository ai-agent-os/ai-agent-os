# Hub å¼€å‘è®¡åˆ’

## ä¸€ã€é¡¹ç›®æ¦‚è¿°

### 1.1 æ ¸å¿ƒå®šä½

**Hub + OS ä¸€ä½“åŒ–ç”Ÿæ€ç³»ç»Ÿ**ï¼š
- âœ… **Hub**ï¼šåº”ç”¨å¸‚åœºï¼Œå–è½¯ä»¶ã€ä»‹ç»è½¯ä»¶
- âœ… **OS**ï¼šè¿è¡Œå¹³å°ï¼Œå¯ä»¥è¯•ç”¨ã€å…‹éš†ã€è¿è¡Œè½¯ä»¶
- âœ… **äº’é€š**ï¼šHub å’Œ OS ç”¨æˆ·ç³»ç»Ÿå®Œå…¨äº’é€š

### 1.2 å•†ä¸šæ¨¡å¼

**æœåŠ¡è´¹æ¨¡å¼**ï¼š
- âœ… **ä»"å…‹éš†è´¹"åˆ°"æœåŠ¡è´¹"**ï¼šå¼ºè°ƒåç»­æœåŠ¡ï¼Œè€Œä¸æ˜¯è½¯ä»¶æœ¬èº«
- âœ… **ä»£ç å®Œå…¨å¼€æº**ï¼šä»£ç å®Œå…¨å¼€æºï¼Œå¢å¼ºä¿¡ä»»ï¼Œä¿ƒè¿›ä»˜è´¹
- âœ… **æ„é€ è®°å½•å®Œå…¨å¼€æº**ï¼šæ„é€ è®°å½•å®Œå…¨å¼€æºï¼Œå¢å¼ºä¿¡ä»»ï¼Œä¿ƒè¿›ä»˜è´¹
- âœ… **å¼€å‘è€…æ”¶ç›Šåˆ†æˆ**ï¼šå¼€å‘è€… 80%ï¼ŒHub å¹³å° 10%ï¼ŒOS å¹³å° 10%

### 1.3 æ ¸å¿ƒä»·å€¼

**è½¯ä»¶å¯ä»¥æ¨¡ä»¿ï¼Œä½†æœåŠ¡æ— æ³•æ¨¡ä»¿**ï¼š
- âœ… **æŠ€æœ¯æ”¯æŒ**ï¼šæœ‰é—®é¢˜å¯ä»¥éšæ—¶æ‰¾å¼€å‘è€…
- âœ… **éœ€æ±‚è°ƒæ•´**ï¼šå¯ä»¥å¸®ä½ è°ƒæ•´ï¼Œä¾‹å¦‚æ–°å¢å­—æ®µï¼ˆå…è´¹ 3 ä¸ªéœ€æ±‚ï¼‰
- âœ… **æ–‡æ¡£çŸ¥è¯†åº“**ï¼šå…è´¹æ–‡æ¡£çŸ¥è¯†åº“å…±äº«
- âœ… **ç‰ˆæœ¬å‡çº§**ï¼šå¯ä»¥åŒæ­¥å‡çº§æ–°çš„ç‰ˆæœ¬ï¼Œæ— ç¼å‡çº§
- âœ… **ç”Ÿæ€æ”¯æŒ**ï¼šæ— æ³•å¤ç”¨åˆ«äººçš„ç”Ÿæ€
- âœ… **ç¤¾åŒºæ”¯æŒ**ï¼šç¤¾åŒºçš„æ´»è·ƒåº¦

---

## äºŒã€æŠ€æœ¯æ¶æ„

### 2.1 ç³»ç»Ÿæ¶æ„

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    Hub + OS ä¸€ä½“åŒ–ç”Ÿæ€ç³»ç»Ÿ                    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â”‚
                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                    â”‚   API ç½‘å…³         â”‚
                    â”‚  (ç»Ÿä¸€å…¥å£)       â”‚
                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â”‚
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚                                           â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”                      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   Hub å¹³å°     â”‚                      â”‚   OS å¹³å°         â”‚
â”‚  (åº”ç”¨å¸‚åœº)    â”‚                      â”‚  (è¿è¡Œå¹³å°)       â”‚
â”‚                â”‚                      â”‚                   â”‚
â”‚ - åº”ç”¨æµè§ˆ     â”‚                      â”‚ - åº”ç”¨è¿è¡Œ         â”‚
â”‚ - åº”ç”¨ä»‹ç»     â”‚                      â”‚ - åº”ç”¨è¯•ç”¨         â”‚
â”‚ - åº”ç”¨æœç´¢     â”‚                      â”‚ - åº”ç”¨å…‹éš†         â”‚
â”‚ - æœåŠ¡è´¹æ”¯ä»˜   â”‚                      â”‚ - äº‘æ‰˜ç®¡           â”‚
â”‚                â”‚                      â”‚ - ç§æœ‰åŒ–éƒ¨ç½²       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜                      â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜
        â”‚                                           â”‚
        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â”‚
                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                    â”‚   OS (app-server) â”‚
                    â”‚                   â”‚
                    â”‚ - AuthService     â”‚
                    â”‚ - UserService     â”‚
                    â”‚ - ç”¨æˆ·æ•°æ®åº“      â”‚
                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 2.2 ç”¨æˆ·ç³»ç»Ÿäº’é€š

**ç»Ÿä¸€ç”¨æˆ·ç³»ç»Ÿ**ï¼š
- âœ… **å…±äº«ç”¨æˆ·æ•°æ®åº“**ï¼šHub å’Œ OS å…±äº«åŒä¸€ä¸ªç”¨æˆ·æ•°æ®åº“
- âœ… **ç»Ÿä¸€è®¤è¯**ï¼šä½¿ç”¨ç»Ÿä¸€çš„ JWT Token è®¤è¯
- âœ… **å•ç‚¹ç™»å½•**ï¼šHub å’Œ OS ä¹‹é—´å•ç‚¹ç™»å½•ï¼ˆSSOï¼‰

**å®ç°æ–¹å¼**ï¼š
- âœ… **Hub è°ƒç”¨ OS API**ï¼šHub é€šè¿‡ API è°ƒç”¨ app-server çš„ç”¨æˆ·æœåŠ¡
- âœ… **OS ä½¿ç”¨æœ¬åœ°æœåŠ¡**ï¼šOS ç›´æ¥ä½¿ç”¨ app-server çš„ç”¨æˆ·æœåŠ¡

### 2.3 æŠ€æœ¯æ ˆ

**åç«¯**ï¼š
- âœ… **è¯­è¨€**ï¼šGo
- âœ… **æ¡†æ¶**ï¼šGin
- âœ… **æ•°æ®åº“**ï¼šPostgreSQL
- âœ… **ç¼“å­˜**ï¼šRedisï¼ˆå¯é€‰ï¼‰

**å‰ç«¯**ï¼š
- âœ… **æ¡†æ¶**ï¼šVue 3
- âœ… **UI åº“**ï¼šElement Plus
- âœ… **æ„å»ºå·¥å…·**ï¼šVite

---

## ä¸‰ã€æ•°æ®åº“è®¾è®¡

### 3.1 æ ¸å¿ƒè¡¨è®¾è®¡

#### 1. Hub åº”ç”¨è¡¨

```sql
-- Hub åº”ç”¨è¡¨
CREATE TABLE hub_apps (
    id BIGSERIAL PRIMARY KEY,
    name VARCHAR(255) NOT NULL,
    description TEXT,
    category VARCHAR(50),
    tags TEXT[],
    
    -- æºåº”ç”¨ä¿¡æ¯ï¼ˆä¸»ç³»ç»Ÿï¼‰
    source_type VARCHAR(20) NOT NULL, -- 'saas' | 'private'
    source_url VARCHAR(255),          -- ç§æœ‰åŒ–éƒ¨ç½²çš„URLï¼ˆä»…privateç±»å‹ï¼‰
    source_user VARCHAR(100) NOT NULL,
    source_app VARCHAR(100) NOT NULL,
    
    -- å‘å¸ƒä¿¡æ¯
    publisher_username VARCHAR(100),   -- å‘å¸ƒè€…ç”¨æˆ·åï¼ˆOS ç”¨æˆ·ï¼‰
    api_key_id BIGINT,                 -- API Key IDï¼ˆç§æœ‰åŒ–ç”¨æˆ·ï¼‰
    published_at TIMESTAMP,
    
    -- æœåŠ¡è´¹ä¿¡æ¯
    service_fee_personal DECIMAL(10,2), -- ä¸ªäººç”¨æˆ·æœåŠ¡è´¹
    service_fee_enterprise DECIMAL(10,2), -- ä¼ä¸šç”¨æˆ·æœåŠ¡è´¹
    
    -- ç»Ÿè®¡ä¿¡æ¯
    download_count INT DEFAULT 0,
    trial_count INT DEFAULT 0,
    rating DECIMAL(3,2),
    
    created_at TIMESTAMP DEFAULT NOW(),
    updated_at TIMESTAMP DEFAULT NOW(),
    
    INDEX idx_category (category),
    INDEX idx_publisher_username (publisher_username),
    INDEX idx_published_at (published_at)
);
```

#### 2. Hub å‡½æ•°ç»„è¡¨ï¼ˆå­˜å‚¨æºä»£ç ï¼‰

```sql
-- Hub å‡½æ•°ç»„è¡¨ï¼ˆå­˜å‚¨æºä»£ç ï¼‰
CREATE TABLE hub_function_groups (
    id BIGSERIAL PRIMARY KEY,
    hub_app_id BIGINT NOT NULL REFERENCES hub_apps(id) ON DELETE CASCADE,
    
    -- å‡½æ•°ç»„ä¿¡æ¯
    full_group_code VARCHAR(500) NOT NULL,  -- å®Œæ•´å‡½æ•°ç»„ä»£ç ï¼š/user/app/package/group_code
    group_code VARCHAR(255) NOT NULL,       -- å‡½æ•°ç»„ä»£ç ï¼štools_cashier
    package_path VARCHAR(500) NOT NULL,     -- package è·¯å¾„ï¼šplugins/cashier
    
    -- ğŸ”¥ æºä»£ç å­˜å‚¨
    source_code TEXT NOT NULL,              -- Go æºä»£ç å†…å®¹
    source_code_hash VARCHAR(64),           -- æºä»£ç  hashï¼ˆç”¨äºå»é‡å’Œç‰ˆæœ¬ç®¡ç†ï¼‰
    
    -- å…ƒæ•°æ®
    function_count INT DEFAULT 0,            -- å‡½æ•°æ•°é‡
    api_count INT DEFAULT 0,                 -- API æ•°é‡
    
    -- ç‰ˆæœ¬ä¿¡æ¯
    version VARCHAR(50),                     -- ç‰ˆæœ¬å·ï¼ˆå¯¹åº”ä¸»ç³»ç»Ÿçš„ App.Versionï¼‰
    published_at TIMESTAMP,
    
    created_at TIMESTAMP DEFAULT NOW(),
    updated_at TIMESTAMP DEFAULT NOW(),
    
    INDEX idx_hub_app_id (hub_app_id),
    INDEX idx_full_group_code (full_group_code),
    INDEX idx_source_code_hash (source_code_hash)
);
```

#### 3. æ„é€ è®°å½•è¡¨

```sql
-- æ„é€ è®°å½•è¡¨
CREATE TABLE code_generation_logs (
    id BIGSERIAL PRIMARY KEY,
    hub_app_id BIGINT NOT NULL REFERENCES hub_apps(id) ON DELETE CASCADE,
    publisher_username VARCHAR(100) NOT NULL,
    version VARCHAR(50) NOT NULL,
    
    -- å¯¹è¯è®°å½•
    conversation JSONB NOT NULL,  -- å­˜å‚¨å®Œæ•´çš„å¯¹è¯è®°å½•
    
    -- å…ƒæ•°æ®
    total_turns INT DEFAULT 0,     -- å¯¹è¯è½®æ•°
    total_tokens INT DEFAULT 0,   -- æ€» token æ•°
    generation_time TIMESTAMP,      -- ç”Ÿæˆæ—¶é—´
    
    -- ç»Ÿè®¡ä¿¡æ¯
    functions_generated INT DEFAULT 0,  -- ç”Ÿæˆçš„å‡½æ•°æ•°é‡
    apis_generated INT DEFAULT 0,       -- ç”Ÿæˆçš„ API æ•°é‡
    
    created_at TIMESTAMP DEFAULT NOW(),
    updated_at TIMESTAMP DEFAULT NOW(),
    
    INDEX idx_hub_app_id (hub_app_id),
    INDEX idx_publisher_username (publisher_username),
    INDEX idx_version (version)
);
```

#### 4. æœåŠ¡è´¹æ”¯ä»˜è®°å½•è¡¨

```sql
-- æœåŠ¡è´¹æ”¯ä»˜è®°å½•è¡¨
CREATE TABLE service_fee_payments (
    id BIGSERIAL PRIMARY KEY,
    hub_app_id BIGINT NOT NULL REFERENCES hub_apps(id),
    buyer_username VARCHAR(100) NOT NULL,
    payment_type VARCHAR(20) NOT NULL, -- 'personal' | 'enterprise'
    amount DECIMAL(10,2) NOT NULL,
    
    -- æ”¶ç›Šåˆ†é…
    developer_username VARCHAR(100) NOT NULL,
    developer_amount DECIMAL(10,2) NOT NULL,  -- å¼€å‘è€…æ”¶ç›Šï¼ˆ80%ï¼‰
    hub_amount DECIMAL(10,2) NOT NULL,        -- Hub å¹³å°æ”¶ç›Šï¼ˆ10%ï¼‰
    os_amount DECIMAL(10,2) NOT NULL,         -- OS å¹³å°æ”¶ç›Šï¼ˆ10%ï¼‰
    
    -- æ”¯ä»˜ä¿¡æ¯
    payment_method VARCHAR(50),               -- æ”¯ä»˜æ–¹å¼
    payment_status VARCHAR(20) NOT NULL,      -- 'pending' | 'paid' | 'failed'
    payment_time TIMESTAMP,
    
    created_at TIMESTAMP DEFAULT NOW(),
    updated_at TIMESTAMP DEFAULT NOW(),
    
    INDEX idx_hub_app_id (hub_app_id),
    INDEX idx_buyer_username (buyer_username),
    INDEX idx_developer_username (developer_username),
    INDEX idx_payment_status (payment_status)
);
```

#### 5. æœåŠ¡è®°å½•è¡¨

```sql
-- æœåŠ¡è®°å½•è¡¨ï¼ˆæŠ€æœ¯æ”¯æŒã€éœ€æ±‚è°ƒæ•´ç­‰ï¼‰
CREATE TABLE service_records (
    id BIGSERIAL PRIMARY KEY,
    hub_app_id BIGINT NOT NULL REFERENCES hub_apps(id),
    buyer_username VARCHAR(100) NOT NULL,
    service_type VARCHAR(50) NOT NULL, -- 'support' | 'requirement' | 'upgrade'
    service_content TEXT,
    service_status VARCHAR(20) NOT NULL, -- 'pending' | 'processing' | 'completed'
    
    created_at TIMESTAMP DEFAULT NOW(),
    updated_at TIMESTAMP DEFAULT NOW(),
    
    INDEX idx_hub_app_id (hub_app_id),
    INDEX idx_buyer_username (buyer_username),
    INDEX idx_service_status (service_status)
);
```

---

## å››ã€API è®¾è®¡

### 4.1 åº”ç”¨å‘å¸ƒ API

#### 1. å‘å¸ƒåº”ç”¨åˆ° Hub

```go
// POST /api/v1/apps/publish
type PublishAppReq struct {
    SourceUser  string   `json:"source_user" binding:"required"`   // æºåº”ç”¨ç”¨æˆ·
    SourceApp   string   `json:"source_app" binding:"required"`    // æºåº”ç”¨ä»£ç 
    Packages    []string `json:"packages" binding:"required"`       // è¦å‘å¸ƒçš„ package åˆ—è¡¨
    Name        string   `json:"name" binding:"required"`           // åº”ç”¨åç§°
    Description string   `json:"description"`                       // åº”ç”¨æè¿°
    Category    string   `json:"category"`                          // åˆ†ç±»
    Tags        []string `json:"tags"`                              // æ ‡ç­¾
    
    // æœåŠ¡è´¹ä¿¡æ¯
    ServiceFeePersonal   float64 `json:"service_fee_personal"`    // ä¸ªäººç”¨æˆ·æœåŠ¡è´¹
    ServiceFeeEnterprise float64 `json:"service_fee_enterprise"`  // ä¼ä¸šç”¨æˆ·æœåŠ¡è´¹
    
    // æ„é€ è®°å½•ï¼ˆå¯é€‰ï¼‰
    IncludeConstructionLog bool `json:"include_construction_log"` // æ˜¯å¦åŒ…å«æ„é€ è®°å½•
}

type PublishAppResp struct {
    HubAppID int64  `json:"hub_app_id"`  // Hub åº”ç”¨ ID
    HubURL   string `json:"hub_url"`     // Hub åº”ç”¨ URL
    Message  string `json:"message"`     // å“åº”æ¶ˆæ¯
}
```

**å®ç°æµç¨‹**ï¼š
```go
func (s *AppService) PublishApp(ctx context.Context, req *PublishAppReq) (*PublishAppResp, error) {
    // 1. éªŒè¯æƒé™ï¼ˆJWT æˆ– API Keyï¼‰
    
    // 2. ä» OS è·å–æºä»£ç 
    sourceCodeList, err := s.osClient.GetSourceCode(req.SourceUser, req.SourceApp, req.Packages)
    
    // 3. ä» OS è·å–æ„é€ è®°å½•ï¼ˆå¦‚æœåŒ…å«ï¼‰
    var constructionLog *CodeGenerationLog
    if req.IncludeConstructionLog {
        constructionLog, err = s.osClient.GetConstructionLog(req.SourceUser, req.SourceApp)
    }
    
    // 4. å­˜å‚¨åˆ° Hub æ•°æ®åº“
    hubApp := &model.HubApp{
        Name: req.Name,
        Description: req.Description,
        SourceUser: req.SourceUser,
        SourceApp: req.SourceApp,
        ServiceFeePersonal: req.ServiceFeePersonal,
        ServiceFeeEnterprise: req.ServiceFeeEnterprise,
        // ...
    }
    s.hubAppRepo.Create(hubApp)
    
    // 5. å­˜å‚¨å‡½æ•°ç»„æºä»£ç 
    for _, sourceCode := range sourceCodeList {
        hubFunctionGroup := &model.HubFunctionGroup{
            HubAppID: hubApp.ID,
            FullGroupCode: sourceCode.FullGroupCode,
            GroupCode: sourceCode.GroupCode,
            SourceCode: sourceCode.Content,  // ğŸ”¥ å­˜å‚¨æºä»£ç 
            Version: sourceCode.Version,
        }
        s.hubFunctionGroupRepo.Create(hubFunctionGroup)
    }
    
    // 6. å­˜å‚¨æ„é€ è®°å½•ï¼ˆå¦‚æœåŒ…å«ï¼‰
    if constructionLog != nil {
        constructionLog.HubAppID = hubApp.ID
        s.constructionLogRepo.Create(constructionLog)
    }
    
    // 7. è¿”å› Hub URL
    return &PublishAppResp{
        HubAppID: hubApp.ID,
        HubURL: fmt.Sprintf("https://hub.ai-agent-os.com/apps/%d", hubApp.ID),
    }, nil
}
```

### 4.2 åº”ç”¨æµè§ˆ API

#### 1. åº”ç”¨åˆ—è¡¨

```go
// GET /api/v1/apps
type AppListReq struct {
    Category string `form:"category"`  // åˆ†ç±»ç­›é€‰
    Tag      string `form:"tag"`       // æ ‡ç­¾ç­›é€‰
    Keyword  string `form:"keyword"`   // å…³é”®è¯æœç´¢
    Page     int    `form:"page"`      // é¡µç 
    PageSize int    `form:"page_size"` // æ¯é¡µæ•°é‡
}

type AppListResp struct {
    Apps      []*AppInfo `json:"apps"`
    Total     int64      `json:"total"`
    Page      int        `json:"page"`
    PageSize  int        `json:"page_size"`
}

type AppInfo struct {
    ID          int64    `json:"id"`
    Name        string   `json:"name"`
    Description string   `json:"description"`
    Category    string   `json:"category"`
    Tags        []string `json:"tags"`
    ServiceFeePersonal   float64 `json:"service_fee_personal"`
    ServiceFeeEnterprise float64 `json:"service_fee_enterprise"`
    DownloadCount int    `json:"download_count"`
    TrialCount    int    `json:"trial_count"`
    Rating        float64 `json:"rating"`
    PublisherUsername string `json:"publisher_username"`
    PublishedAt   string `json:"published_at"`
}
```

#### 2. åº”ç”¨è¯¦æƒ…

```go
// GET /api/v1/apps/{app_id}
type AppDetailResp struct {
    ID          int64    `json:"id"`
    Name        string   `json:"name"`
    Description string   `json:"description"`
    Category    string   `json:"category"`
    Tags        []string `json:"tags"`
    
    // æœåŠ¡è´¹ä¿¡æ¯
    ServiceFeePersonal   float64 `json:"service_fee_personal"`
    ServiceFeeEnterprise float64 `json:"service_fee_enterprise"`
    
    // æºä»£ç ä¿¡æ¯ï¼ˆå¼€æºï¼‰
    SourceCodeAvailable bool `json:"source_code_available"` // æºä»£ç æ˜¯å¦å¯ç”¨
    SourceCodePreview    string `json:"source_code_preview"` // æºä»£ç é¢„è§ˆï¼ˆå‰ 100 è¡Œï¼‰
    
    // æ„é€ è®°å½•ä¿¡æ¯ï¼ˆå¼€æºï¼‰
    ConstructionLogAvailable bool `json:"construction_log_available"` // æ„é€ è®°å½•æ˜¯å¦å¯ç”¨
    ConstructionLogSummary     *ConstructionLogSummary `json:"construction_log_summary"` // æ„é€ è®°å½•æ‘˜è¦
    
    // ç»Ÿè®¡ä¿¡æ¯
    DownloadCount int    `json:"download_count"`
    TrialCount    int    `json:"trial_count"`
    Rating        float64 `json:"rating"`
    
    // å¼€å‘è€…ä¿¡æ¯
    PublisherUsername string `json:"publisher_username"`
    PublishedAt       string `json:"published_at"`
    
    // æœåŠ¡å†…å®¹
    ServiceContent *ServiceContent `json:"service_content"`
}

type ConstructionLogSummary struct {
    TotalTurns      int    `json:"total_turns"`
    GenerationTime  string `json:"generation_time"`
    FunctionsGenerated int `json:"functions_generated"`
    APIsGenerated   int    `json:"apis_generated"`
    Preview         string `json:"preview"` // å‰ 3 è½®å¯¹è¯é¢„è§ˆ
}

type ServiceContent struct {
    SupportDays      int    `json:"support_days"`       // æŠ€æœ¯æ”¯æŒå¤©æ•°
    FreeRequirements int    `json:"free_requirements"`  // å…è´¹éœ€æ±‚è°ƒæ•´æ•°é‡
    Documentation    bool   `json:"documentation"`      // æ–‡æ¡£çŸ¥è¯†åº“
    UpgradePeriod    string `json:"upgrade_period"`     // ç‰ˆæœ¬å‡çº§æœŸé™
}
```

### 4.3 åº”ç”¨è¯•ç”¨ API

#### 1. è·³è½¬åˆ° OS è¯•ç”¨

```go
// GET /api/v1/apps/{app_id}/trial
// è¿”å›è·³è½¬ URLï¼ˆå¸¦ Tokenï¼‰
type TrialAppResp struct {
    TrialURL string `json:"trial_url"` // https://os.ai-agent-os.com/trial?app_id=123&token=xxx
}
```

### 4.4 åº”ç”¨å…‹éš† API

#### 1. å…‹éš†åº”ç”¨

```go
// POST /api/v1/apps/{app_id}/clone
type CloneAppReq struct {
    TargetUser string `json:"target_user" binding:"required"`   // ç›®æ ‡ç”¨æˆ·
    TargetApp  string `json:"target_app" binding:"required"`    // ç›®æ ‡åº”ç”¨ä»£ç 
    PaymentType string `json:"payment_type" binding:"required"` // 'personal' | 'enterprise'
}

type CloneAppResp struct {
    Success bool   `json:"success"`
    Message string `json:"message"`
    CloneURL string `json:"clone_url"` // è·³è½¬åˆ° OS å…‹éš†é¡µé¢
}
```

**å®ç°æµç¨‹**ï¼š
```go
func (s *AppService) CloneApp(ctx context.Context, appID int64, req *CloneAppReq) (*CloneAppResp, error) {
    // 1. éªŒè¯æœåŠ¡è´¹æ”¯ä»˜çŠ¶æ€
    payment, err := s.checkPaymentStatus(ctx, appID, req.TargetUser, req.PaymentType)
    if err != nil {
        return nil, err
    }
    if !payment.Paid {
        return &CloneAppResp{
            Success: false,
            Message: "è¯·å…ˆæ”¯ä»˜æœåŠ¡è´¹",
            CloneURL: fmt.Sprintf("https://hub.ai-agent-os.com/apps/%d/payment?type=%s", appID, req.PaymentType),
        }, nil
    }
    
    // 2. è°ƒç”¨ OS API å…‹éš†åº”ç”¨
    cloneReq := &OSCloneReq{
        HubAppID: appID,
        TargetUser: req.TargetUser,
        TargetApp: req.TargetApp,
    }
    err = s.osClient.CloneFromHub(cloneReq)
    if err != nil {
        return nil, err
    }
    
    // 3. æ›´æ–°ç»Ÿè®¡
    s.hubAppRepo.IncrementDownloadCount(appID)
    
    return &CloneAppResp{
        Success: true,
        Message: "å…‹éš†æˆåŠŸ",
        CloneURL: fmt.Sprintf("https://os.ai-agent-os.com/apps/%s/%s", req.TargetUser, req.TargetApp),
    }, nil
}
```

### 4.5 æœåŠ¡è´¹æ”¯ä»˜ API

#### 1. åˆ›å»ºæ”¯ä»˜è®¢å•

```go
// POST /api/v1/apps/{app_id}/payment
type CreatePaymentReq struct {
    PaymentType string `json:"payment_type" binding:"required"` // 'personal' | 'enterprise'
}

type CreatePaymentResp struct {
    PaymentID   int64   `json:"payment_id"`
    Amount      float64 `json:"amount"`
    PaymentURL  string  `json:"payment_url"` // æ”¯ä»˜é¡µé¢ URL
}
```

#### 2. æ”¯ä»˜å›è°ƒ

```go
// POST /api/v1/payments/{payment_id}/callback
type PaymentCallbackReq struct {
    PaymentID     int64  `json:"payment_id"`
    PaymentStatus string `json:"payment_status"` // 'paid' | 'failed'
    PaymentMethod string `json:"payment_method"`
}
```

---

## äº”ã€å¼€å‘ä»»åŠ¡æ¸…å•

### 5.1 Phase 1ï¼šæ ¸å¿ƒåŠŸèƒ½ï¼ˆMVPï¼‰

#### 1. æ•°æ®åº“è®¾è®¡ âœ…

- [ ] åˆ›å»º Hub åº”ç”¨è¡¨
- [ ] åˆ›å»º Hub å‡½æ•°ç»„è¡¨ï¼ˆå­˜å‚¨æºä»£ç ï¼‰
- [ ] åˆ›å»ºæ„é€ è®°å½•è¡¨
- [ ] åˆ›å»ºæœåŠ¡è´¹æ”¯ä»˜è®°å½•è¡¨
- [ ] åˆ›å»ºæœåŠ¡è®°å½•è¡¨

#### 2. åç«¯ API âœ…

**åº”ç”¨å‘å¸ƒ**ï¼š
- [ ] POST /api/v1/apps/publishï¼ˆå‘å¸ƒåº”ç”¨ï¼‰
- [ ] ä» OS è·å–æºä»£ç 
- [ ] ä» OS è·å–æ„é€ è®°å½•
- [ ] å­˜å‚¨åˆ° Hub æ•°æ®åº“

**åº”ç”¨æµè§ˆ**ï¼š
- [ ] GET /api/v1/appsï¼ˆåº”ç”¨åˆ—è¡¨ï¼‰
- [ ] GET /api/v1/apps/{app_id}ï¼ˆåº”ç”¨è¯¦æƒ…ï¼‰
- [ ] æ”¯æŒæœç´¢ã€åˆ†ç±»ã€æ ‡ç­¾ç­›é€‰

**åº”ç”¨è¯•ç”¨**ï¼š
- [ ] GET /api/v1/apps/{app_id}/trialï¼ˆç”Ÿæˆè¯•ç”¨ URLï¼‰

**åº”ç”¨å…‹éš†**ï¼š
- [ ] POST /api/v1/apps/{app_id}/cloneï¼ˆå…‹éš†åº”ç”¨ï¼‰
- [ ] éªŒè¯æœåŠ¡è´¹æ”¯ä»˜çŠ¶æ€
- [ ] è°ƒç”¨ OS API å…‹éš†

**æœåŠ¡è´¹æ”¯ä»˜**ï¼š
- [ ] POST /api/v1/apps/{app_id}/paymentï¼ˆåˆ›å»ºæ”¯ä»˜è®¢å•ï¼‰
- [ ] POST /api/v1/payments/{payment_id}/callbackï¼ˆæ”¯ä»˜å›è°ƒï¼‰

#### 3. OS é›†æˆ âœ…

**OS APIï¼ˆéœ€è¦å®ç°ï¼‰**ï¼š
- [ ] GET /api/v1/apps/{user}/{app}/source-codeï¼ˆè·å–æºä»£ç ï¼‰
- [ ] GET /api/v1/apps/{user}/{app}/construction-logï¼ˆè·å–æ„é€ è®°å½•ï¼‰
- [ ] POST /api/v1/hub/clone-from-hubï¼ˆä» Hub å…‹éš†ï¼‰

**OS å‰ç«¯**ï¼š
- [ ] "å‘å¸ƒåˆ° Hub" æŒ‰é’®
- [ ] "ä» Hub å…‹éš†" åŠŸèƒ½
- [ ] Hub â†’ OS è·³è½¬å¤„ç†

#### 4. Hub å‰ç«¯ âœ…

**åº”ç”¨æµè§ˆ**ï¼š
- [ ] åº”ç”¨åˆ—è¡¨é¡µé¢
- [ ] åº”ç”¨æœç´¢å’Œç­›é€‰
- [ ] åº”ç”¨è¯¦æƒ…é¡µé¢
- [ ] ä»£ç é¢„è§ˆï¼ˆå¼€æºï¼‰
- [ ] æ„é€ è®°å½•æ‘˜è¦ï¼ˆå¼€æºï¼‰

**åº”ç”¨è¯•ç”¨**ï¼š
- [ ] "è¯•ç”¨" æŒ‰é’®
- [ ] è·³è½¬åˆ° OS è¯•ç”¨

**åº”ç”¨å…‹éš†**ï¼š
- [ ] "å…‹éš†" æŒ‰é’®
- [ ] æœåŠ¡è´¹æ”¯ä»˜é¡µé¢
- [ ] æ”¯ä»˜æˆåŠŸåçš„å…‹éš†æµç¨‹

**ç”¨æˆ·è®¤è¯**ï¼š
- [ ] ç™»å½•/æ³¨å†Œé¡µé¢
- [ ] è°ƒç”¨ OS API è¿›è¡Œè®¤è¯
- [ ] Token ç®¡ç†

---

## å…­ã€å®æ–½æ­¥éª¤

### 6.1 Phase 1ï¼šæ ¸å¿ƒåŠŸèƒ½ï¼ˆMVPï¼‰

**ç›®æ ‡**ï¼šå®ç°åŸºæœ¬çš„åº”ç”¨å‘å¸ƒã€æµè§ˆã€è¯•ç”¨ã€å…‹éš†åŠŸèƒ½

**æ—¶é—´ä¼°ç®—**ï¼š2-3 å‘¨

**ä»»åŠ¡ä¼˜å…ˆçº§**ï¼š
1. âœ… **æ•°æ®åº“è®¾è®¡**ï¼ˆ1 å¤©ï¼‰
2. âœ… **åç«¯ API**ï¼ˆ1 å‘¨ï¼‰
3. âœ… **OS é›†æˆ**ï¼ˆ3 å¤©ï¼‰
4. âœ… **Hub å‰ç«¯**ï¼ˆ1 å‘¨ï¼‰

### 6.2 Phase 2ï¼šæœåŠ¡è´¹æ”¯ä»˜

**ç›®æ ‡**ï¼šå®ç°æœåŠ¡è´¹æ”¯ä»˜åŠŸèƒ½

**æ—¶é—´ä¼°ç®—**ï¼š1 å‘¨

**ä»»åŠ¡**ï¼š
- [ ] æ”¯ä»˜æ¥å£é›†æˆ
- [ ] æ”¯ä»˜å›è°ƒå¤„ç†
- [ ] æ”¶ç›Šåˆ†é…é€»è¾‘

### 6.3 Phase 3ï¼šæœåŠ¡ç®¡ç†

**ç›®æ ‡**ï¼šå®ç°æœåŠ¡ç®¡ç†åŠŸèƒ½ï¼ˆæŠ€æœ¯æ”¯æŒã€éœ€æ±‚è°ƒæ•´ç­‰ï¼‰

**æ—¶é—´ä¼°ç®—**ï¼š1 å‘¨

**ä»»åŠ¡**ï¼š
- [ ] æœåŠ¡å·¥å•ç³»ç»Ÿ
- [ ] æœåŠ¡è®°å½•ç®¡ç†
- [ ] æœåŠ¡ç»Ÿè®¡

---

## ä¸ƒã€æŠ€æœ¯å®ç°ç»†èŠ‚

### 7.1 Hub è°ƒç”¨ OS API

**OS API å®¢æˆ·ç«¯**ï¼š
```go
// hub/backend/client/os_client.go
type OSClient struct {
    baseURL string
    httpClient *http.Client
}

func (c *OSClient) GetSourceCode(user, app string, packages []string) ([]*SourceCodeInfo, error) {
    // è°ƒç”¨ OS API
    url := fmt.Sprintf("%s/api/v1/apps/%s/%s/source-code?packages=%s",
        c.baseURL, user, app, strings.Join(packages, ","))
    resp, err := c.httpClient.Get(url)
    // ...
}

func (c *OSClient) GetConstructionLog(user, app string) (*CodeGenerationLog, error) {
    // è°ƒç”¨ OS API
    url := fmt.Sprintf("%s/api/v1/apps/%s/%s/construction-log", c.baseURL, user, app)
    resp, err := c.httpClient.Get(url)
    // ...
}

func (c *OSClient) CloneFromHub(req *CloneFromHubReq) error {
    // è°ƒç”¨ OS API
    url := fmt.Sprintf("%s/api/v1/hub/clone-from-hub", c.baseURL)
    resp, err := c.httpClient.Post(url, "application/json", req)
    // ...
}
```

### 7.2 Hub ç”¨æˆ·è®¤è¯

**è°ƒç”¨ OS API è®¤è¯**ï¼š
```go
// hub/backend/service/auth_service.go
type HubAuthService struct {
    osClient *OSClient
}

func (s *HubAuthService) Login(username, password string) (*User, string, error) {
    // è°ƒç”¨ OS API è¿›è¡Œè®¤è¯
    req := &OSLoginReq{
        Username: username,
        Password: password,
    }
    resp, err := s.osClient.Login(req)
    if err != nil {
        return nil, "", err
    }
    
    return resp.User, resp.Token, nil
}
```

### 7.3 Hub â†’ OS è·³è½¬

**ç”Ÿæˆè·³è½¬ URL**ï¼š
```go
// hub/backend/service/app_service.go
func (s *AppService) GenerateTrialURL(appID int64, token string) string {
    return fmt.Sprintf("https://os.ai-agent-os.com/trial?app_id=%d&token=%s", appID, token)
}

func (s *AppService) GenerateCloneURL(appID int64, token string) string {
    return fmt.Sprintf("https://os.ai-agent-os.com/clone?app_id=%d&token=%s", appID, token)
}
```

---

## å…«ã€å¼€å‘è§„èŒƒ

### 8.1 ä»£ç è§„èŒƒ

**åç«¯**ï¼š
- âœ… éµå¾ª Go ä»£ç è§„èŒƒ
- âœ… ä½¿ç”¨ä¾èµ–æ³¨å…¥
- âœ… é”™è¯¯å¤„ç†å®Œå–„
- âœ… æ—¥å¿—è®°å½•å®Œæ•´

**å‰ç«¯**ï¼š
- âœ… éµå¾ª Vue 3 ä»£ç è§„èŒƒ
- âœ… ä½¿ç”¨ TypeScript
- âœ… ç»„ä»¶åŒ–å¼€å‘
- âœ… å“åº”å¼è®¾è®¡

### 8.2 æ•°æ®åº“è§„èŒƒ

- âœ… ä½¿ç”¨ GORM
- âœ… è¡¨åä½¿ç”¨ä¸‹åˆ’çº¿å‘½å
- âœ… å­—æ®µåä½¿ç”¨ä¸‹åˆ’çº¿å‘½å
- âœ… ç´¢å¼•è®¾è®¡åˆç†

### 8.3 API è§„èŒƒ

- âœ… RESTful API è®¾è®¡
- âœ… ç»Ÿä¸€çš„å“åº”æ ¼å¼
- âœ… å®Œå–„çš„é”™è¯¯å¤„ç†
- âœ… API æ–‡æ¡£å®Œæ•´

---

## ä¹ã€æ€»ç»“

### 9.1 æ ¸å¿ƒè®¾è®¡

**Hub + OS ä¸€ä½“åŒ–ç”Ÿæ€ç³»ç»Ÿ**ï¼š
- âœ… **Hub**ï¼šåº”ç”¨å¸‚åœºï¼Œå–è½¯ä»¶ã€ä»‹ç»è½¯ä»¶
- âœ… **OS**ï¼šè¿è¡Œå¹³å°ï¼Œå¯ä»¥è¯•ç”¨ã€å…‹éš†ã€è¿è¡Œè½¯ä»¶
- âœ… **äº’é€š**ï¼šHub å’Œ OS ç”¨æˆ·ç³»ç»Ÿå®Œå…¨äº’é€š

**æœåŠ¡è´¹æ¨¡å¼**ï¼š
- âœ… **ä»£ç å®Œå…¨å¼€æº**ï¼šä»£ç å®Œå…¨å¼€æºï¼Œå¢å¼ºä¿¡ä»»ï¼Œä¿ƒè¿›ä»˜è´¹
- âœ… **æ„é€ è®°å½•å®Œå…¨å¼€æº**ï¼šæ„é€ è®°å½•å®Œå…¨å¼€æºï¼Œå¢å¼ºä¿¡ä»»ï¼Œä¿ƒè¿›ä»˜è´¹
- âœ… **æœåŠ¡è´¹æ¨¡å¼**ï¼šé€šè¿‡æœåŠ¡è´¹æ¨¡å¼ï¼Œå®ç°å¯æŒç»­çš„å•†ä¸šæ¨¡å¼

### 9.2 å¼€å‘ä¼˜å…ˆçº§

**Phase 1ï¼ˆMVPï¼‰**ï¼š
1. âœ… æ•°æ®åº“è®¾è®¡
2. âœ… åç«¯ APIï¼ˆå‘å¸ƒã€æµè§ˆã€è¯•ç”¨ã€å…‹éš†ï¼‰
3. âœ… OS é›†æˆ
4. âœ… Hub å‰ç«¯

**Phase 2**ï¼š
1. âš ï¸ æœåŠ¡è´¹æ”¯ä»˜
2. âš ï¸ æ”¶ç›Šåˆ†é…

**Phase 3**ï¼š
1. âš ï¸ æœåŠ¡ç®¡ç†
2. âš ï¸ æœåŠ¡ç»Ÿè®¡

### 9.3 å…³é”®æˆåŠŸå› ç´ 

1. âœ… **ç»Ÿä¸€ç”¨æˆ·ç³»ç»Ÿ**ï¼šHub å’Œ OS å…±äº«ç”¨æˆ·ç³»ç»Ÿï¼Œå•ç‚¹ç™»å½•
2. âœ… **æ— ç¼è·³è½¬**ï¼šHub å’Œ OS ä¹‹é—´æ— ç¼è·³è½¬ï¼Œç”¨æˆ·ä½“éªŒæµç•…
3. âœ… **æœåŠ¡è´¹æ¨¡å¼**ï¼šé€šè¿‡æœåŠ¡è´¹æ¨¡å¼ï¼Œå®ç°å¯æŒç»­çš„å•†ä¸šæ¨¡å¼
4. âœ… **å®Œå…¨å¼€æº**ï¼šä»£ç å’Œæ„é€ è®°å½•å®Œå…¨å¼€æºï¼Œå¢å¼ºä¿¡ä»»

**è¿™æ ·æ—¢å®ç°äº†å®Œæ•´çš„ç”¨æˆ·ä½“éªŒï¼Œåˆå®ç°äº†å¯æŒç»­çš„å•†ä¸šæ¨¡å¼ï¼Œè¿˜æ»¡è¶³äº†ä¸åŒç”¨æˆ·çš„éœ€æ±‚ã€‚** âœ…

