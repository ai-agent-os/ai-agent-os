æˆ‘ä»¬çš„timestamp ç»„ä»¶æ¶µç›–äº†æ•´ä¸ªæ—¶é—´æ—¥æœŸçš„é€‰æ‹©ï¼Œæ³¨æ„æ•´ä¸ªæ—¶é—´æ—¥æœŸçš„å€¼éƒ½æ˜¯æ—¶é—´æˆ³ï¼Œä¸”æ˜¯æ¯«ç§’çº§åˆ«çš„æ—¶é—´æˆ³ï¼Œæ•´ä¸ªç³»ç»Ÿåªæœ‰è¿™ä¸€ä¸ªæ—¶é—´ç›¸å…³çš„ç»„ä»¶
è¿™ä¸ªtimestampæ¶µç›–äº†æ‰€æœ‰
åŒ…æ‹¬ æ—¶é—´é€‰æ‹©ï¼Œæ—¥æœŸé€‰æ‹©ï¼Œå¹´ä»½é€‰æ‹©ï¼Œæœˆä»½é€‰æ‹©ï¼Œæ—¶é—´æ—¥æœŸï¼Œå¹´ä»½æ—¥æœŸç­‰ç­‰æ‰€æœ‰å½¢å¼ï¼Œåªæ˜¯é€šè¿‡formatæ¥è¿›è¡Œæ ¼å¼åŒ–
åˆ†ä¸ºä¸¤ç§æ—¶é—´ç±»å‹
ä¸€ç§æ˜¯ç»å¯¹æ—¶é—´ï¼šä¾‹å¦‚
YYYY-MM-DD HH:mm:ss è¿™ç§æ˜¯ç²¾ç¡®çš„æ—¶é—´ï¼Œéœ€è¦ä¼ é€’ç²¾ç¡®çš„æ—¶é—´æˆ³

HH:mm:ss è¿™ç§æ˜¯ç›¸å¯¹æ—¶é—´ï¼Œä¸å…³å¿ƒå…·ä½“çš„å¹´ä»½æœˆæ—¥ç­‰ç­‰ï¼Œè¿™ç§ä¼ é€’æ—¶é—´æˆ³ï¼Œéœ€è¦ä¼ é€’ 1970 1æœˆ1æ—¥çš„ HH:mm:ss çš„æ—¶é—´ï¼Œ
ä¸ºå•¥è¦è¿™æ ·å¹²ï¼Ÿå› ä¸ºè¿™æ ·åç«¯æ‰èƒ½æ ¹æ®è¿™ä¸ªæ—¶é—´è¿›è¡Œæ’åºï¼Œå‡å¦‚è¿™ä¸ªå­—æ®µå­˜å‚¨çš„æ˜¯ä¸‹è¯¾æ—¶é—´ï¼Œé‚£ä¹ˆæˆ‘ä»¬éœ€è¦æ ¹æ®ä¸‹è¯¾æ—¶é—´è¿›è¡Œæ’åºçš„è¯å°±éå¸¸æ–¹ä¾¿äº†
å¦‚æœç”¨ç»å¯¹æ—¶é—´æˆ³çš„æ–¹å¼å­˜å‚¨çš„è¯ï¼Œåé¢æ–°å¢çš„è®°å½•å³ä½¿ä¸‹è¯¾æ—©ä¹Ÿä¼šè¢«æ’åœ¨åé¢ï¼Œè¿™æ˜¯ä¸€ä¸ªç‚¹ï¼Œ
æ‰€ä»¥è¿™é‡Œå…ˆåˆ†æ¸…æ¥šå“ªäº›æ˜¯ç»å¯¹æ—¶é—´ï¼Œå“ªäº›æ˜¯ç›¸å¯¹æ—¶é—´




å› ä¸ºæœ‰ table_permission: "read" è¯´æ˜è¿™ä¸ªå­—æ®µåªåœ¨ table åˆ—è¡¨ä¸­å±•ç¤ºï¼Œåœ¨æ–°å¢å’Œæ›´æ–°è¡¨å•ä¸­éƒ½ä¸æ˜¾ç¤ºï¼ˆå› ä¸ºæ˜¯è‡ªåŠ¨ç”Ÿæˆæˆ–åªè¯»å­—æ®µï¼‰
```json

{
                "callbacks": null,
                "children": null,
                "code": "created_at",
                "data": {
                    "example": "",
                    "format": "",
                    "type": "int"
                },
                "desc": "",
                "name": "åˆ›å»ºæ—¶é—´",
                "search": "",
                "table_permission": "read",
                "validation": "",
                "widget": {
                    "config": {
                        "disabled": false, //è¿™ä¸ªå­—æ®µæ ‡è¯†æ˜¯å¦èƒ½è¿›è¡Œæ—¶é—´çš„é€‰æ‹©
                        "format": "YYYY-MM-DD HH:mm:ss"
                    },
                    "type": "timestamp"
                }
            }
```

è¿™ä¸ªå­—æ®µæ— è®ºæ˜¯åœ¨tableçš„æ–°å¢ä¿®æ”¹è¿˜æ˜¯åœ¨formå‡½æ•°çš„è¡¨å•ä¸­éƒ½æ˜¯å¯ä»¥è°ƒå‡ºæ—¶é—´æ—¥æœŸé€‰æ‹©å™¨æ¥é€‰æ‹©æ—¶é—´çš„ï¼Œ
```json

{
                "callbacks": null,
                "children": null,
                "code": "push_at",
                "data": {
                    "example": "",
                    "format": "",
                    "type": "int"
                },
                "desc": "",
                "name": "å‘å¸ƒæ—¶é—´",
                "search": "",
                "table_permission": "",
                "validation": "",
                "widget": {
                    "config": {
                        "disabled": false,
                        "format": "YYYY-MM-DD HH:mm:ss"
                    },
                    "type": "timestamp"
                }
            }
```

---

## table_permission å­—æ®µè¯´æ˜

> **è¯¦ç»†è¯´æ˜è¯·å‚è€ƒ**ï¼š[table_permissionæƒé™é€»è¾‘.md](./table_permissionæƒé™é€»è¾‘.md)

### å¿«é€Ÿå‚è€ƒ

`table_permission` æ§åˆ¶å­—æ®µåœ¨ä¸åŒåœºæ™¯ä¸‹çš„æ˜¾ç¤ºå’Œç¼–è¾‘æƒé™ï¼š

| å€¼ | Table åˆ—è¡¨ | Table æ–°å¢ | Table ç¼–è¾‘ | Form å‡½æ•° |
|---|-----------|----------|----------|---------|
| `""` (ç©º) | âœ… æ˜¾ç¤º | âœ… å¯å¡«å†™ | âœ… å¯ä¿®æ”¹ | âœ… æ˜¾ç¤º |
| `"read"` | âœ… æ˜¾ç¤º | âŒ ä¸æ˜¾ç¤º | âŒ ä¸æ˜¾ç¤º | âŒ ä¸æ˜¾ç¤º |
| `"create"` | âœ… æ˜¾ç¤º | âœ… å¯å¡«å†™ | âŒ ä¸æ˜¾ç¤º | âœ… æ˜¾ç¤º |
| `"update"` | âœ… æ˜¾ç¤º | âŒ ä¸æ˜¾ç¤º | âœ… å¯ä¿®æ”¹ | âŒ ä¸æ˜¾ç¤º |

### å…¸å‹æ—¶é—´å­—æ®µåœºæ™¯

#### 1. `created_at` - åˆ›å»ºæ—¶é—´ï¼ˆåªè¯»ï¼‰
```json
{
  "code": "created_at",
  "name": "åˆ›å»ºæ—¶é—´",
  "table_permission": "read",  // ğŸ”¥ åªè¯»å­—æ®µ
  "widget": {
    "type": "timestamp",
    "config": {
      "format": "YYYY-MM-DD HH:mm:ss"
    }
  }
}
```

**ä¸šåŠ¡é€»è¾‘**ï¼šåç«¯è‡ªåŠ¨ç”Ÿæˆï¼Œç”¨æˆ·ä¸å¯å¡«å†™å’Œä¿®æ”¹

#### 2. `push_at` - å‘å¸ƒæ—¶é—´ï¼ˆå¯ç¼–è¾‘ï¼‰
```json
{
  "code": "push_at",
  "name": "å‘å¸ƒæ—¶é—´",
  "table_permission": "",  // ğŸ”¥ å…¨éƒ¨æƒé™
  "widget": {
    "type": "timestamp",
    "config": {
      "format": "YYYY-MM-DD HH:mm:ss"
    }
  }
}
```

**ä¸šåŠ¡é€»è¾‘**ï¼šç”¨æˆ·å¯ä»¥åœ¨æ–°å¢å’Œç¼–è¾‘æ—¶é€‰æ‹©å‘å¸ƒæ—¶é—´

---

## å‰ç«¯å®ç°æŠ€æœ¯æ–¹æ¡ˆ

### 1. æ ¸å¿ƒè®¾è®¡ç†å¿µ

```
ç»Ÿä¸€çš„æ—¶é—´ç»„ä»¶ (TimestampWidget)
â”œâ”€ å”¯ä¸€çš„æ•°æ®æ ¼å¼ï¼šæ¯«ç§’çº§æ—¶é—´æˆ³ï¼ˆint64ï¼‰
â”œâ”€ å¤šæ ·çš„æ˜¾ç¤ºæ ¼å¼ï¼šé€šè¿‡ format æ§åˆ¶
â””â”€ ä¸¤ç§æ—¶é—´è¯­ä¹‰ï¼šç»å¯¹æ—¶é—´ vs ç›¸å¯¹æ—¶é—´
```

### 2. ä¸¤ç§æ—¶é—´ç±»å‹å¯¹æ¯”

| ç±»å‹ | Format ç¤ºä¾‹ | å­˜å‚¨å€¼ç¤ºä¾‹ | åº”ç”¨åœºæ™¯ |
|------|------------|-----------|---------|
| **ç»å¯¹æ—¶é—´** | `YYYY-MM-DD HH:mm:ss` | `1698825600000`ï¼ˆ2023-11-01 16:00:00ï¼‰ | åˆ›å»ºæ—¶é—´ã€å‘å¸ƒæ—¶é—´ã€è®¢å•æ—¶é—´ |
| **ç›¸å¯¹æ—¶é—´** | `HH:mm:ss` | `46800000`ï¼ˆ1970-01-01 13:00:00ï¼‰ | ä¸Šè¯¾æ—¶é—´ã€ä¸‹è¯¾æ—¶é—´ã€è¥ä¸šæ—¶é—´ |

### 3. Format åˆ°é€‰æ‹©å™¨çš„æ˜ å°„

| Format | Element Plus ç»„ä»¶ç±»å‹ | æ˜¾ç¤ºæ•ˆæœ | æ—¶é—´ç±»å‹ |
|--------|---------------------|---------|---------|
| `YYYY-MM-DD HH:mm:ss` | `datetime` | `2024-11-02 13:30:45` | ç»å¯¹ |
| `YYYY-MM-DD` | `date` | `2024-11-02` | ç»å¯¹ |
| `HH:mm:ss` | `time` | `13:30:45` | ç›¸å¯¹ |
| `HH:mm` | `time` | `13:30` | ç›¸å¯¹ |
| `YYYY-MM` | `month` | `2024-11` | ç»å¯¹ |
| `YYYY` | `year` | `2024` | ç»å¯¹ |

### 4. å‰ç«¯å®ç°ä¼ªä»£ç 

```typescript
class TimestampWidget extends BaseWidget {
  // ğŸ”¥ åˆ¤æ–­é€‰æ‹©å™¨ç±»å‹
  private getPickerType(): 'datetime' | 'date' | 'time' | 'month' | 'year' {
    const format = this.config.format || 'YYYY-MM-DD HH:mm:ss'
    
    if (format.includes('HH') || format.includes('mm') || format.includes('ss')) {
      if (format.includes('YYYY') || format.includes('MM') || format.includes('DD')) {
        return 'datetime'  // æ—¥æœŸæ—¶é—´é€‰æ‹©å™¨
      }
      return 'time'  // çº¯æ—¶é—´é€‰æ‹©å™¨ï¼ˆç›¸å¯¹æ—¶é—´ï¼‰
    }
    if (format === 'YYYY-MM') return 'month'
    if (format === 'YYYY') return 'year'
    return 'date'
  }

  // ğŸ”¥ åˆ¤æ–­æ˜¯å¦ä¸ºç›¸å¯¹æ—¶é—´
  private isRelativeTime(): boolean {
    const format = this.config.format || 'YYYY-MM-DD HH:mm:ss'
    // åªæœ‰æ—¶åˆ†ç§’ï¼Œæ²¡æœ‰å¹´æœˆæ—¥ â†’ ç›¸å¯¹æ—¶é—´
    return !(format.includes('YYYY') || format.includes('MM') || format.includes('DD'))
  }

  // ğŸ”¥ æ—¶é—´æˆ³ â†’ Date å¯¹è±¡ï¼ˆç”¨äºæ˜¾ç¤ºï¼‰
  private timestampToDate(timestamp: number): Date {
    return new Date(timestamp)  // æ¯«ç§’çº§æ—¶é—´æˆ³
  }

  // ğŸ”¥ Date å¯¹è±¡ â†’ æ—¶é—´æˆ³ï¼ˆç”¨äºæäº¤ï¼‰
  private dateToTimestamp(date: Date): number {
    if (this.isRelativeTime()) {
      // ç›¸å¯¹æ—¶é—´ï¼šåªå–æ—¶åˆ†ç§’ï¼Œæ—¥æœŸè®¾ä¸º 1970-01-01
      const hours = date.getHours()
      const minutes = date.getMinutes()
      const seconds = date.getSeconds()
      return (hours * 3600 + minutes * 60 + seconds) * 1000
    }
    
    // ç»å¯¹æ—¶é—´ï¼šå®Œæ•´æ—¶é—´æˆ³
    return date.getTime()
  }

  // ğŸ”¥ æäº¤æ—¶è½¬æ¢
  getRawValueForSubmit(): number | null {
    const currentValue = this.getValue()
    if (!currentValue?.raw) return null
    
    return typeof currentValue.raw === 'number' 
      ? currentValue.raw 
      : this.dateToTimestamp(new Date(currentValue.raw))
  }

  // ğŸ”¥ æ¸²æŸ“
  render() {
    const pickerType = this.getPickerType()
    const currentValue = this.getValue()
    const dateValue = currentValue?.raw 
      ? this.timestampToDate(currentValue.raw) 
      : null

    return h(ElDatePicker, {
      type: pickerType,
      modelValue: dateValue,
      format: this.config.format || 'YYYY-MM-DD HH:mm:ss',
      valueFormat: 'x',  // è¿”å›æ—¶é—´æˆ³ï¼ˆæ¯«ç§’ï¼‰
      disabled: this.config.disabled,
      placeholder: `è¯·é€‰æ‹©${this.field.name}`,
      onChange: (value: number | null) => {
        this.updateRawValue(value)
      }
    })
  }
}
```

### 5. ç›¸å¯¹æ—¶é—´çš„æ ¸å¿ƒé€»è¾‘

**ä¸ºä»€ä¹ˆç›¸å¯¹æ—¶é—´è¦å­˜å‚¨ä¸º 1970-01-01 çš„æ—¶é—´æˆ³ï¼Ÿ**

```typescript
// åœºæ™¯ï¼šè¯¾ç¨‹è¡¨çš„ä¸‹è¯¾æ—¶é—´

// âŒ é”™è¯¯æ–¹å¼ï¼šå­˜å‚¨å­—ç¬¦ä¸² "13:00:00"
// é—®é¢˜ï¼š
// 1. æ— æ³•æ’åºï¼ˆå­—ç¬¦ä¸²æ¯”è¾ƒä¸å‡†ç¡®ï¼‰
// 2. æ— æ³•è¿›è¡Œæ—¶é—´è®¡ç®—
// 3. æ•°æ®åº“ç´¢å¼•æ•ˆç‡ä½

// âœ… æ­£ç¡®æ–¹å¼ï¼šå­˜å‚¨ä¸º 1970-01-01 13:00:00 çš„æ—¶é—´æˆ³
const relativeTime = new Date('1970-01-01T13:00:00Z').getTime()  // 46800000

// ä¼˜åŠ¿ï¼š
// 1. å¯ä»¥ç›´æ¥æ’åºï¼ˆæ•°å­—æ¯”è¾ƒï¼‰
// 2. ä¸å—è®°å½•åˆ›å»ºæ—¥æœŸå½±å“
// 3. è·¨æ—¥æœŸå¯æ¯”è¾ƒ
// 4. æ•°æ®åº“åŸç”Ÿæ”¯æŒæ—¶é—´ç±»å‹

// å®é™…æ¡ˆä¾‹ï¼š
è®°å½•1ï¼š2024-10-01 åˆ›å»ºï¼Œä¸‹è¯¾æ—¶é—´ 13:00 â†’ å­˜å‚¨ 46800000
è®°å½•2ï¼š2025-11-01 åˆ›å»ºï¼Œä¸‹è¯¾æ—¶é—´ 12:30 â†’ å­˜å‚¨ 45000000

// æ’åºæŸ¥è¯¢ï¼šSELECT * FROM courses ORDER BY end_time
// ç»“æœï¼šè®°å½•2 (12:30) è‡ªåŠ¨æ’åœ¨ è®°å½•1 (13:00) å‰é¢ âœ…
```

### 6. å®ç°éš¾ç‚¹å’Œè§£å†³æ–¹æ¡ˆ

#### éš¾ç‚¹ 1ï¼šç›¸å¯¹æ—¶é—´çš„ UI å±•ç¤º

**é—®é¢˜**ï¼šElDatePicker çš„ `type="time"` å¯èƒ½ä¼šæ˜¾ç¤ºå®Œæ•´æ—¥æœŸ `1970-01-01 13:00:00`ï¼Œç”¨æˆ·ä¼šå›°æƒ‘ã€‚

**è§£å†³æ–¹æ¡ˆ**ï¼š
```typescript
// æ–¹æ¡ˆ 1ï¼šä½¿ç”¨ ElTimePickerï¼ˆæ¨èï¼‰
if (this.isRelativeTime()) {
  return h(ElTimePicker, {
    modelValue: currentValue?.raw,
    format: this.config.format,  // HH:mm:ss
    onChange: (value: Date) => {
      const timestamp = this.dateToTimestamp(value)
      this.updateRawValue(timestamp)
    }
  })
}

// æ–¹æ¡ˆ 2ï¼šè‡ªå®šä¹‰ format éšè—æ—¥æœŸéƒ¨åˆ†
// Element Plus ä¼šè‡ªåŠ¨æ ¹æ® format åªæ˜¾ç¤ºæ—¶é—´éƒ¨åˆ†
```

#### éš¾ç‚¹ 2ï¼šåˆå§‹åŒ–å€¼çš„ç±»å‹å…¼å®¹

**é—®é¢˜**ï¼šåç«¯å¯èƒ½è¿”å›æ•°å­—æˆ–å­—ç¬¦ä¸²ã€‚

**è§£å†³æ–¹æ¡ˆ**ï¼š
```typescript
initValue(backendValue: any) {
  if (!backendValue) {
    this.updateRawValue(null)
    return
  }
  
  const timestamp = typeof backendValue === 'string' 
    ? parseInt(backendValue, 10) 
    : backendValue
    
  this.updateRawValue(timestamp)
}
```

#### éš¾ç‚¹ 3ï¼šç±»å‹è½¬æ¢ç¡®ä¿è¿”å›æ•°å­—

**é—®é¢˜**ï¼šæäº¤æ—¶å¯èƒ½æ˜¯ Date å¯¹è±¡æˆ–å­—ç¬¦ä¸²ã€‚

**è§£å†³æ–¹æ¡ˆ**ï¼š
```typescript
protected convertValueByType(value: any): any {
  if (value === null || value === undefined || value === '') {
    return null
  }
  
  // Date å¯¹è±¡ â†’ æ—¶é—´æˆ³
  if (value instanceof Date) {
    return this.dateToTimestamp(value)
  }
  
  // å­—ç¬¦ä¸²/æ•°å­— â†’ æ•°å­—
  const timestamp = typeof value === 'string' 
    ? parseInt(value, 10) 
    : value
    
  return isNaN(timestamp) ? null : timestamp
}
```

### 7. æµ‹è¯•åœºæ™¯

#### ç»å¯¹æ—¶é—´æµ‹è¯•
```json
// è¾“å…¥ï¼š2024-11-02 13:30:45
// å­˜å‚¨ï¼š1698912645000
// æ˜¾ç¤ºï¼š2024-11-02 13:30:45 âœ…
```

#### ç›¸å¯¹æ—¶é—´æµ‹è¯•
```json
// è¾“å…¥ï¼š13:30:45
// å­˜å‚¨ï¼š48645000ï¼ˆ1970-01-01 13:30:45 çš„æ—¶é—´æˆ³ï¼‰
// æ˜¾ç¤ºï¼š13:30:45 âœ…

// æ’åºæµ‹è¯•ï¼š
// 12:30:00 (45000000) < 13:30:45 (48645000) < 14:00:00 (50400000) âœ…
```

#### è¾¹ç•Œæƒ…å†µæµ‹è¯•
```typescript
// null/undefined â†’ null âœ…
// ç©ºå­—ç¬¦ä¸² â†’ null âœ…
// æ— æ•ˆæ—¶é—´æˆ³ â†’ null âœ…
// disabled=true â†’ åªè¯»æ˜¾ç¤º âœ…
```

### 8. å¤æ‚åº¦è¯„ä¼°

| åŠŸèƒ½ç‚¹ | éš¾åº¦ | å·¥ä½œé‡ | ä¼˜å…ˆçº§ |
|--------|------|--------|--------|
| **åŸºç¡€æ¸²æŸ“** | â­â­ | 30 åˆ†é’Ÿ | P0 |
| **Format è§£æ** | â­â­ | 20 åˆ†é’Ÿ | P0 |
| **ç»å¯¹æ—¶é—´å¤„ç†** | â­ | 10 åˆ†é’Ÿ | P0 |
| **ç›¸å¯¹æ—¶é—´å¤„ç†** | â­â­â­ | 1 å°æ—¶ | P1 |
| **Disabled çŠ¶æ€** | â­ | 5 åˆ†é’Ÿ | P0 |
| **ç±»å‹è½¬æ¢** | â­â­ | 20 åˆ†é’Ÿ | P0 |
| **æ€»è®¡** | â­â­â­ | **2-2.5 å°æ—¶** | - |

### 9. å®ç°å»ºè®®

1. **å…ˆå®ç°ç»å¯¹æ—¶é—´**ï¼ˆ80% åœºæ™¯ï¼‰
   - `YYYY-MM-DD HH:mm:ss`
   - `YYYY-MM-DD`
   - `YYYY-MM`
   - `YYYY`

2. **å†å®ç°ç›¸å¯¹æ—¶é—´**ï¼ˆ20% åœºæ™¯ï¼‰
   - `HH:mm:ss`
   - `HH:mm`

3. **å……åˆ†æµ‹è¯•è¾¹ç•Œæƒ…å†µ**
   - null å€¼å¤„ç†
   - ç©ºå­—ç¬¦ä¸²å¤„ç†
   - æ— æ•ˆæ—¶é—´æˆ³å¤„ç†
   - ä¸åŒ format ç»„åˆ

4. **æ€§èƒ½ä¼˜åŒ–**
   - ç¼“å­˜ format è§£æç»“æœ
   - é¿å…é‡å¤çš„æ—¶é—´æˆ³è½¬æ¢

### 10. æ³¨å†Œåˆ° WidgetFactory

```typescript
// web/src/core/factories/WidgetFactory.ts
this.registerWidget('timestamp', TimestampWidget)
```

---

## æ€»ç»“

**Timestamp ç»„ä»¶çš„è®¾è®¡äº®ç‚¹**ï¼š
1. âœ… **ç»Ÿä¸€æ€§**ï¼šå”¯ä¸€çš„æ—¶é—´ç»„ä»¶ï¼Œé™ä½å­¦ä¹ æˆæœ¬
2. âœ… **çµæ´»æ€§**ï¼šé€šè¿‡ `format` æ”¯æŒæ‰€æœ‰æ—¶é—´ç±»å‹
3. âœ… **æ•°æ®ä¸€è‡´æ€§**ï¼šç»Ÿä¸€ç”¨æ—¶é—´æˆ³å­˜å‚¨ï¼Œä¾¿äºæ¯”è¾ƒå’Œæ’åº
4. âœ… **ç›¸å¯¹æ—¶é—´çš„å·§å¦™è®¾è®¡**ï¼š1970 åŸºå‡†æ—¥æœŸï¼Œå®Œç¾è§£å†³çº¯æ—¶é—´æ’åºé—®é¢˜
5. âœ… **æ‰©å±•æ€§**ï¼šç¬¦åˆç°æœ‰ Widget æ¶æ„ï¼Œå®ç°æˆæœ¬ä½