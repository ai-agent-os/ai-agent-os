# èšåˆè®¡ç®—ä¸æ¡ä»¶æ¸²æŸ“å®ç°åˆ†æ

## ä¸€ã€å½“å‰å®ç°åˆ†æ

### 1.1 èšåˆè®¡ç®—å½“å‰å®ç°

#### å®ç°ä½ç½®
- **TableWidget.ts** ä¸­çš„ `recalculateStatistics()` æ–¹æ³•
- ä½¿ç”¨ **ExpressionParser** è§£æå’Œè®¡ç®—è¡¨è¾¾å¼

#### æ ¸å¿ƒé€»è¾‘
```typescript
// TableWidget.ts
private recalculateStatistics(): void {
  const allRows = this.getAllRowsData()
  const result: Record<string, any> = {}
  
  for (const [label, expression] of Object.entries(this.statisticsConfig.value)) {
    const value = ExpressionParser.evaluate(expression, allRows)
    result[label] = value
  }
  
  this.statisticsResult.value = result
}
```

#### æ”¯æŒçš„è¡¨è¾¾å¼
- `sum(å­—æ®µ)` - æ±‚å’Œ
- `sum(å­—æ®µ1,*å­—æ®µ2)` - ä¹˜æ³•èšåˆ
- `avg(å­—æ®µ)` - å¹³å‡å€¼
- `count(å­—æ®µ)` - è®¡æ•°
- `min(å­—æ®µ)` / `max(å­—æ®µ)` - æœ€å€¼
- `list_sum(å­—æ®µ)` - List å±‚èšåˆ

### 1.2 æ¡ä»¶æ¸²æŸ“å½“å‰å®ç°

#### å®ç°ä½ç½®
- **FormRenderer.vue** ä¸­çš„ `shouldShowField()` å‡½æ•°
- ä½¿ç”¨ **conditionEvaluator.ts** è¯„ä¼°æ¡ä»¶

#### æ ¸å¿ƒé€»è¾‘
```typescript
// FormRenderer.vue
const fields = computed(() => {
  const allFields = props.functionDetail?.request || []
  
  return allFields.filter((field: FieldConfig) => {
    // æ¡ä»¶æ¸²æŸ“ï¼šæ ¹æ®å…¶ä»–å­—æ®µçš„å€¼å†³å®šæ˜¯å¦æ˜¾ç¤º
    if (!shouldShowField(field, formManager, allFields)) {
      return false
    }
    
    return true
  })
})
```

#### æ”¯æŒçš„æ¡ä»¶
- `required_if=å­—æ®µå,å€¼` - å½“æŸä¸ªå­—æ®µç­‰äºæŸä¸ªå€¼æ—¶å¿…å¡«
- `show_if=å­—æ®µå,å€¼` - å½“æŸä¸ªå­—æ®µç­‰äºæŸä¸ªå€¼æ—¶æ˜¾ç¤º
- `hide_if=å­—æ®µå,å€¼` - å½“æŸä¸ªå­—æ®µç­‰äºæŸä¸ªå€¼æ—¶éšè—

## äºŒã€ç»„ä»¶åŒ–åçš„å®ç°æ–¹æ¡ˆ

### 2.1 èšåˆè®¡ç®—å®ç°

#### æ–¹æ¡ˆA: ä½¿ç”¨ computedï¼ˆæ¨èï¼‰

**æ ¸å¿ƒæ€æƒ³**ï¼šä½¿ç”¨ Vue çš„ `computed` è‡ªåŠ¨è®¡ç®—ï¼Œå½“æ•°æ®å˜åŒ–æ—¶è‡ªåŠ¨é‡æ–°è®¡ç®—

#### å®ç°æ–¹å¼

```vue
<!-- TableWidget.vue -->
<script setup lang="ts">
import { computed, watch } from 'vue'
import { ExpressionParser } from '@/utils/ExpressionParser'
import { useFormDataStore } from '@/stores/formData'

const props = defineProps<WidgetComponentProps>()

const formDataStore = useFormDataStore()

// è¡¨æ ¼æ•°æ®
const tableData = computed(() => {
  return Array.isArray(props.modelValue?.raw) ? props.modelValue.raw : []
})

// èšåˆç»Ÿè®¡é…ç½®ï¼ˆä»å›è°ƒè·å–æˆ–ä» props ä¼ å…¥ï¼‰
const statisticsConfig = ref<Record<string, string>>({})

// ğŸ”¥ èšåˆç»Ÿè®¡ç»“æœï¼ˆä½¿ç”¨ computed è‡ªåŠ¨è®¡ç®—ï¼‰
const statisticsResult = computed(() => {
  if (!statisticsConfig.value || Object.keys(statisticsConfig.value).length === 0) {
    return {}
  }
  
  // è·å–æ‰€æœ‰è¡Œçš„æ•°æ®
  const allRows = getAllRowsData()
  
  // è®¡ç®—æ¯ä¸ªç»Ÿè®¡é¡¹
  const result: Record<string, any> = {}
  
  for (const [label, expression] of Object.entries(statisticsConfig.value)) {
    try {
      const value = ExpressionParser.evaluate(expression, allRows)
      result[label] = value
    } catch (error) {
      console.error(`è®¡ç®—å¤±è´¥: ${label} = ${expression}`, error)
      result[label] = 0
    }
  }
  
  return result
})

// è·å–æ‰€æœ‰è¡Œçš„æ•°æ®ï¼ˆç”¨äºèšåˆè®¡ç®—ï¼‰
function getAllRowsData(): any[] {
  const itemFields = props.field.children || []
  const rows: any[] = []
  
  tableData.value.forEach((row, index) => {
    const rowData: Record<string, any> = {}
    
    itemFields.forEach(itemField => {
      const itemFieldPath = `${props.fieldPath}[${index}].${itemField.code}`
      const itemValue = formDataStore.getValue(itemFieldPath)
      rowData[itemField.code] = itemValue?.raw
    })
    
    rows.push(rowData)
  })
  
  return rows
}

// ç›‘å¬æ•°æ®å˜åŒ–ï¼Œè‡ªåŠ¨é‡æ–°è®¡ç®—ï¼ˆcomputed ä¼šè‡ªåŠ¨å¤„ç†ï¼‰
watch(
  () => tableData.value,
  () => {
    // computed ä¼šè‡ªåŠ¨é‡æ–°è®¡ç®—ï¼Œè¿™é‡Œå¯ä»¥è§¦å‘äº‹ä»¶é€šçŸ¥çˆ¶ç»„ä»¶
    emit('statistics:updated', statisticsResult.value)
  },
  { deep: true }
)
</script>

<template>
  <div class="table-widget">
    <!-- è¡¨æ ¼ -->
    <el-table :data="tableData">
      <!-- ... -->
    </el-table>
    
    <!-- èšåˆç»Ÿè®¡ -->
    <div v-if="statisticsConfig && Object.keys(statisticsConfig).length > 0" class="statistics">
      <div
        v-for="(value, label) in statisticsResult"
        :key="label"
        class="statistics-item"
      >
        <span class="statistics-label">{{ label }}:</span>
        <span class="statistics-value">{{ value }}</span>
      </div>
    </div>
  </div>
</template>
```

#### å¤æ‚åº¦åˆ†æ

**å¤æ‚åº¦ï¼šä½** âœ…

**åŸå› **ï¼š
1. **ä½¿ç”¨ computed**ï¼šVue çš„ computed æœ‰è‡ªåŠ¨ç¼“å­˜ï¼Œæ€§èƒ½å¥½
2. **è‡ªåŠ¨æ›´æ–°**ï¼šå½“æ•°æ®å˜åŒ–æ—¶è‡ªåŠ¨é‡æ–°è®¡ç®—ï¼Œä¸éœ€è¦æ‰‹åŠ¨è°ƒç”¨
3. **é€»è¾‘æ¸…æ™°**ï¼šèšåˆè®¡ç®—é€»è¾‘é›†ä¸­åœ¨ç»„ä»¶å†…éƒ¨ï¼Œæ˜“äºç»´æŠ¤
4. **æ”¯æŒå¤æ‚è¡¨è¾¾å¼**ï¼šExpressionParser æ”¯æŒå¤æ‚çš„è¡¨è¾¾å¼è®¡ç®—

### 2.2 æ¡ä»¶æ¸²æŸ“å®ç°

#### æ–¹æ¡ˆA: ä½¿ç”¨ computed + Pinia Storeï¼ˆæ¨èï¼‰

**æ ¸å¿ƒæ€æƒ³**ï¼šä½¿ç”¨ `computed` æ ¹æ®æ¡ä»¶åŠ¨æ€è¿‡æ»¤å­—æ®µï¼Œæ¡ä»¶è¯„ä¼°å‡½æ•°ä» Store è¯»å–æ•°æ®

#### å®ç°æ–¹å¼

```vue
<!-- FormRenderer.vue -->
<script setup lang="ts">
import { computed } from 'vue'
import { useFormDataStore } from '@/stores/formData'
import { shouldShowField } from '@/utils/conditionEvaluator'

const props = defineProps<{
  functionDetail: FunctionDetail
}>()

const formDataStore = useFormDataStore()

// ğŸ”¥ æ‰€æœ‰å­—æ®µï¼ˆæœªè¿‡æ»¤ï¼‰
const allFields = computed(() => props.functionDetail?.request || [])

// ğŸ”¥ å¯è§å­—æ®µï¼ˆæ ¹æ®æ¡ä»¶æ¸²æŸ“è§„åˆ™è¿‡æ»¤ï¼‰
const visibleFields = computed(() => {
  return allFields.value.filter((field: FieldConfig) => {
    // æ¡ä»¶æ¸²æŸ“ï¼šæ ¹æ®å…¶ä»–å­—æ®µçš„å€¼å†³å®šæ˜¯å¦æ˜¾ç¤º
    return shouldShowField(field, formDataStore, allFields.value)
  })
})
</script>

<template>
  <el-form>
    <el-form-item
      v-for="field in visibleFields"
      :key="field.code"
      :label="field.name"
    >
      <component
        :is="getWidgetComponent(field.widget?.type || 'input')"
        :field="field"
        :model-value="formDataStore.getValue(field.code)"
        @update:model-value="(v) => formDataStore.setValue(field.code, v)"
        mode="edit"
      />
    </el-form-item>
  </el-form>
</template>
```

#### æ¡ä»¶è¯„ä¼°å‡½æ•°ï¼ˆéœ€è¦é€‚é… Storeï¼‰

```typescript
// utils/conditionEvaluator.ts
export function shouldShowField(
  field: FieldConfig,
  formDataStore: ReturnType<typeof useFormDataStore>,
  allFields: FieldConfig[]
): boolean {
  // æ£€æŸ¥å­—æ®µçš„ validation è§„åˆ™ä¸­æ˜¯å¦æœ‰æ¡ä»¶æ¸²æŸ“è§„åˆ™
  const validation = field.validation || ''
  
  // è§£æ show_if å’Œ hide_if è§„åˆ™
  const showIfMatch = validation.match(/show_if=([^,]+),([^,\s]+)/)
  const hideIfMatch = validation.match(/hide_if=([^,]+),([^,\s]+)/)
  
  if (showIfMatch) {
    const [, fieldCode, expectedValue] = showIfMatch
    const fieldValue = formDataStore.getValue(fieldCode)
    const actualValue = String(fieldValue?.raw || '')
    
    // åªæœ‰å½“å­—æ®µå€¼ç­‰äºæœŸæœ›å€¼æ—¶æ‰æ˜¾ç¤º
    return actualValue === expectedValue
  }
  
  if (hideIfMatch) {
    const [, fieldCode, expectedValue] = hideIfMatch
    const fieldValue = formDataStore.getValue(fieldCode)
    const actualValue = String(fieldValue?.raw || '')
    
    // å½“å­—æ®µå€¼ç­‰äºæœŸæœ›å€¼æ—¶ä¸æ˜¾ç¤º
    return actualValue !== expectedValue
  }
  
  // æ²¡æœ‰æ¡ä»¶è§„åˆ™ï¼Œé»˜è®¤æ˜¾ç¤º
  return true
}
```

#### å¤æ‚åº¦åˆ†æ

**å¤æ‚åº¦ï¼šä½** âœ…

**åŸå› **ï¼š
1. **ä½¿ç”¨ computed**ï¼šVue çš„ computed æœ‰è‡ªåŠ¨ç¼“å­˜ï¼Œæ€§èƒ½å¥½
2. **è‡ªåŠ¨æ›´æ–°**ï¼šå½“ä¾èµ–å­—æ®µå˜åŒ–æ—¶è‡ªåŠ¨é‡æ–°è®¡ç®—
3. **é€»è¾‘æ¸…æ™°**ï¼šæ¡ä»¶è¯„ä¼°é€»è¾‘é›†ä¸­åœ¨å·¥å…·å‡½æ•°ä¸­ï¼Œæ˜“äºç»´æŠ¤
4. **æ”¯æŒå¤æ‚æ¡ä»¶**ï¼šå¯ä»¥æ”¯æŒå¤šä¸ªæ¡ä»¶ç»„åˆ

### 2.3 åµŒå¥—åœºæ™¯æ”¯æŒ

#### åœºæ™¯1: è¡¨æ ¼ä¸­çš„æ¡ä»¶æ¸²æŸ“

```vue
<!-- TableWidget.vue -->
<script setup lang="ts">
// è¡¨æ ¼ä¸­çš„å­—æ®µä¹Ÿéœ€è¦æ”¯æŒæ¡ä»¶æ¸²æŸ“
const visibleItemFields = computed(() => {
  const itemFields = props.field.children || []
  
  return itemFields.filter((itemField: FieldConfig) => {
    // æ¡ä»¶æ¸²æŸ“ï¼šæ ¹æ®å½“å‰è¡Œçš„å…¶ä»–å­—æ®µå€¼å†³å®šæ˜¯å¦æ˜¾ç¤º
    return shouldShowFieldInTable(itemField, currentRowData, itemFields)
  })
})

function shouldShowFieldInTable(
  field: FieldConfig,
  rowData: any,
  allFields: FieldConfig[]
): boolean {
  // ä» rowData ä¸­è¯»å–å­—æ®µå€¼ï¼Œè€Œä¸æ˜¯ä» Store
  const validation = field.validation || ''
  const showIfMatch = validation.match(/show_if=([^,]+),([^,\s]+)/)
  
  if (showIfMatch) {
    const [, fieldCode, expectedValue] = showIfMatch
    const actualValue = String(rowData[fieldCode] || '')
    return actualValue === expectedValue
  }
  
  return true
}
</script>
```

#### åœºæ™¯2: è¡¨å•ä¸­çš„æ¡ä»¶æ¸²æŸ“

```vue
<!-- FormWidget.vue -->
<script setup lang="ts">
// è¡¨å•ä¸­çš„å­—æ®µä¹Ÿéœ€è¦æ”¯æŒæ¡ä»¶æ¸²æŸ“
const visibleSubFields = computed(() => {
  const subFields = props.field.children || []
  
  return subFields.filter((subField: FieldConfig) => {
    // æ¡ä»¶æ¸²æŸ“ï¼šæ ¹æ®è¡¨å•ä¸­å…¶ä»–å­—æ®µçš„å€¼å†³å®šæ˜¯å¦æ˜¾ç¤º
    return shouldShowFieldInForm(subField, formDataStore, subFields)
  })
})
</script>
```

## ä¸‰ã€å®ç°å¤æ‚åº¦è¯„ä¼°

### 3.1 èšåˆè®¡ç®—

| æ–¹é¢ | å¤æ‚åº¦ | è¯´æ˜ |
|------|--------|------|
| å®ç°éš¾åº¦ | â­â­ ä½ | ä½¿ç”¨ computedï¼Œé€»è¾‘æ¸…æ™° |
| æ€§èƒ½ | âœ… ä¼˜ç§€ | computed æœ‰è‡ªåŠ¨ç¼“å­˜ |
| ç»´æŠ¤æ€§ | âœ… ä¼˜ç§€ | é€»è¾‘é›†ä¸­åœ¨ç»„ä»¶å†…éƒ¨ |
| æ‰©å±•æ€§ | âœ… ä¼˜ç§€ | æ”¯æŒæ–°å¢è¡¨è¾¾å¼ç±»å‹ |

**æ€»ç»“**ï¼šâœ… **å¾ˆå®¹æ˜“å®ç°**

### 3.2 æ¡ä»¶æ¸²æŸ“

| æ–¹é¢ | å¤æ‚åº¦ | è¯´æ˜ |
|------|--------|------|
| å®ç°éš¾åº¦ | â­â­ ä½ | ä½¿ç”¨ computed + å·¥å…·å‡½æ•° |
| æ€§èƒ½ | âœ… ä¼˜ç§€ | computed æœ‰è‡ªåŠ¨ç¼“å­˜ |
| ç»´æŠ¤æ€§ | âœ… ä¼˜ç§€ | é€»è¾‘é›†ä¸­åœ¨å·¥å…·å‡½æ•°ä¸­ |
| æ‰©å±•æ€§ | âœ… ä¼˜ç§€ | æ”¯æŒæ–°å¢æ¡ä»¶ç±»å‹ |

**æ€»ç»“**ï¼šâœ… **å¾ˆå®¹æ˜“å®ç°**

## å››ã€å®Œæ•´å®ç°ç¤ºä¾‹

### 4.1 èšåˆè®¡ç®—å®Œæ•´å®ç°

```vue
<!-- TableWidget.vue -->
<script setup lang="ts">
import { computed, ref, watch } from 'vue'
import { ExpressionParser } from '@/utils/ExpressionParser'
import { useFormDataStore } from '@/stores/formData'

const props = defineProps<WidgetComponentProps>()
const emit = defineEmits<{
  'update:modelValue': [value: FieldValue]
  'statistics:updated': [statistics: Record<string, any>]
}>()

const formDataStore = useFormDataStore()

// è¡¨æ ¼æ•°æ®
const tableData = computed({
  get: () => Array.isArray(props.modelValue?.raw) ? props.modelValue.raw : [],
  set: (newValue) => {
    emit('update:modelValue', {
      raw: newValue,
      display: `å…± ${newValue.length} æ¡`,
      meta: {}
    })
  }
})

// èšåˆç»Ÿè®¡é…ç½®ï¼ˆä»å›è°ƒè·å–ï¼‰
const statisticsConfig = ref<Record<string, string>>({})

// ğŸ”¥ èšåˆç»Ÿè®¡ç»“æœï¼ˆä½¿ç”¨ computed è‡ªåŠ¨è®¡ç®—ï¼‰
const statisticsResult = computed(() => {
  if (!statisticsConfig.value || Object.keys(statisticsConfig.value).length === 0) {
    return {}
  }
  
  try {
    const allRows = getAllRowsData()
    const result: Record<string, any> = {}
    
    for (const [label, expression] of Object.entries(statisticsConfig.value)) {
      try {
        const value = ExpressionParser.evaluate(expression, allRows)
        result[label] = value
      } catch (error) {
        console.error(`[TableWidget] è®¡ç®—å¤±è´¥: ${label} = ${expression}`, error)
        result[label] = 0
      }
    }
    
    return result
  } catch (error) {
    console.error('[TableWidget] èšåˆè®¡ç®—å¤±è´¥', error)
    return {}
  }
})

// è·å–æ‰€æœ‰è¡Œçš„æ•°æ®
function getAllRowsData(): any[] {
  const itemFields = props.field.children || []
  const rows: any[] = []
  
  tableData.value.forEach((row, index) => {
    const rowData: Record<string, any> = {}
    
    itemFields.forEach(itemField => {
      const itemFieldPath = `${props.fieldPath}[${index}].${itemField.code}`
      const itemValue = formDataStore.getValue(itemFieldPath)
      rowData[itemField.code] = itemValue?.raw
    })
    
    rows.push(rowData)
  })
  
  return rows
}

// ç›‘å¬æ•°æ®å˜åŒ–ï¼Œé€šçŸ¥çˆ¶ç»„ä»¶
watch(
  statisticsResult,
  (newStatistics) => {
    emit('statistics:updated', newStatistics)
  },
  { deep: true }
)
</script>

<template>
  <div class="table-widget">
    <!-- è¡¨æ ¼ -->
    <el-table :data="tableData">
      <!-- ... -->
    </el-table>
    
    <!-- èšåˆç»Ÿè®¡ -->
    <div v-if="statisticsConfig && Object.keys(statisticsConfig).length > 0" class="statistics">
      <div
        v-for="(value, label) in statisticsResult"
        :key="label"
        class="statistics-item"
      >
        <span class="statistics-label">{{ label }}:</span>
        <span class="statistics-value">{{ value }}</span>
      </div>
    </div>
  </div>
</template>
```

### 4.2 æ¡ä»¶æ¸²æŸ“å®Œæ•´å®ç°

```vue
<!-- FormRenderer.vue -->
<script setup lang="ts">
import { computed } from 'vue'
import { useFormDataStore } from '@/stores/formData'
import { shouldShowField } from '@/utils/conditionEvaluator'

const props = defineProps<{
  functionDetail: FunctionDetail
}>()

const formDataStore = useFormDataStore()

// æ‰€æœ‰å­—æ®µ
const allFields = computed(() => props.functionDetail?.request || [])

// ğŸ”¥ å¯è§å­—æ®µï¼ˆæ ¹æ®æ¡ä»¶æ¸²æŸ“è§„åˆ™è¿‡æ»¤ï¼‰
const visibleFields = computed(() => {
  // ğŸ”¥ ä¾èµ– formDataStore.dataï¼Œå½“æ•°æ®å˜åŒ–æ—¶è‡ªåŠ¨é‡æ–°è®¡ç®—
  const _ = formDataStore.data  // è§¦å‘å“åº”å¼è¿½è¸ª
  
  return allFields.value.filter((field: FieldConfig) => {
    // æ¡ä»¶æ¸²æŸ“ï¼šæ ¹æ®å…¶ä»–å­—æ®µçš„å€¼å†³å®šæ˜¯å¦æ˜¾ç¤º
    return shouldShowField(field, formDataStore, allFields.value)
  })
})
</script>

<template>
  <el-form>
    <el-form-item
      v-for="field in visibleFields"
      :key="field.code"
      :label="field.name"
    >
      <component
        :is="getWidgetComponent(field.widget?.type || 'input')"
        :field="field"
        :model-value="formDataStore.getValue(field.code)"
        @update:model-value="(v) => formDataStore.setValue(field.code, v)"
        mode="edit"
      />
    </el-form-item>
  </el-form>
</template>
```

### 4.3 æ¡ä»¶è¯„ä¼°å‡½æ•°é€‚é… Store

```typescript
// utils/conditionEvaluator.ts
import type { FieldConfig } from '../types/field'
import type { ReturnType } from 'vue'
import { useFormDataStore } from '@/stores/formData'

export function shouldShowField(
  field: FieldConfig,
  formDataStore: ReturnType<typeof useFormDataStore>,
  allFields: FieldConfig[]
): boolean {
  const validation = field.validation || ''
  
  // è§£æ show_if è§„åˆ™
  const showIfMatch = validation.match(/show_if=([^,]+),([^,\s]+)/)
  if (showIfMatch) {
    const [, fieldCode, expectedValue] = showIfMatch
    const fieldValue = formDataStore.getValue(fieldCode)
    const actualValue = String(fieldValue?.raw || '')
    return actualValue === expectedValue
  }
  
  // è§£æ hide_if è§„åˆ™
  const hideIfMatch = validation.match(/hide_if=([^,]+),([^,\s]+)/)
  if (hideIfMatch) {
    const [, fieldCode, expectedValue] = hideIfMatch
    const fieldValue = formDataStore.getValue(fieldCode)
    const actualValue = String(fieldValue?.raw || '')
    return actualValue !== expectedValue
  }
  
  // è§£æå¤æ‚æ¡ä»¶ï¼ˆæ”¯æŒå¤šä¸ªæ¡ä»¶ï¼‰
  const complexMatch = validation.match(/show_if=([^,]+),([^,\s]+)(?:,([^,\s]+))?/)
  if (complexMatch) {
    // æ”¯æŒå¤šä¸ªæ¡ä»¶ï¼šshow_if=field1,value1,field2,value2
    // ...
  }
  
  // é»˜è®¤æ˜¾ç¤º
  return true
}
```

## äº”ã€ä¼˜åŠ¿åˆ†æ

### 5.1 èšåˆè®¡ç®—ä¼˜åŠ¿

1. âœ… **è‡ªåŠ¨è®¡ç®—**ï¼šä½¿ç”¨ `computed`ï¼Œå½“æ•°æ®å˜åŒ–æ—¶è‡ªåŠ¨é‡æ–°è®¡ç®—
2. âœ… **æ€§èƒ½å¥½**ï¼šcomputed æœ‰è‡ªåŠ¨ç¼“å­˜ï¼Œé¿å…é‡å¤è®¡ç®—
3. âœ… **é€»è¾‘æ¸…æ™°**ï¼šèšåˆè®¡ç®—é€»è¾‘é›†ä¸­åœ¨ç»„ä»¶å†…éƒ¨
4. âœ… **æ˜“äºæ‰©å±•**ï¼šæ”¯æŒæ–°å¢è¡¨è¾¾å¼ç±»å‹

### 5.2 æ¡ä»¶æ¸²æŸ“ä¼˜åŠ¿

1. âœ… **è‡ªåŠ¨æ›´æ–°**ï¼šä½¿ç”¨ `computed`ï¼Œå½“ä¾èµ–å­—æ®µå˜åŒ–æ—¶è‡ªåŠ¨é‡æ–°è®¡ç®—
2. âœ… **æ€§èƒ½å¥½**ï¼šcomputed æœ‰è‡ªåŠ¨ç¼“å­˜
3. âœ… **é€»è¾‘æ¸…æ™°**ï¼šæ¡ä»¶è¯„ä¼°é€»è¾‘é›†ä¸­åœ¨å·¥å…·å‡½æ•°ä¸­
4. âœ… **æ”¯æŒåµŒå¥—**ï¼šå¯ä»¥åœ¨è¡¨æ ¼ã€è¡¨å•ç­‰åµŒå¥—åœºæ™¯ä¸­ä½¿ç”¨

## å…­ã€å¤æ‚åº¦æ€»ç»“

### 6.1 èšåˆè®¡ç®—

**å¤æ‚åº¦ï¼šä½** âœ…

**å®ç°éš¾åº¦**ï¼šâ­â­ï¼ˆç®€å•ï¼‰

**åŸå› **ï¼š
- ä½¿ç”¨ `computed`ï¼Œé€»è¾‘æ¸…æ™°
- ExpressionParser å·²ç»å­˜åœ¨ï¼Œå¯ä»¥ç›´æ¥ä½¿ç”¨
- åªéœ€è¦é€‚é… Store çš„æ•°æ®è¯»å–æ–¹å¼

### 6.2 æ¡ä»¶æ¸²æŸ“

**å¤æ‚åº¦ï¼šä½** âœ…

**å®ç°éš¾åº¦**ï¼šâ­â­ï¼ˆç®€å•ï¼‰

**åŸå› **ï¼š
- ä½¿ç”¨ `computed`ï¼Œé€»è¾‘æ¸…æ™°
- conditionEvaluator å·²ç»å­˜åœ¨ï¼Œåªéœ€è¦é€‚é… Store
- æ”¯æŒåµŒå¥—åœºæ™¯

## ä¸ƒã€æ€»ç»“

### 7.1 èšåˆè®¡ç®—

âœ… **å¾ˆå®¹æ˜“å®ç°**

**å®ç°æ–¹å¼**ï¼š
- ä½¿ç”¨ `computed` è‡ªåŠ¨è®¡ç®—
- ä» Pinia Store è¯»å–æ•°æ®
- ä½¿ç”¨ ExpressionParser è®¡ç®—è¡¨è¾¾å¼

**ä¼˜åŠ¿**ï¼š
- è‡ªåŠ¨æ›´æ–°
- æ€§èƒ½å¥½
- æ˜“äºç»´æŠ¤

### 7.2 æ¡ä»¶æ¸²æŸ“

âœ… **å¾ˆå®¹æ˜“å®ç°**

**å®ç°æ–¹å¼**ï¼š
- ä½¿ç”¨ `computed` åŠ¨æ€è¿‡æ»¤å­—æ®µ
- ä» Pinia Store è¯»å–ä¾èµ–å­—æ®µçš„å€¼
- ä½¿ç”¨ conditionEvaluator è¯„ä¼°æ¡ä»¶

**ä¼˜åŠ¿**ï¼š
- è‡ªåŠ¨æ›´æ–°
- æ€§èƒ½å¥½
- æ”¯æŒåµŒå¥—åœºæ™¯

### 7.3 å®Œå…¨é‡å†™å»ºè®®

**å»ºè®®**ï¼š
1. âœ… **èšåˆè®¡ç®—**ï¼šä½¿ç”¨ `computed` + ExpressionParser
2. âœ… **æ¡ä»¶æ¸²æŸ“**ï¼šä½¿ç”¨ `computed` + conditionEvaluator
3. âœ… **ä¸å¤ç”¨æ—§é€»è¾‘**ï¼šå®Œå…¨é‡å†™ï¼Œä½†å¯ä»¥å¤ç”¨å·¥å…·å‡½æ•°ï¼ˆExpressionParserã€conditionEvaluatorï¼‰
4. âœ… **é€‚é… Store**ï¼šå·¥å…·å‡½æ•°éœ€è¦é€‚é… Pinia Store çš„æ•°æ®è¯»å–æ–¹å¼

## å…«ã€æ³¨æ„äº‹é¡¹

### 8.1 å·¥å…·å‡½æ•°é€‚é…

**éœ€è¦é€‚é…çš„å·¥å…·å‡½æ•°**ï¼š
- `ExpressionParser` - éœ€è¦é€‚é…æ•°æ®æ¥æºï¼ˆä» Store è¯»å–ï¼‰
- `conditionEvaluator` - éœ€è¦é€‚é…æ•°æ®æ¥æºï¼ˆä» Store è¯»å–ï¼‰

**é€‚é…æ–¹å¼**ï¼š
- ä¸ä¿®æ”¹å·¥å…·å‡½æ•°çš„é€»è¾‘
- åªä¿®æ”¹æ•°æ®è¯»å–æ–¹å¼ï¼ˆä» formManager æ”¹ä¸º formDataStoreï¼‰

### 8.2 æ€§èƒ½ä¼˜åŒ–

**ä¼˜åŒ–ç‚¹**ï¼š
- ä½¿ç”¨ `computed` è‡ªåŠ¨ç¼“å­˜
- ä½¿ç”¨ `v-memo` ä¼˜åŒ–ç»„ä»¶æ¸²æŸ“
- é¿å…ä¸å¿…è¦çš„é‡æ–°è®¡ç®—

### 8.3 åµŒå¥—åœºæ™¯

**æ³¨æ„äº‹é¡¹**ï¼š
- è¡¨æ ¼ä¸­çš„æ¡ä»¶æ¸²æŸ“éœ€è¦ä» rowData è¯»å–
- è¡¨å•ä¸­çš„æ¡ä»¶æ¸²æŸ“éœ€è¦ä» Store è¯»å–
- éœ€è¦åŒºåˆ†ä¸åŒçš„æ•°æ®æ¥æº

