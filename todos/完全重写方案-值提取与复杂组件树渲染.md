# å®Œå…¨é‡å†™æ–¹æ¡ˆ - å€¼æå–ä¸å¤æ‚ç»„ä»¶æ ‘æ¸²æŸ“

## ä¸€ã€æ ¸å¿ƒåŸåˆ™

### 1.1 å®Œå…¨é‡å†™ï¼Œä¸å¤ç”¨æ—§é€»è¾‘

**åŸåˆ™**ï¼š
- âŒ ä¸å¤åˆ¶ç²˜è´´æ—§ä»£ç 
- âŒ ä¸ä¸ºäº†å…¼å®¹è€Œä¿ç•™æ—§é€»è¾‘
- âœ… ä»é›¶å¼€å§‹ï¼Œè®¾è®¡æœ€ä¼˜æ–¹æ¡ˆ
- âœ… åŸºäº Vue 3 æœ€ä½³å®è·µ
- âœ… ä¿è¯å¤æ‚ç»„ä»¶æ ‘å¯ä»¥æ­£å¸¸æ¸²æŸ“

### 1.2 å¤æ‚ç»„ä»¶æ ‘æ”¯æŒ

**åœºæ™¯**ï¼š
- æ·±å±‚åµŒå¥—ï¼š`form > table > form > table > input`
- æ•°ç»„åµŒå¥—ï¼š`table[0].products[1].items[2].name`
- æ¡ä»¶æ¸²æŸ“ï¼šæ ¹æ®å…¶ä»–å­—æ®µå€¼åŠ¨æ€æ˜¾ç¤º/éšè—
- åŠ¨æ€å­—æ®µï¼šæ ¹æ®å›è°ƒæ¥å£åŠ¨æ€æ·»åŠ å­—æ®µ

## äºŒã€å½“å‰å€¼æå–æœºåˆ¶åˆ†æ

### 2.1 å½“å‰å®ç°æ–¹å¼

#### æ–¹å¼ï¼šWidget çš„ `getRawValueForSubmit()` æ–¹æ³•

```typescript
// FormRenderer.vue
function prepareSubmitDataWithTypeConversion(): Record<string, any> {
  const result: Record<string, any> = {}
  
  fields.value.forEach((field: FieldConfig) => {
    const fieldPath = field.code
    const widget = allWidgets.get(fieldPath)
    
    if (widget) {
      result[fieldPath] = widget.getRawValueForSubmit()  // ğŸ”¥ é€’å½’è°ƒç”¨
    }
  })
  
  return result
}
```

#### é€’å½’æ”¶é›†æœºåˆ¶

```typescript
// BaseWidget.ts
getRawValueForSubmit(): any {
  // åŸºç¡€ç»„ä»¶ï¼šç›´æ¥è¿”å› raw å€¼
  return this.getValue().raw
}

// FormWidget.ts
getRawValueForSubmit(): Record<string, any> {
  const result: Record<string, any> = {}
  
  // éå†å­ Widgetï¼Œé€’å½’æ”¶é›†
  this.subWidgets.forEach((widget, fieldCode) => {
    result[fieldCode] = widget.getRawValueForSubmit()  // ğŸ”¥ é€’å½’
  })
  
  return result
}

// TableWidget.ts
getRawValueForSubmit(): any[] {
  // è¿”å›æ•°ç»„ï¼Œæ¯ä¸ªå…ƒç´ æ˜¯ SavedRowData
  return this.savedData.value.map(row => {
    // æ¯è¡Œçš„æ•°æ®å·²ç»æ˜¯ FieldValue æ ¼å¼
    return row
  })
}
```

### 2.2 å½“å‰å®ç°çš„ä¼˜ç¼ºç‚¹

#### ä¼˜ç‚¹
1. âœ… **é€’å½’è‡ªåŠ¨å¤„ç†**ï¼šå®¹å™¨ç»„ä»¶è‡ªåŠ¨é€’å½’æ”¶é›†å­ç»„ä»¶æ•°æ®
2. âœ… **ç±»å‹è½¬æ¢**ï¼šWidget è‡ªå·±å¤„ç†ç±»å‹è½¬æ¢
3. âœ… **æ”¯æŒä»»æ„æ·±åº¦**ï¼šç†è®ºä¸Šæ”¯æŒæ— é™åµŒå¥—

#### ç¼ºç‚¹
1. âŒ **ä¾èµ– Widget å®ä¾‹**ï¼šéœ€è¦ä» `allWidgets` Map ä¸­è·å– Widget
2. âŒ **ç»„ä»¶åŒ–åä¸é€‚ç”¨**ï¼šVue ç»„ä»¶æ²¡æœ‰ `getRawValueForSubmit()` æ–¹æ³•
3. âŒ **çŠ¶æ€ç®¡ç†åˆ†æ•£**ï¼šæ•°æ®åˆ†æ•£åœ¨å„ä¸ª Widget å®ä¾‹ä¸­

## ä¸‰ã€ç»„ä»¶åŒ–åçš„å€¼æå–æ–¹æ¡ˆ

### 3.1 æ–¹æ¡ˆA: Pinia Store é›†ä¸­ç®¡ç†ï¼ˆæ¨èï¼‰

#### æ ¸å¿ƒæ€æƒ³
- æ‰€æœ‰ç»„ä»¶çš„æ•°æ®éƒ½å­˜å‚¨åœ¨ Pinia Store ä¸­
- æäº¤æ—¶ç›´æ¥ä» Store ä¸­æå–æ•°æ®
- ä¸éœ€è¦éå†ç»„ä»¶å®ä¾‹

#### å®ç°æ–¹å¼

```typescript
// stores/formData.ts
export const useFormDataStore = defineStore('formData', () => {
  // å­˜å‚¨æ‰€æœ‰å­—æ®µçš„å€¼ï¼ˆfield_path -> FieldValueï¼‰
  const data = reactive<Map<string, FieldValue>>(new Map())
  
  // è®¾ç½®å€¼
  function setValue(fieldPath: string, value: FieldValue) {
    data.set(fieldPath, value)
  }
  
  // è·å–å€¼
  function getValue(fieldPath: string): FieldValue {
    return data.get(fieldPath) || { raw: null, display: '', meta: {} }
  }
  
  // ğŸ”¥ æå–æäº¤æ•°æ®ï¼ˆé€’å½’æ”¶é›†ï¼‰
  function getSubmitData(fields: FieldConfig[]): Record<string, any> {
    const result: Record<string, any> = {}
    
    fields.forEach(field => {
      const fieldPath = field.code
      const value = data.get(fieldPath)
      
      if (!value) {
        // å­—æ®µä¸å­˜åœ¨ï¼Œè·³è¿‡
        return
      }
      
      // æ ¹æ®å­—æ®µç±»å‹å†³å®šå¦‚ä½•æå–
      if (field.widget?.type === 'table') {
        // è¡¨æ ¼ç±»å‹ï¼šé€’å½’æ”¶é›†æ¯è¡Œçš„æ•°æ®
        result[fieldPath] = extractTableData(field, value)
      } else if (field.widget?.type === 'form') {
        // è¡¨å•ç±»å‹ï¼šé€’å½’æ”¶é›†å­å­—æ®µçš„æ•°æ®
        result[fieldPath] = extractFormData(field, value)
      } else {
        // åŸºç¡€ç±»å‹ï¼šç›´æ¥è¿”å› raw å€¼
        result[fieldPath] = value.raw
      }
    })
    
    return result
  }
  
  // é€’å½’æå–è¡¨æ ¼æ•°æ®
  function extractTableData(field: FieldConfig, value: FieldValue): any[] {
    const tableData = Array.isArray(value.raw) ? value.raw : []
    const itemFields = field.children || []
    
    return tableData.map((row, index) => {
      const rowData: Record<string, any> = {}
      
      itemFields.forEach(itemField => {
        const itemFieldPath = `${field.code}[${index}].${itemField.code}`
        const itemValue = data.get(itemFieldPath)
        
        if (itemValue) {
          // é€’å½’å¤„ç†åµŒå¥—ç»“æ„
          if (itemField.widget?.type === 'form') {
            rowData[itemField.code] = extractFormData(itemField, itemValue)
          } else if (itemField.widget?.type === 'table') {
            rowData[itemField.code] = extractTableData(itemField, itemValue)
          } else {
            rowData[itemField.code] = itemValue.raw
          }
        }
      })
      
      return rowData
    })
  }
  
  // é€’å½’æå–è¡¨å•æ•°æ®
  function extractFormData(field: FieldConfig, value: FieldValue): Record<string, any> {
    const formData: Record<string, any> = {}
    const subFields = field.children || []
    
    subFields.forEach(subField => {
      const subFieldPath = `${field.code}.${subField.code}`
      const subValue = data.get(subFieldPath)
      
      if (subValue) {
        // é€’å½’å¤„ç†åµŒå¥—ç»“æ„
        if (subField.widget?.type === 'form') {
          formData[subField.code] = extractFormData(subField, subValue)
        } else if (subField.widget?.type === 'table') {
          formData[subField.code] = extractTableData(subField, subValue)
        } else {
          formData[subField.code] = subValue.raw
        }
      }
    })
    
    return formData
  }
  
  return {
    data,
    setValue,
    getValue,
    getSubmitData
  }
})
```

#### ä½¿ç”¨æ–¹å¼

```vue
<!-- FormRenderer.vue -->
<script setup lang="ts">
import { useFormDataStore } from '@/stores/formData'

const formDataStore = useFormDataStore()

// æäº¤æ—¶æå–æ•°æ®
function handleSubmit() {
  const submitData = formDataStore.getSubmitData(fields.value)
  // æäº¤åˆ°åç«¯
}
</script>
```

#### å¤æ‚åº¦åˆ†æ

**å¤æ‚åº¦ï¼šä½** âœ…

**åŸå› **ï¼š
1. **é›†ä¸­ç®¡ç†**ï¼šæ‰€æœ‰æ•°æ®åœ¨ä¸€ä¸ª Store ä¸­ï¼Œä¸éœ€è¦éå†ç»„ä»¶å®ä¾‹
2. **é€’å½’ç®€å•**ï¼šé€’å½’é€»è¾‘æ¸…æ™°ï¼Œæ˜“äºç†è§£å’Œç»´æŠ¤
3. **æ€§èƒ½å¥½**ï¼šç›´æ¥ä» Store è¯»å–ï¼Œä¸éœ€è¦è°ƒç”¨ç»„ä»¶æ–¹æ³•

### 3.2 æ–¹æ¡ˆB: ç»„ä»¶ expose æ–¹æ³•

#### æ ¸å¿ƒæ€æƒ³
- æ¯ä¸ªç»„ä»¶ expose `getSubmitValue()` æ–¹æ³•
- æäº¤æ—¶è°ƒç”¨é¡¶å±‚ç»„ä»¶çš„ `getSubmitValue()`
- ç»„ä»¶å†…éƒ¨é€’å½’è°ƒç”¨å­ç»„ä»¶çš„ `getSubmitValue()`

#### å®ç°æ–¹å¼

```vue
<!-- TableWidget.vue -->
<script setup lang="ts">
import { ref, computed } from 'vue'

const props = defineProps<WidgetComponentProps>()

// å†…éƒ¨çŠ¶æ€
const tableData = ref<any[]>([])

// å­ç»„ä»¶å¼•ç”¨
const childComponents = ref<Map<string, any>>(new Map())

// æ³¨å†Œå­ç»„ä»¶
function registerChild(fieldCode: string, component: any) {
  childComponents.value.set(fieldCode, component)
}

// æå–æäº¤å€¼
function getSubmitValue(): any[] {
  if (props.mode !== 'edit') {
    // éç¼–è¾‘æ¨¡å¼ï¼Œè¿”å›åªè¯»æ•°æ®
    return Array.isArray(props.value?.raw) ? props.value.raw : []
  }
  
  // ç¼–è¾‘æ¨¡å¼ï¼šä»å­ç»„ä»¶æ”¶é›†æ•°æ®
  const result: any[] = []
  const itemFields = props.field.children || []
  
  tableData.value.forEach((row, rowIndex) => {
    const rowData: Record<string, any> = {}
    
    itemFields.forEach(itemField => {
      const childComponent = childComponents.value.get(`${rowIndex}_${itemField.code}`)
      
      if (childComponent && typeof childComponent.getSubmitValue === 'function') {
        rowData[itemField.code] = childComponent.getSubmitValue()
      } else {
        rowData[itemField.code] = row[itemField.code]
      }
    })
    
    result.push(rowData)
  })
  
  return result
}

// æš´éœ²æ–¹æ³•
defineExpose({
  getSubmitValue
})
</script>
```

#### å¤æ‚åº¦åˆ†æ

**å¤æ‚åº¦ï¼šä¸­** âš ï¸

**åŸå› **ï¼š
1. **éœ€è¦ç»´æŠ¤ç»„ä»¶å¼•ç”¨**ï¼šéœ€è¦æ³¨å†Œå’Œè¿½è¸ªå­ç»„ä»¶
2. **é€’å½’è°ƒç”¨**ï¼šéœ€è¦é€’å½’è°ƒç”¨å­ç»„ä»¶çš„æ–¹æ³•
3. **çŠ¶æ€ç®¡ç†**ï¼šç»„ä»¶å†…éƒ¨éœ€è¦ç®¡ç†å­ç»„ä»¶å¼•ç”¨

### 3.3 æ–¹æ¡ˆC: å“åº”å¼æ•°æ®æµï¼ˆæœ€ä¼˜ï¼‰

#### æ ¸å¿ƒæ€æƒ³
- ä½¿ç”¨ `v-model` åŒå‘ç»‘å®š
- æ•°æ®è‡ªåŠ¨åŒæ­¥åˆ°çˆ¶ç»„ä»¶
- æäº¤æ—¶ç›´æ¥ä» props ä¸­æå–

#### å®ç°æ–¹å¼

```vue
<!-- TableWidget.vue -->
<script setup lang="ts">
interface Props {
  field: FieldConfig
  modelValue: FieldValue  // ğŸ”¥ ä½¿ç”¨ v-model
  mode: 'edit' | 'response' | 'table-cell' | 'detail'
  // ...
}

const props = defineProps<Props>()
const emit = defineEmits<{
  'update:modelValue': [value: FieldValue]
}>()

// å†…éƒ¨çŠ¶æ€
const tableData = computed({
  get: () => Array.isArray(props.modelValue?.raw) ? props.modelValue.raw : [],
  set: (newValue) => {
    emit('update:modelValue', {
      raw: newValue,
      display: `å…± ${newValue.length} æ¡`,
      meta: {}
    })
  }
})

// å­ç»„ä»¶ä¹Ÿä½¿ç”¨ v-model
function handleChildUpdate(fieldCode: string, value: FieldValue) {
  const currentData = [...tableData.value]
  // æ›´æ–°å¯¹åº”å­—æ®µçš„å€¼
  // ...
  tableData.value = currentData
}
</script>

<template>
  <el-table :data="tableData">
    <el-table-column
      v-for="itemField in field.children"
      :key="itemField.code"
    >
      <template #default="{ row, $index }">
        <component
          :is="getTableCellComponent(itemField)"
          :field="itemField"
          :model-value="getRowFieldValue(row, itemField.code)"
          @update:model-value="(v) => handleChildUpdate(itemField.code, v)"
          mode="table-cell"
        />
      </template>
    </el-table-column>
  </el-table>
</template>
```

#### å¤æ‚åº¦åˆ†æ

**å¤æ‚åº¦ï¼šä½** âœ…

**åŸå› **ï¼š
1. **Vue åŸç”Ÿæ”¯æŒ**ï¼š`v-model` æ˜¯ Vue çš„æ ¸å¿ƒåŠŸèƒ½
2. **è‡ªåŠ¨åŒæ­¥**ï¼šæ•°æ®è‡ªåŠ¨åŒæ­¥ï¼Œä¸éœ€è¦æ‰‹åŠ¨æ”¶é›†
3. **ç®€å•ç›´è§‚**ï¼šç¬¦åˆ Vue çš„æœ€ä½³å®è·µ

## å››ã€æ¨èæ–¹æ¡ˆï¼šPinia Store + v-model æ··åˆ

### 4.1 è®¾è®¡æ€è·¯

1. **åŸºç¡€æ•°æ®ç”¨ v-model**ï¼šç®€å•å­—æ®µä½¿ç”¨ `v-model` åŒå‘ç»‘å®š
2. **å¤æ‚æ•°æ®ç”¨ Store**ï¼šåµŒå¥—ç»“æ„ä½¿ç”¨ Pinia Store é›†ä¸­ç®¡ç†
3. **æäº¤æ—¶ç»Ÿä¸€æå–**ï¼šä» Store ä¸­ç»Ÿä¸€æå–ï¼Œæ”¯æŒé€’å½’

### 4.2 å®ç°æ–¹æ¡ˆ

#### åŸºç¡€ç»„ä»¶ï¼ˆInputã€Select ç­‰ï¼‰

```vue
<!-- InputWidget.vue -->
<script setup lang="ts">
interface Props {
  field: FieldConfig
  modelValue: FieldValue
  mode: 'edit' | 'response' | 'table-cell' | 'detail' | 'search'
  fieldPath: string  // ğŸ”¥ å­—æ®µè·¯å¾„ï¼Œç”¨äº Store
}

const props = defineProps<Props>()
const emit = defineEmits<{
  'update:modelValue': [value: FieldValue]
}>()

const formDataStore = useFormDataStore()

// å†…éƒ¨å€¼
const internalValue = computed({
  get: () => props.modelValue?.raw || '',
  set: (newValue) => {
    const newFieldValue: FieldValue = {
      raw: newValue,
      display: String(newValue),
      meta: {}
    }
    
    // åŒæ­¥åˆ° Store
    formDataStore.setValue(props.fieldPath, newFieldValue)
    
    // è§¦å‘ v-model æ›´æ–°
    emit('update:modelValue', newFieldValue)
  }
})
</script>
```

#### å®¹å™¨ç»„ä»¶ï¼ˆTableã€Formï¼‰

```vue
<!-- TableWidget.vue -->
<script setup lang="ts">
interface Props {
  field: FieldConfig
  modelValue: FieldValue
  mode: 'edit' | 'response' | 'table-cell' | 'detail'
  fieldPath: string
  formManager?: ReactiveFormDataManager | null
  formRenderer?: FormRendererContext | null
}

const props = defineProps<Props>()
const emit = defineEmits<{
  'update:modelValue': [value: FieldValue]
}>()

const formDataStore = useFormDataStore()

// è¡¨æ ¼æ•°æ®
const tableData = computed({
  get: () => Array.isArray(props.modelValue?.raw) ? props.modelValue.raw : [],
  set: (newValue) => {
    const newFieldValue: FieldValue = {
      raw: newValue,
      display: `å…± ${newValue.length} æ¡`,
      meta: {}
    }
    
    // åŒæ­¥åˆ° Store
    formDataStore.setValue(props.fieldPath, newFieldValue)
    
    // è§¦å‘ v-model æ›´æ–°
    emit('update:modelValue', newFieldValue)
  }
})

// å­ç»„ä»¶å€¼æ›´æ–°
function handleChildUpdate(rowIndex: number, fieldCode: string, value: FieldValue) {
  const currentData = [...tableData.value]
  const itemFieldPath = `${props.fieldPath}[${rowIndex}].${fieldCode}`
  
  // æ›´æ–° Store
  formDataStore.setValue(itemFieldPath, value)
  
  // æ›´æ–°è¡¨æ ¼æ•°æ®
  if (!currentData[rowIndex]) {
    currentData[rowIndex] = {}
  }
  currentData[rowIndex][fieldCode] = value.raw
  
  tableData.value = currentData
}
</script>
```

#### æäº¤æ•°æ®æå–

```typescript
// stores/formData.ts
export const useFormDataStore = defineStore('formData', () => {
  const data = reactive<Map<string, FieldValue>>(new Map())
  
  // ğŸ”¥ æå–æäº¤æ•°æ®ï¼ˆæœ€ä¼˜å®ç°ï¼‰
  function getSubmitData(fields: FieldConfig[], basePath: string = ''): Record<string, any> {
    const result: Record<string, any> = {}
    
    fields.forEach(field => {
      const fieldPath = basePath ? `${basePath}.${field.code}` : field.code
      const value = data.get(fieldPath)
      
      if (!value) {
        // å­—æ®µä¸å­˜åœ¨ï¼Œä½¿ç”¨é»˜è®¤å€¼æˆ–è·³è¿‡
        return
      }
      
      // æ ¹æ®å­—æ®µç±»å‹é€’å½’æå–
      if (field.widget?.type === 'table') {
        result[field.code] = extractTableData(field, fieldPath)
      } else if (field.widget?.type === 'form') {
        result[field.code] = extractFormData(field, fieldPath)
      } else {
        result[field.code] = value.raw
      }
    })
    
    return result
  }
  
  // é€’å½’æå–è¡¨æ ¼æ•°æ®
  function extractTableData(field: FieldConfig, basePath: string): any[] {
    const value = data.get(basePath)
    if (!value || !Array.isArray(value.raw)) {
      return []
    }
    
    const itemFields = field.children || []
    const tableData = value.raw as any[]
    
    return tableData.map((row, index) => {
      const rowData: Record<string, any> = {}
      
      itemFields.forEach(itemField => {
        const itemFieldPath = `${basePath}[${index}].${itemField.code}`
        const itemValue = data.get(itemFieldPath)
        
        if (itemValue) {
          // é€’å½’å¤„ç†åµŒå¥—
          if (itemField.widget?.type === 'form') {
            rowData[itemField.code] = extractFormData(itemField, itemFieldPath)
          } else if (itemField.widget?.type === 'table') {
            rowData[itemField.code] = extractTableData(itemField, itemFieldPath)
          } else {
            rowData[itemField.code] = itemValue.raw
          }
        }
      })
      
      return rowData
    })
  }
  
  // é€’å½’æå–è¡¨å•æ•°æ®
  function extractFormData(field: FieldConfig, basePath: string): Record<string, any> {
    const subFields = field.children || []
    const formData: Record<string, any> = {}
    
    subFields.forEach(subField => {
      const subFieldPath = `${basePath}.${subField.code}`
      const subValue = data.get(subFieldPath)
      
      if (subValue) {
        // é€’å½’å¤„ç†åµŒå¥—
        if (subField.widget?.type === 'form') {
          formData[subField.code] = extractFormData(subField, subFieldPath)
        } else if (subField.widget?.type === 'table') {
          formData[subField.code] = extractTableData(subField, subFieldPath)
        } else {
          formData[subField.code] = subValue.raw
        }
      }
    })
    
    return formData
  }
  
  return {
    data,
    setValue: (path: string, value: FieldValue) => data.set(path, value),
    getValue: (path: string) => data.get(path),
    getSubmitData
  }
})
```

## äº”ã€å¤æ‚ç»„ä»¶æ ‘æ¸²æŸ“ä¿è¯

### 5.1 é€’å½’æ¸²æŸ“æœºåˆ¶

```vue
<!-- FormWidget.vue -->
<template>
  <div class="form-widget">
    <el-form>
      <el-form-item
        v-for="subField in field.children"
        :key="subField.code"
        :label="subField.name"
      >
        <!-- ğŸ”¥ é€’å½’æ¸²æŸ“å­ç»„ä»¶ -->
        <component
          :is="getWidgetComponent(subField.widget?.type || 'input')"
          :field="subField"
          :model-value="getSubFieldValue(subField.code)"
          @update:model-value="(v) => handleSubFieldUpdate(subField.code, v)"
          :field-path="`${fieldPath}.${subField.code}`"
          :form-manager="formManager"
          :form-renderer="formRenderer"
          :mode="mode"
          :depth="depth + 1"
        />
      </el-form-item>
    </el-form>
  </div>
</template>
```

### 5.2 æ·±åº¦é™åˆ¶

```typescript
// åœ¨ç»„ä»¶ä¸­æ£€æŸ¥æ·±åº¦
const props = defineProps<WidgetComponentProps>()

if (props.depth > 10) {
  console.warn(`ç»„ä»¶åµŒå¥—æ·±åº¦è¶…è¿‡é™åˆ¶: ${props.depth}`)
  return h('div', { style: { color: 'red' } }, 'åµŒå¥—æ·±åº¦è¿‡æ·±')
}
```

### 5.3 æ¡ä»¶æ¸²æŸ“æ”¯æŒ

```vue
<!-- FormRenderer.vue -->
<template>
  <el-form-item
    v-for="field in visibleFields"
    :key="field.code"
    :label="field.name"
  >
    <component
      :is="getWidgetComponent(field.widget?.type || 'input')"
      :field="field"
      :model-value="formDataStore.getValue(field.code)"
      @update:model-value="(v) => formDataStore.setValue(field.code, v)"
      mode="edit"
    />
  </el-form-item>
</template>

<script setup lang="ts">
// æ ¹æ®æ¡ä»¶è¿‡æ»¤å­—æ®µ
const visibleFields = computed(() => {
  return fields.value.filter(field => {
    return shouldShowField(field, formDataStore, allFields)
  })
})
</script>
```

## å…­ã€å€¼æå–å¤æ‚åº¦è¯„ä¼°

### 6.1 æ–¹æ¡ˆA: Pinia Storeï¼ˆæ¨èï¼‰

**å¤æ‚åº¦ï¼šä½** âœ…

**åŸå› **ï¼š
1. **é›†ä¸­ç®¡ç†**ï¼šæ‰€æœ‰æ•°æ®åœ¨ä¸€ä¸ª Store ä¸­
2. **é€’å½’ç®€å•**ï¼šé€’å½’é€»è¾‘æ¸…æ™°ï¼Œæ˜“äºç†è§£
3. **æ€§èƒ½å¥½**ï¼šç›´æ¥ä» Store è¯»å–ï¼ŒO(1) æ—¶é—´å¤æ‚åº¦
4. **æ”¯æŒä»»æ„æ·±åº¦**ï¼šé€’å½’å‡½æ•°æ”¯æŒæ— é™åµŒå¥—

**å®ç°éš¾åº¦**ï¼šâ­â­ï¼ˆç®€å•ï¼‰

### 6.2 æ–¹æ¡ˆB: ç»„ä»¶ expose æ–¹æ³•

**å¤æ‚åº¦ï¼šä¸­** âš ï¸

**åŸå› **ï¼š
1. **éœ€è¦ç»´æŠ¤å¼•ç”¨**ï¼šéœ€è¦æ³¨å†Œå’Œè¿½è¸ªå­ç»„ä»¶
2. **é€’å½’è°ƒç”¨**ï¼šéœ€è¦é€’å½’è°ƒç”¨ç»„ä»¶æ–¹æ³•
3. **çŠ¶æ€åˆ†æ•£**ï¼šæ•°æ®åˆ†æ•£åœ¨å„ä¸ªç»„ä»¶ä¸­

**å®ç°éš¾åº¦**ï¼šâ­â­â­ï¼ˆä¸­ç­‰ï¼‰

### 6.3 æ–¹æ¡ˆC: v-model å“åº”å¼æ•°æ®æµ

**å¤æ‚åº¦ï¼šä½** âœ…

**åŸå› **ï¼š
1. **Vue åŸç”Ÿæ”¯æŒ**ï¼š`v-model` æ˜¯ Vue çš„æ ¸å¿ƒåŠŸèƒ½
2. **è‡ªåŠ¨åŒæ­¥**ï¼šæ•°æ®è‡ªåŠ¨åŒæ­¥
3. **ç®€å•ç›´è§‚**ï¼šç¬¦åˆ Vue æœ€ä½³å®è·µ

**å®ç°éš¾åº¦**ï¼šâ­â­ï¼ˆç®€å•ï¼‰

## ä¸ƒã€æœ€ç»ˆæ¨èæ–¹æ¡ˆ

### 7.1 æ¨èï¼šPinia Store + v-model æ··åˆ

**ç†ç”±**ï¼š
1. **å€¼æå–ç®€å•**ï¼šä» Store ç»Ÿä¸€æå–ï¼Œå¤æ‚åº¦ä½
2. **æ”¯æŒå¤æ‚åµŒå¥—**ï¼šé€’å½’å‡½æ•°æ”¯æŒä»»æ„æ·±åº¦
3. **æ€§èƒ½å¥½**ï¼šç›´æ¥ä» Store è¯»å–ï¼Œä¸éœ€è¦éå†ç»„ä»¶
4. **æ˜“äºç»´æŠ¤**ï¼šé€»è¾‘æ¸…æ™°ï¼Œæ˜“äºç†è§£å’Œç»´æŠ¤

### 7.2 å®ç°è¦ç‚¹

1. **æ‰€æœ‰ç»„ä»¶ä½¿ç”¨ç»Ÿä¸€çš„ Props æ¥å£**
2. **åŸºç¡€ç»„ä»¶ä½¿ç”¨ v-model + Store**
3. **å®¹å™¨ç»„ä»¶ä½¿ç”¨ v-model + Store + é€’å½’**
4. **æäº¤æ—¶ä» Store ç»Ÿä¸€æå–**

### 7.3 å¤æ‚åº¦æ€»ç»“

| æ–¹æ¡ˆ | å€¼æå–å¤æ‚åº¦ | å®ç°éš¾åº¦ | æ€§èƒ½ | æ¨èåº¦ |
|------|------------|---------|------|--------|
| Pinia Store | ä½ âœ… | â­â­ | ä¼˜ç§€ | â­â­â­â­â­ |
| ç»„ä»¶ expose | ä¸­ âš ï¸ | â­â­â­ | è‰¯å¥½ | â­â­â­ |
| v-model | ä½ âœ… | â­â­ | ä¼˜ç§€ | â­â­â­â­ |

## å…«ã€æ€»ç»“

### 8.1 å€¼æå–å¤æ‚åº¦

**ç­”æ¡ˆï¼šä¸å¤æ‚** âœ…

**åŸå› **ï¼š
1. **é›†ä¸­ç®¡ç†**ï¼šä½¿ç”¨ Pinia Store é›†ä¸­ç®¡ç†æ‰€æœ‰æ•°æ®
2. **é€’å½’ç®€å•**ï¼šé€’å½’é€»è¾‘æ¸…æ™°ï¼Œæ˜“äºå®ç°
3. **æ€§èƒ½å¥½**ï¼šç›´æ¥ä» Store è¯»å–ï¼ŒO(1) æ—¶é—´å¤æ‚åº¦
4. **æ”¯æŒå¤æ‚åµŒå¥—**ï¼šé€’å½’å‡½æ•°æ”¯æŒä»»æ„æ·±åº¦

### 8.2 å¤æ‚ç»„ä»¶æ ‘æ¸²æŸ“

**ç­”æ¡ˆï¼šå¯ä»¥ä¿è¯** âœ…

**åŸå› **ï¼š
1. **é€’å½’æ¸²æŸ“**ï¼šç»„ä»¶å¯ä»¥é€’å½’æ¸²æŸ“å­ç»„ä»¶
2. **æ·±åº¦é™åˆ¶**ï¼šå¯ä»¥è®¾ç½®æ·±åº¦é™åˆ¶ï¼Œé˜²æ­¢æ— é™é€’å½’
3. **æ¡ä»¶æ¸²æŸ“**ï¼šæ”¯æŒæ ¹æ®æ¡ä»¶åŠ¨æ€æ˜¾ç¤º/éšè—å­—æ®µ
4. **åŠ¨æ€å­—æ®µ**ï¼šæ”¯æŒæ ¹æ®å›è°ƒæ¥å£åŠ¨æ€æ·»åŠ å­—æ®µ

### 8.3 å®Œå…¨é‡å†™å»ºè®®

**å»ºè®®**ï¼š
1. âœ… **ä½¿ç”¨ Pinia Store é›†ä¸­ç®¡ç†æ•°æ®**
2. âœ… **ä½¿ç”¨ v-model åŒå‘ç»‘å®š**
3. âœ… **ç»„ä»¶é€’å½’æ¸²æŸ“å­ç»„ä»¶**
4. âœ… **æäº¤æ—¶ä» Store ç»Ÿä¸€æå–**
5. âœ… **ä¸å¤ç”¨æ—§é€»è¾‘ï¼Œå®Œå…¨é‡å†™**

