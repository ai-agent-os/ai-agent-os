# Statistics èšåˆç»Ÿè®¡å‡½æ•°åŒ…

> **åŠŸèƒ½**ï¼šæä¾›ç±»å‹å®‰å…¨çš„èšåˆç»Ÿè®¡è¡¨è¾¾å¼æ„å»ºå‡½æ•°ï¼Œç”¨äº `OnSelectFuzzyResp.Statistics`

---

## ğŸ“‹ å¿«é€Ÿå¼€å§‹

### å¯¼å…¥åŒ…

```go
import "github.com/ai-agent-os/ai-agent-os/sdk/agent-app/statistics"
```

### ä½¿ç”¨æ–¹å¼ï¼šç›´æ¥å‡½æ•°è°ƒç”¨

```go
Statistics: map[string]interface{}{
    "å•†å“åŸä»·æ€»é¢(å…ƒ)":  statistics.Sum("ä»·æ ¼,*quantity"),
    "ä¼šå‘˜æŠ˜æ‰£åä»·æ ¼(å…ƒ)": statistics.Sum("ä»·æ ¼,*quantity,*0.9"),
    "å•†å“ç§ç±»æ•°":      statistics.Count("ä»·æ ¼"),
    "å•†å“æ€»æ•°é‡(ä»¶)":   statistics.Sum("quantity"),
    "ä¼šå‘˜æŠ˜æ‰£":       "9æŠ˜ä¼˜æƒ ",  // é™æ€ä¿¡æ¯ï¼Œç›´æ¥å†™å­—ç¬¦ä¸²
}
```

**å…³é”®ç‚¹**ï¼š
- âœ… æ“ä½œç¬¦å¿…é¡»æ˜ç¡®æŒ‡å®šï¼ˆå¦‚ `*quantity`ã€`*0.9`ï¼‰ï¼Œè¿™æ ·æ›´ç›´è§‚
- âœ… ä¾¿äºåç»­æ”¯æŒ `+`ã€`-`ã€`/` ç­‰æ“ä½œç¬¦
- âœ… è¡¨è¾¾å¼æ ¼å¼ï¼š`ä¸»å­—æ®µ,æ“ä½œç¬¦å­—æ®µ1,æ“ä½œç¬¦å­—æ®µ2,...`

---

## ğŸ“š å‡½æ•°åˆ—è¡¨

### åŸºç¡€èšåˆå‡½æ•°

| å‡½æ•° | è¯´æ˜ | ç¤ºä¾‹ |
|------|------|------|
| `Sum(expression)` | æ±‚å’Œ | `Sum("ä»·æ ¼,*quantity")` â†’ `"sum(ä»·æ ¼,*quantity)"` |
| `Count(field)` | è®¡æ•° | `Count("ä»·æ ¼")` â†’ `"count(ä»·æ ¼)"` |
| `Avg(expression)` | å¹³å‡å€¼ | `Avg("ä»·æ ¼,*quantity")` â†’ `"avg(ä»·æ ¼,*quantity)"` |
| `Min(field)` | æœ€å°å€¼ | `Min("ä»·æ ¼")` â†’ `"min(ä»·æ ¼)"` |
| `Max(field)` | æœ€å¤§å€¼ | `Max("ä»·æ ¼")` â†’ `"max(ä»·æ ¼)"` |

**è¡¨è¾¾å¼æ ¼å¼è¯´æ˜**ï¼š
- `"ä»·æ ¼"` - å•ä¸ªå­—æ®µ
- `"ä»·æ ¼,*quantity"` - ä»·æ ¼ Ã— æ•°é‡
- `"ä»·æ ¼,*quantity,*0.9"` - ä»·æ ¼ Ã— æ•°é‡ Ã— 0.9
- æ“ä½œç¬¦å¿…é¡»æ˜ç¡®æŒ‡å®šï¼ˆ`*` è¡¨ç¤ºä¹˜æ³•ï¼‰ï¼Œä¾¿äºåç»­æ”¯æŒ `+`ã€`-`ã€`/` ç­‰

### List å±‚èšåˆå‡½æ•°

| å‡½æ•° | è¯´æ˜ | ç¤ºä¾‹ |
|------|------|------|
| `ListSum(field)` | List å±‚æ±‚å’Œ | `ListSum("ç”¨æˆ·æ€»ä»·")` â†’ `"list_sum(ç”¨æˆ·æ€»ä»·)"` |
| `ListAvg(field)` | List å±‚å¹³å‡å€¼ | `ListAvg("ç”¨æˆ·æ€»ä»·")` â†’ `"list_avg(ç”¨æˆ·æ€»ä»·)"` |
| `ListCount()` | List å±‚è®¡æ•° | `ListCount()` â†’ `"list_count()"` |

### é€‰ä¸­é¡¹å­—æ®µå€¼å‡½æ•°

| å‡½æ•° | è¯´æ˜ | ç¤ºä¾‹ |
|------|------|------|
| `Value(field)` | æ˜¾ç¤ºé€‰ä¸­é¡¹çš„å­—æ®µå€¼ï¼ˆåŠ¨æ€å€¼ï¼‰ | `Value("ä½™é¢")` â†’ `"value(ä½™é¢)"` |

**ä½¿ç”¨è¯´æ˜**ï¼š
- ç”¨äºå•é€‰åœºæ™¯ï¼Œæ˜¾ç¤ºå½“å‰é€‰ä¸­é¡¹çš„æŸä¸ªå­—æ®µå€¼
- å­—æ®µåæ¥è‡ª `DisplayInfo` çš„ keyï¼ˆå¦‚ `"ä½™é¢"`ã€`"æŠ˜æ‰£"`ï¼‰
- å‰ç«¯ä¼šä»é€‰ä¸­é¡¹çš„ `DisplayInfo` ä¸­è·å–å¯¹åº”çš„å€¼å¹¶æ˜¾ç¤º
- å¤šé€‰åœºæ™¯ä¼šæ˜¾ç¤ºç¬¬ä¸€ä¸ªé€‰ä¸­é¡¹çš„å€¼
- è¿”å›å€¼å¯ä»¥æ˜¯ä»»ä½•ç±»å‹ï¼ˆæ–‡æœ¬ã€æ•°å­—ã€æ—¥æœŸç­‰ï¼‰

---

## ğŸ¯ ä½¿ç”¨åœºæ™¯

### åœºæ™¯1ï¼šåŸºç¡€æ±‚å’Œ

```go
// è®¡ç®—æ‰€æœ‰å•†å“çš„ä»·æ ¼æ€»å’Œ
statistics.Sum("ä»·æ ¼")

// è®¡ç®—æ‰€æœ‰å•†å“çš„ ä»·æ ¼Ã—æ•°é‡ æ€»å’Œ
statistics.Sum("ä»·æ ¼,*quantity")

// è®¡ç®—æ‰€æœ‰å•†å“çš„ ä»·æ ¼Ã—æ•°é‡Ã—0.9 æ€»å’Œï¼ˆ9æŠ˜ï¼‰
statistics.Sum("ä»·æ ¼,*quantity,*0.9")
```

### åœºæ™¯2ï¼šè®¡æ•°

```go
// è®¡ç®—é€‰ä¸­äº†å‡ ç§ä¸åŒçš„å•†å“
statistics.Count("ä»·æ ¼")
```

### åœºæ™¯3ï¼šå¹³å‡å€¼

```go
// è®¡ç®—å¹³å‡ä»·æ ¼
statistics.Avg("ä»·æ ¼")

// è®¡ç®—å¹³å‡æ€»ä»·ï¼ˆä»·æ ¼Ã—æ•°é‡ï¼‰
statistics.Avg("ä»·æ ¼,*quantity")
```

### åœºæ™¯4ï¼šæœ€å€¼

```go
// æœ€ä½ä»·æ ¼
statistics.Min("ä»·æ ¼")

// æœ€é«˜ä»·æ ¼
statistics.Max("ä»·æ ¼")
```

### åœºæ™¯5ï¼šList å±‚èšåˆï¼ˆMultiSelect äºŒå±‚èšåˆï¼‰

```go
// å¯¹æ‰€æœ‰è¡Œçš„"ç”¨æˆ·æ€»ä»·"å­—æ®µæ±‚å’Œ
statistics.ListSum("ç”¨æˆ·æ€»ä»·")

// å¯¹æ‰€æœ‰è¡Œçš„"ç”¨æˆ·æ€»ä»·"å­—æ®µæ±‚å¹³å‡å€¼
statistics.ListAvg("ç”¨æˆ·æ€»ä»·")

// è®¡ç®—æœ‰å¤šå°‘è¡Œ
statistics.ListCount()
```

### åœºæ™¯6ï¼šæ˜¾ç¤ºé€‰ä¸­é¡¹çš„å­—æ®µå€¼ï¼ˆåŠ¨æ€å€¼ï¼‰

```go
// æ˜¾ç¤ºå½“å‰é€‰ä¸­ä¼šå‘˜å¡çš„"ä½™é¢"
statistics.Value("ä½™é¢")

// æ˜¾ç¤ºå½“å‰é€‰ä¸­ä¼šå‘˜å¡çš„"æŠ˜æ‰£"
statistics.Value("æŠ˜æ‰£")

// æ˜¾ç¤ºå½“å‰é€‰ä¸­ä¼šå‘˜å¡çš„"æœ‰æ•ˆæœŸ"
statistics.Value("æœ‰æ•ˆæœŸ")
```

---

## ğŸ“ å®Œæ•´ç¤ºä¾‹

### ç¤ºä¾‹1ï¼šæ”¶é“¶å°å•†å“ç»Ÿè®¡

```go
import "github.com/ai-agent-os/ai-agent-os/sdk/agent-app/statistics"

func onSelectFuzzyProduct(ctx *app.Context, req *callback.OnSelectFuzzyReq) (*callback.OnSelectFuzzyResp, error) {
    // ... æŸ¥è¯¢å•†å“é€»è¾‘ ...
    
    return &callback.OnSelectFuzzyResp{
        MaxSelections: 0,
        Items:         items,
        Statistics: map[string]interface{}{
            "å•†å“åŸä»·æ€»é¢(å…ƒ)":  statistics.Sum("ä»·æ ¼,*quantity"),
            "ä¼šå‘˜æŠ˜æ‰£åä»·æ ¼(å…ƒ)": statistics.Sum("ä»·æ ¼,*quantity,*0.9"),
            "ä¼˜æƒ é‡‘é¢(å…ƒ)":    statistics.Sum("ä»·æ ¼,*quantity,*0.1"),
            "å•†å“ç§ç±»æ•°":      statistics.Count("ä»·æ ¼"),
            "å•†å“æ€»æ•°é‡(ä»¶)":   statistics.Sum("quantity"),
            "ä¼šå‘˜æŠ˜æ‰£":       "9æŠ˜ä¼˜æƒ ",
            "é…é€è¯´æ˜":       "æ»¡99å…ƒåŒ…é‚®ï¼Œä¸æ»¡99å…ƒè¿è´¹10å…ƒ",
        },
    }, nil
}
```

### ç¤ºä¾‹2ï¼šä¼šå‘˜å¡é€‰æ‹©ï¼ˆåŠ¨æ€æ˜¾ç¤ºä½™é¢ï¼‰

```go
import "github.com/ai-agent-os/ai-agent-os/sdk/agent-app/statistics"

func onSelectFuzzyMemberCard(ctx *app.Context, req *callback.OnSelectFuzzyReq) (*callback.OnSelectFuzzyResp, error) {
    // ... æŸ¥è¯¢ä¼šå‘˜å¡é€»è¾‘ ...
    // æ¯ä¸ªä¼šå‘˜å¡çš„ DisplayInfo åŒ…å«ï¼šä½™é¢ã€æŠ˜æ‰£ã€æœ‰æ•ˆæœŸç­‰
    
    return &callback.OnSelectFuzzyResp{
        MaxSelections: 1,  // å•é€‰
        Items:         items,
        Statistics: map[string]interface{}{
            "å½“å‰ä½™é¢":    statistics.Value("ä½™é¢"),     // åŠ¨æ€æ˜¾ç¤ºé€‰ä¸­ä¼šå‘˜å¡çš„ä½™é¢
            "å½“å‰æŠ˜æ‰£":    statistics.Value("æŠ˜æ‰£"),     // åŠ¨æ€æ˜¾ç¤ºé€‰ä¸­ä¼šå‘˜å¡çš„æŠ˜æ‰£
            "æœ‰æ•ˆæœŸè‡³":    statistics.Value("æœ‰æ•ˆæœŸ"),   // åŠ¨æ€æ˜¾ç¤ºé€‰ä¸­ä¼šå‘˜å¡çš„æœ‰æ•ˆæœŸ
            "ä½¿ç”¨è¯´æ˜":    "ä½™é¢ä¸è¶³æ—¶è‡ªåŠ¨å……å€¼",
        },
    }, nil
}
```


---

## ğŸ” æŸ¥æ‰¾å¯ç”¨å‡½æ•°

### æ–¹å¼1ï¼šä½¿ç”¨ go doc

```bash
go doc github.com/ai-agent-os/ai-agent-os/sdk/agent-app/statistics
```

### æ–¹å¼2ï¼šIDE è‡ªåŠ¨è¡¥å…¨

åœ¨ä»£ç ä¸­è¾“å…¥ `statistics.`ï¼ŒIDE ä¼šè‡ªåŠ¨æç¤ºæ‰€æœ‰å¯ç”¨å‡½æ•°ã€‚

### æ–¹å¼3ï¼šæŸ¥çœ‹æºç 

æŸ¥çœ‹ `sdk/agent-app/statistics/statistics.go` æ–‡ä»¶ï¼Œæ‰€æœ‰å‡½æ•°éƒ½æœ‰è¯¦ç»†æ³¨é‡Šã€‚

---

## âš ï¸ æ³¨æ„äº‹é¡¹

### 1. å­—æ®µåæ¥æº

- **åŸºç¡€å­—æ®µ**ï¼šæ¥è‡ª `DisplayInfo` çš„ keyï¼ˆå¦‚ `"ä»·æ ¼"`ã€`"åº“å­˜"`ï¼‰
- **è¡Œå†…å­—æ®µ**ï¼šæ¥è‡ªåŒä¸€è¡Œçš„å­—æ®µåï¼ˆå¦‚ `"quantity"`ï¼‰
- **List å±‚å­—æ®µ**ï¼šæ¥è‡ªè¡Œçš„è®¡ç®—ç»“æœå­—æ®µåï¼ˆå¦‚ `"ç”¨æˆ·æ€»ä»·"`ï¼‰

### 2. æ“ä½œç¬¦

- **ä¹˜æ³•**ï¼šä½¿ç”¨ `*` å‰ç¼€ï¼ˆå¦‚ `*quantity`ã€`*0.9`ï¼‰
- **å¿…é¡»æ˜ç¡®æŒ‡å®š**ï¼šæ“ä½œç¬¦å¿…é¡»åœ¨è¡¨è¾¾å¼ä¸­æ˜ç¡®å†™å‡ºï¼Œè¿™æ ·æ›´ç›´è§‚
- **ä¾¿äºæ‰©å±•**ï¼šåç»­å¯ä»¥æ”¯æŒ `+`ã€`-`ã€`/` ç­‰æ“ä½œç¬¦

### 3. é™æ€ä¿¡æ¯

- éè¡¨è¾¾å¼çš„é™æ€æ–‡æœ¬ï¼ˆå¦‚ `"9æŠ˜ä¼˜æƒ "`ï¼‰å¯ä»¥ç›´æ¥å†™å­—ç¬¦ä¸²

### 4. è¡¨è¾¾å¼æ ¼å¼

- å‡½æ•°ç”Ÿæˆçš„è¡¨è¾¾å¼æ ¼å¼ä¸å‰ç«¯ `ExpressionParser` å®Œå…¨å…¼å®¹
- ä¸éœ€è¦æ‹…å¿ƒæ ¼å¼é—®é¢˜

---

## ğŸ“– å‚è€ƒæ–‡æ¡£

- **å‰ç«¯å®ç°**ï¼š`web/src/core/utils/ExpressionParser.ts`
- **ä½¿ç”¨ç¤ºä¾‹**ï¼š`namespace/luobei/demo/code/api/tools/tools_cashier.go`
- **ä»£ç ç”ŸæˆæŒ‡å—**ï¼š`blueprint/05-ä»£ç ç”Ÿæˆå¿«é€ŸæŒ‡å—.md`

---

**æœ€åæ›´æ–°**ï¼š2025-01-XX

