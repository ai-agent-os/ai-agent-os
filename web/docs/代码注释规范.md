# 代码注释规范

## 📋 目的

在代码文件顶部添加详细的注释，说明：
- **需求说明**：为什么要实现这个功能
- **设计思路**：如何实现的，关键设计决策
- **使用场景**：什么时候使用
- **注意事项**：需要注意的问题

这样可以：
- ✅ 方便后续维护和理解代码
- ✅ 回归最初的思路和设计
- ✅ 新成员快速理解代码
- ✅ 避免重复造轮子

## 📝 注释格式

### 文件头注释模板

```typescript
/**
 * 文件名 - 简短描述
 * 
 * ============================================
 * 📋 需求说明
 * ============================================
 * 
 * 1. **核心需求**：
 *    - 需求点 1
 *    - 需求点 2
 *    - 需求点 3
 * 
 * 2. **业务场景**：
 *    - 场景 1
 *    - 场景 2
 * 
 * ============================================
 * 🎯 设计思路
 * ============================================
 * 
 * 1. **设计原则**：
 *    - 原则 1
 *    - 原则 2
 * 
 * 2. **关键决策**：
 *    - 决策 1 及原因
 *    - 决策 2 及原因
 * 
 * ============================================
 * 📝 关键功能
 * ============================================
 * 
 * 1. **功能 1**：
 *    - 功能描述
 *    - 实现方式
 * 
 * 2. **功能 2**：
 *    - 功能描述
 *    - 实现方式
 * 
 * ============================================
 * ⚠️ 注意事项
 * ============================================
 * 
 * 1. **注意点 1**：
 *    - 说明
 * 
 * 2. **注意点 2**：
 *    - 说明
 * 
 * ============================================
 * 📚 相关文档
 * ============================================
 * 
 * - 相关文档 1
 * - 相关文档 2
 */
```

## ✅ 已添加注释的文件

### 核心工具类

1. **`web/src/utils/permission.ts`** ✅
   - 权限检查逻辑
   - 权限来源和继承规则
   - 权限层级关系

2. **`web/src/core/stores-v2/extractors/FieldExtractorRegistry.ts`** ✅
   - 字段值提取策略
   - 提取规则和格式规范
   - 嵌套结构处理

### 架构层

3. **`web/src/architecture/infrastructure/factories/ServiceFactory.ts`** ✅
   - 依赖注入管理
   - 服务分层和生命周期
   - 可扩展性设计

4. **`web/src/architecture/infrastructure/eventBus/EventBusImpl.ts`** ✅
   - 事件总线实现
   - 事件通信机制
   - 可扩展性设计

5. **`web/src/architecture/infrastructure/routeManager/RouteManager.ts`** ✅
   - 路由管理逻辑
   - 参数保留策略
   - 循环防护机制

6. **`web/src/architecture/infrastructure/widgetRegistry/WidgetComponentFactory.ts`** ✅
   - 组件工厂模式
   - 组件注册和获取
   - 扩展性设计

7. **`web/src/architecture/infrastructure/plugins/pluginManager.ts`** ✅
   - 插件化扩展机制
   - 插件注册和管理
   - 使用场景和注意事项

8. **`web/src/architecture/infrastructure/stateManager/FormStateManager.ts`** ✅
   - 状态管理实现
   - 状态同步机制
   - 递归更新防护

### 领域层

9. **`web/src/architecture/domain/services/FormDomainService.ts`** ✅
   - 表单业务逻辑
   - 初始化和验证
   - 字段依赖处理

### 应用层

10. **`web/src/architecture/application/services/FormApplicationService.ts`** ✅
    - 表单业务流程编排
    - 事件协调
    - 数据提取和提交

### 展示层

11. **`web/src/architecture/presentation/views/TableView.vue`** ✅
    - 表格视图职责
    - 权限控制
    - URL 参数同步

12. **`web/src/architecture/presentation/views/FormView.vue`** ✅
    - 表单视图职责
    - 数据初始化
    - URL 参数同步控制

13. **`web/src/architecture/presentation/widgets/FormWidget.vue`** ✅
    - 嵌套表单渲染
    - 多种渲染模式
    - 字段验证集成

14. **`web/src/architecture/presentation/composables/useWorkspaceDetail.ts`** ✅
    - 详情抽屉管理
    - 编辑功能
    - URL 同步

15. **`web/src/architecture/presentation/composables/useFormParamURLSync.ts`** ✅
    - URL 同步范围
    - 字段过滤
    - 参数保留

16. **`web/src/architecture/presentation/composables/useFunctionParamInitialization.ts`** ✅
    - 数据初始化来源
    - 初始化顺序
    - 组件自治初始化

## 📌 注释内容要点

### 1. 需求说明
- **为什么**：为什么要实现这个功能
- **业务场景**：在什么场景下使用
- **核心需求**：必须满足的需求点

### 2. 设计思路
- **设计原则**：遵循的设计原则（如依赖倒置、开闭原则等）
- **关键决策**：重要的设计决策及原因
- **架构设计**：如何组织代码结构

### 3. 关键功能
- **主要功能**：核心功能点
- **实现方式**：如何实现的
- **数据流**：数据如何流转

### 4. 注意事项
- **常见问题**：容易出错的地方
- **使用限制**：使用时的限制条件
- **最佳实践**：推荐的使用方式

### 5. 相关文档
- **设计文档**：相关的设计文档
- **使用指南**：使用指南文档
- **相关代码**：相关的代码文件

## 🎯 注释原则

1. **清晰明了**：使用简洁的语言，避免冗长
2. **结构清晰**：使用分隔线和标题，便于阅读
3. **重点突出**：使用 emoji 和加粗突出重点
4. **及时更新**：代码变更时同步更新注释
5. **避免重复**：不要重复代码中已经表达的信息

## 📚 示例

参考已添加注释的文件，了解注释的格式和内容。

