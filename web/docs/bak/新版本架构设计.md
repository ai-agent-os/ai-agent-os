# æ–°ç‰ˆæœ¬æ¶æ„è®¾è®¡æ–‡æ¡£

## è®¾è®¡åŸåˆ™

### æ ¸å¿ƒç†å¿µ
1. **å…¨æ–°ç³»ç»Ÿ**ï¼šå®Œå…¨é‡æ„ï¼Œä¸å…¼å®¹æ—§ç‰ˆæœ¬æ•°æ®ï¼Œä¸ç•™å†å²å€ºåŠ¡
2. **ç±»å‹å®‰å…¨**ï¼šå…¨é¢ä½¿ç”¨ TypeScriptï¼Œæ‰€æœ‰ç±»å‹ä¸¥æ ¼å®šä¹‰ï¼Œç¦æ­¢ `any`
3. **å•ä¸€èŒè´£**ï¼šæ¯ä¸ªæ¨¡å—åªåšä¸€ä»¶äº‹ï¼ŒèŒè´£æ¸…æ™°
4. **æ•°æ®åˆ†ç¦»**ï¼šæ˜¾ç¤ºæ•°æ®å’Œæäº¤æ•°æ®åˆ†ç¦»ç®¡ç†
5. **æ˜“äºæ‰©å±•**ï¼šæ–°å¢åŠŸèƒ½åªéœ€å®ç°æ ‡å‡†æ¥å£
6. **å¯æµ‹è¯•æ€§**ï¼šæ¯ä¸ªæ¨¡å—ç‹¬ç«‹ï¼Œä¾¿äºå•å…ƒæµ‹è¯•
7. **å“åº”å¼ä¼˜å…ˆ**ï¼šåŸºäº Vue çš„å“åº”å¼ç³»ç»Ÿï¼Œæ•°æ®å˜åŒ–è‡ªåŠ¨æ›´æ–°UI
8. **äº‹ä»¶é©±åŠ¨**ï¼šç»„ä»¶é€šè¿‡äº‹ä»¶é€šä¿¡ï¼Œé¿å…ç›´æ¥è€¦åˆï¼ˆè¯¦è§ `æ¶æ„è®¾è®¡-äº‹ä»¶é©±åŠ¨ä¸ç»„ä»¶èŒè´£.md`ï¼‰

### ä¸æ—§ç‰ˆæœ¬çš„å…³ç³»
- âŒ **ä¸å…¼å®¹**æ—§ç‰ˆæœ¬çš„æ•°æ®æ ¼å¼
- âŒ **ä¸è¿ç§»**æ—§ç‰ˆæœ¬çš„ç”¨ä¾‹æ•°æ®
- âœ… **å€Ÿé‰´**æ—§ç‰ˆæœ¬çš„åŠŸèƒ½è®¾è®¡æ€è·¯
- âœ… **é¿å…**æ—§ç‰ˆæœ¬çš„æ¶æ„é—®é¢˜

### æ¶æ„æ¨¡å—æ€»è§ˆ

æœ¬æ¶æ„ç”±ä»¥ä¸‹æ ¸å¿ƒæ¨¡å—ç»„æˆï¼š

1. **æ ¸å¿ƒæ•°æ®ç»“æ„** - `FieldValue` å’Œ `FieldConfig`
2. **å­—æ®µè·¯å¾„å¢å¼ºå™¨** - `FieldPathEnhancer`ï¼ˆè¯¦è§ `æ¶æ„è®¾è®¡-å­—æ®µè·¯å¾„å¢å¼ºå™¨.md`ï¼‰
   - ğŸ”¥ ä¸ºæ¯ä¸ªå­—æ®µç”Ÿæˆå”¯ä¸€çš„ `field_path`ï¼ˆå¦‚ `products[].product_id`ï¼‰
   - ğŸ”¥ è‡ªåŠ¨æ·»åŠ  `parent_path`ã€`depth`ã€`meta` ç­‰å…ƒæ•°æ®
   - ğŸ”¥ å‰ç«¯è‡ªåŠ¨å¢å¼ºï¼Œåç«¯æ— éœ€æ”¹åŠ¨
   - ğŸ’¡ `field_path` ç”¨äºäº‹ä»¶æ ‡è¯†ï¼Œä¸æ˜¯ç”¨äºè·¨ç»„ä»¶ç›´æ¥æ›´æ–°
3. **å“åº”å¼æ•°æ®ç®¡ç†** - `ReactiveFormDataManager`ï¼ˆè¯¦è§ `æ¶æ„è®¾è®¡-å“åº”å¼æ•°æ®æµä¸ç»„ä»¶è”åŠ¨.md`ï¼‰
4. **æ¡ä»¶æ¸²æŸ“ç³»ç»Ÿ** - `ConditionEvaluator`ï¼ˆè¯¦è§ `æ¶æ„è®¾è®¡-æ¡ä»¶æ¸²æŸ“ä¸åŠ¨æ€éªŒè¯.md`ï¼‰
5. **äº‹ä»¶é©±åŠ¨æ¶æ„** - ç»„ä»¶é€šè¿‡äº‹ä»¶é€šä¿¡ï¼ˆè¯¦è§ `æ¶æ„è®¾è®¡-äº‹ä»¶é©±åŠ¨ä¸ç»„ä»¶èŒè´£.md`ï¼‰
   - ğŸ”¥ å­ç»„ä»¶åªç®¡è‡ªå·±ï¼Œå‘å‡ºäº‹ä»¶
   - ğŸ”¥ çˆ¶ç»„ä»¶ç›‘å¬å­ç»„ä»¶äº‹ä»¶ï¼Œåè°ƒå¤„ç†
   - ğŸ’¡ é¿å…è·¨ç»„ä»¶ç›´æ¥æ›´æ–°ï¼Œé™ä½è€¦åˆ
6. **éªŒè¯ç³»ç»Ÿï¼ˆç®€åŒ–ç‰ˆï¼‰** - `ValidatorEngine`ï¼ˆè¯¦è§ `æ¶æ„è®¾è®¡-éªŒè¯ç³»ç»Ÿï¼ˆç®€åŒ–ç‰ˆï¼‰.md`ï¼‰
   - ğŸ”¥ æ ¸å¿ƒéªŒè¯ï¼šrequired, min, max, oneof, required_if
   - ğŸ’¡ åç»­æŒ‰éœ€æ‰©å±•å…¶ä»–éªŒè¯å™¨
7. **Widget å·¥å‚** - ç»„ä»¶æ¸²æŸ“å’Œæ‰©å±•ï¼ˆé¢å‘å¯¹è±¡è®¾è®¡ï¼Œè¯¦è§ `æ¶æ„è®¾è®¡-äº‹ä»¶é©±åŠ¨ä¸ç»„ä»¶èŒè´£.md`ï¼‰
   - ğŸ”¥ BaseWidget æŠ½è±¡åŸºç±»
   - ğŸ”¥ SelectWidgetã€MultiSelectWidgetã€ListWidget ç­‰
   - ğŸ’¡ é€šè¿‡ç»§æ‰¿å®ç°ä»£ç å¤ç”¨
8. **å›è°ƒç³»ç»Ÿ** - ç»Ÿä¸€çš„å›è°ƒå¤„ç†æœºåˆ¶ï¼ˆè‡ªåŠ¨ä¼ é€’å®Œæ•´è¡¨å•çŠ¶æ€ï¼‰
9. **èšåˆç»Ÿè®¡** - è¡¨è¾¾å¼è§£æå’Œè®¡ç®—ï¼ˆæ”¯æŒå››ç§åœºæ™¯ï¼ŒåŒ…æ‹¬ä¸¤å±‚èšåˆï¼‰

### è®¾è®¡ç†å¿µè¡¥å……

8. **ç®€å•ä¸ºä¸»** - ä¸è¿‡åº¦è®¾è®¡ï¼Œæ ¸å¿ƒåŠŸèƒ½å¤Ÿç”¨å°±è¡Œ
9. **åç«¯å…œåº•** - å‰ç«¯éªŒè¯æ˜¯æå‡ä½“éªŒï¼Œåç«¯éªŒè¯æ‰æ˜¯å¼ºåˆ¶çš„
10. **æ¸è¿›å¼å®ç°** - å…ˆåšæ ¸å¿ƒï¼Œåç»­æŒ‰éœ€æ‰©å±•

---

## 1. æ ¸å¿ƒæ•°æ®ç»“æ„è®¾è®¡

### 1.1 å­—æ®µå€¼çš„ç»Ÿä¸€è¡¨ç¤ºï¼ˆFieldValueï¼‰

```typescript
/**
 * å­—æ®µå€¼çš„ç»Ÿä¸€æ•°æ®ç»“æ„
 * æ‰€æœ‰å­—æ®µçš„å€¼éƒ½ç”¨è¿™ä¸ªç»“æ„å­˜å‚¨ï¼Œé¿å…æ··ä¹±
 */
interface FieldValue {
  // åŸå§‹å€¼ï¼ˆç”¨äºæäº¤ï¼‰
  raw: any
  
  // æ˜¾ç¤ºå€¼ï¼ˆç”¨äºUIå±•ç¤ºï¼‰
  display: string
  
  // å…ƒæ•°æ®ï¼ˆæ‰©å±•ä¿¡æ¯ï¼‰
  meta?: {
    // å¯¹äºselectï¼šå­˜å‚¨å®Œæ•´çš„optionä¿¡æ¯
    option?: SelectOption
    
    // å¯¹äºInputFuzzyï¼šå­˜å‚¨display_info
    displayInfo?: Record<string, any>
    
    // æ•°æ®ç±»å‹
    dataType: string
    
    // æ˜¯å¦æ¥è‡ªå›è°ƒ
    fromCallback?: boolean
    
    // éªŒè¯çŠ¶æ€
    validationState?: {
      valid: boolean
      message?: string
    }
  }
}

/**
 * Selecté€‰é¡¹çš„æ ‡å‡†ç»“æ„
 */
interface SelectOption {
  value: any              // æäº¤å€¼
  label: string           // æ˜¾ç¤ºæ–‡æœ¬
  icon?: string           // å›¾æ ‡
  displayInfo?: Record<string, any>  // è¯¦ç»†ä¿¡æ¯ï¼ˆç”¨äºtooltipç­‰ï¼‰
  disabled?: boolean
}
```

### 1.2 è¡¨å•æ•°æ®ç®¡ç†å™¨ï¼ˆFormDataManagerï¼‰

```typescript
/**
 * è¡¨å•æ•°æ®ç®¡ç†å™¨
 * ç»Ÿä¸€ç®¡ç†æ‰€æœ‰å­—æ®µçš„æ•°æ®ï¼Œæä¾›æ ‡å‡†çš„è¯»å†™æ¥å£
 */
class FormDataManager {
  // å†…éƒ¨æ•°æ®å­˜å‚¨ï¼ˆä½¿ç”¨ Map æé«˜æ€§èƒ½ï¼‰
  private data: Map<string, FieldValue>
  
  // å­—æ®µå®šä¹‰ï¼ˆå…ƒä¿¡æ¯ï¼‰
  private fields: Map<string, FieldConfig>
  
  /**
   * è®¾ç½®å­—æ®µå€¼
   * @param code å­—æ®µä»£ç 
   * @param value å­—æ®µå€¼ï¼ˆå¯ä»¥æ˜¯ä»»æ„ç±»å‹ï¼Œä¼šè‡ªåŠ¨è½¬æ¢ä¸º FieldValueï¼‰
   */
  setValue(code: string, value: any): void {
    const field = this.fields.get(code)
    const fieldValue = this.normalizeValue(value, field)
    this.data.set(code, fieldValue)
  }
  
  /**
   * è·å–å­—æ®µçš„æ˜¾ç¤ºå€¼ï¼ˆç”¨äºUIæ¸²æŸ“ï¼‰
   */
  getDisplayValue(code: string): string {
    const fieldValue = this.data.get(code)
    return fieldValue?.display || ''
  }
  
  /**
   * è·å–å­—æ®µçš„åŸå§‹å€¼ï¼ˆç”¨äºæäº¤ï¼‰
   */
  getRawValue(code: string): any {
    const fieldValue = this.data.get(code)
    return fieldValue?.raw
  }
  
  /**
   * è·å–å®Œæ•´çš„ FieldValue
   */
  getFieldValue(code: string): FieldValue | undefined {
    return this.data.get(code)
  }
  
  /**
   * å‡†å¤‡æäº¤æ•°æ®
   * å°†æ‰€æœ‰å­—æ®µè½¬æ¢ä¸ºåç«¯æœŸæœ›çš„æ ¼å¼
   */
  prepareSubmitData(): Record<string, any> {
    const result: Record<string, any> = {}
    
    for (const [code, fieldValue] of this.data) {
      const field = this.fields.get(code)
      
      // è·³è¿‡ç©ºå€¼ï¼ˆæ ¹æ®å­—æ®µé…ç½®å†³å®šï¼‰
      if (this.shouldSkipField(fieldValue, field)) {
        continue
      }
      
      // ç±»å‹è½¬æ¢
      result[code] = this.convertToSubmitValue(fieldValue, field)
    }
    
    return result
  }
  
  /**
   * ä»æäº¤æ•°æ®æ¢å¤è¡¨å•æ•°æ®ï¼ˆç”¨äºå›æƒ³åŠŸèƒ½ï¼‰
   * @param submitData åç«¯æ ¼å¼çš„æ•°æ®
   */
  async loadFromSubmitData(submitData: Record<string, any>): Promise<void> {
    for (const [code, value] of Object.entries(submitData)) {
      const field = this.fields.get(code)
      
      // å¦‚æœå­—æ®µæœ‰ OnSelectFuzzy å›è°ƒï¼Œéœ€è¦é€šè¿‡å›è°ƒè·å–å®Œæ•´ä¿¡æ¯
      if (this.hasCallback(field, 'OnSelectFuzzy')) {
        await this.loadSelectValueByCallback(code, value, field)
      } else {
        // ç›´æ¥è®¾ç½®å€¼
        this.setValue(code, value)
      }
    }
  }
  
  /**
   * è§„èŒƒåŒ–å€¼ï¼ˆå°†ä»»æ„æ ¼å¼è½¬æ¢ä¸º FieldValueï¼‰
   */
  private normalizeValue(value: any, field?: FieldConfig): FieldValue {
    // å¦‚æœå·²ç»æ˜¯ FieldValue æ ¼å¼ï¼Œç›´æ¥è¿”å›
    if (this.isFieldValue(value)) {
      return value
    }
    
    // å¦‚æœæ˜¯ SelectOption æ ¼å¼ï¼ˆæ¥è‡ªå›è°ƒï¼‰
    if (this.isSelectOption(value)) {
      return {
        raw: value.value,
        display: value.label,
        meta: {
          option: value,
          displayInfo: value.displayInfo,
          dataType: field?.data?.type || 'any',
          fromCallback: true
        }
      }
    }
    
    // æ™®é€šå€¼
    return {
      raw: value,
      display: this.formatDisplayValue(value, field),
      meta: {
        dataType: field?.data?.type || 'any'
      }
    }
  }
  
  /**
   * ç±»å‹è½¬æ¢ï¼ˆæäº¤æ—¶ä½¿ç”¨ï¼‰
   */
  private convertToSubmitValue(fieldValue: FieldValue, field?: FieldConfig): any {
    const rawValue = fieldValue.raw
    const dataType = field?.data?.type
    
    // æ ¹æ®æ•°æ®ç±»å‹è¿›è¡Œè½¬æ¢
    switch (dataType) {
      case 'int':
        return parseInt(rawValue)
      
      case 'float':
      case 'number':
        return parseFloat(rawValue)
      
      case 'bool':
      case 'boolean':
        return Boolean(rawValue)
      
      case 'array':
        // é€’å½’å¤„ç†æ•°ç»„
        if (Array.isArray(rawValue)) {
          return rawValue.map(item => {
            if (typeof item === 'object' && item !== null) {
              // é€’å½’å¤„ç†å¯¹è±¡æ•°ç»„
              return this.convertObjectToSubmit(item, field)
            }
            return item
          })
        }
        return rawValue
      
      default:
        return rawValue
    }
  }
  
  /**
   * å¤„ç†åµŒå¥—å¯¹è±¡ï¼ˆç”¨äº list ç±»å‹ï¼‰
   */
  private convertObjectToSubmit(obj: any, parentField?: FieldConfig): any {
    const result: Record<string, any> = {}
    
    // è·å–å­å­—æ®µå®šä¹‰
    const subFields = this.getSubFields(parentField)
    
    for (const [key, value] of Object.entries(obj)) {
      const subField = subFields?.find(f => f.code === key)
      
      if (value && typeof value === 'object' && 'raw' in value) {
        // æ˜¯ FieldValue æ ¼å¼ï¼Œæå– raw
        result[key] = this.convertToSubmitValue(value, subField)
      } else {
        result[key] = value
      }
    }
    
    return result
  }
}
```

### 1.3 å­—æ®µé…ç½®å®šä¹‰ï¼ˆFieldConfigï¼‰

**ğŸ”¥ ä¸åç«¯ Field ç»“æ„ 100% å¯¹åº”**

```typescript
/**
 * å­—æ®µé…ç½®ï¼ˆä¸åç«¯ Field å®Œå…¨å¯¹åº”ï¼‰
 * 
 * å¯¹åº”åç«¯ä»£ç ï¼š
 * type Field struct {
 *     Code            string     `json:"code"`
 *     Desc            string     `json:"desc"`
 *     Name            string     `json:"name"`
 *     Search          string     `json:"search"`
 *     Data            *FieldData `json:"data"`
 *     Widget          struct {
 *         Type   string      `json:"type"`
 *         Config interface{} `json:"config"`
 *     } `json:"widget"`
 *     Callbacks       []string `json:"callbacks"`
 *     TablePermission string   `json:"table_permission"`
 *     Validation      string   `json:"validation"`
 * }
 */
interface FieldConfig {
  // åŸºç¡€ä¿¡æ¯
  code: string              // å­—æ®µä»£ç ï¼ˆå”¯ä¸€æ ‡è¯†ï¼‰
  name: string              // å­—æ®µåç§°ï¼ˆæ˜¾ç¤ºç”¨ï¼‰
  desc?: string             // å­—æ®µæè¿°
  search?: string           // æœç´¢é…ç½®ï¼ˆtable ä¸“ç”¨ï¼‰
  
  // ğŸ”¥ æ•°æ®ç±»å‹ï¼ˆä¸åç«¯ FieldData å¯¹åº”ï¼‰
  data: {
    type: string            // string, int, bool, []string, []int, []float, timestamp, float, files, struct, []struct
    format?: string         // csv, markdown, json, yaml, htmlï¼ˆåç»­æ‰©å±•ï¼‰
    example?: string        // ç¤ºä¾‹æ•°æ®ï¼Œä¾‹å¦‚: "10", "ç´§æ€¥"
  }
  
  // ğŸ”¥ ç»„ä»¶é…ç½®ï¼ˆä¸åç«¯ Widget å¯¹åº”ï¼‰
  widget: {
    type: string            // input, text, text_area, select, switch, timestamp, user, ID, number, float, files, checkbox, radio
    config?: any            // æ¯ä¸ª Widget ç±»å‹æœ‰è‡ªå·±çš„é…ç½®ï¼ˆä¾‹å¦‚ InputConfig, SelectConfigï¼‰
  }
  
  // ğŸ”¥ å›è°ƒé…ç½®ï¼ˆä¸åç«¯å¯¹åº”ï¼‰
  callbacks?: string[]      // ä¾‹å¦‚: ["OnSelectFuzzy", "OnInputValidate", "OnTableAddRow"]
  
  // ğŸ”¥ è¡¨æ ¼æƒé™ï¼ˆä¸åç«¯å¯¹åº”ï¼‰
  table_permission?: '' | 'read' | 'update' | 'create'
  
  // ğŸ”¥ éªŒè¯è§„åˆ™ï¼ˆä¸åç«¯å¯¹åº”ï¼Œå®Œå…¨ç…§æ¬ go-playground/validator/v10ï¼‰
  validation?: string       // ä¾‹å¦‚: "required,min=5,max=100,oneof=A B C,required_if=type urgent"
  
  // ========== ä»¥ä¸‹å­—æ®µç”±å‰ç«¯ä»ä¸Šè¿°å­—æ®µä¸­è§£æ/è®¡ç®—å¾—å‡ºï¼Œä¸åœ¨åç«¯ JSON ä¸­ ==========
  // ï¼ˆè¿™äº›æ˜¯å‰ç«¯è¿è¡Œæ—¶éœ€è¦çš„ï¼Œä½†ä¸ä¿®æ”¹åç«¯è¿”å›çš„æ•°æ®ç»“æ„ï¼‰
}

/**
 * Widget Config ç±»å‹å®šä¹‰ï¼ˆä¸åç«¯å¯¹åº”ï¼‰
 */

// Input Widget Config
interface InputConfig {
  placeholder?: string
  password?: boolean    // æ˜¯å¦å¯†ç æ¡†
  prepend?: string      // å‰ç½®å†…å®¹
  append?: string       // åç½®å†…å®¹
  default?: string      // é»˜è®¤å€¼
}

// Select Widget Config
interface SelectConfig {
  options?: string[]    // é™æ€é€‰é¡¹åˆ—è¡¨ï¼ˆç®€å• selectï¼‰
  placeholder?: string
  default?: string
}

// TextArea Widget Config
interface TextAreaConfig {
  placeholder?: string
  rows?: number         // è¡Œæ•°
  default?: string
}

// Switch Widget Config
interface SwitchConfig {
  default?: boolean
  activeText?: string   // æ‰“å¼€æ—¶çš„æ–‡å­—
  inactiveText?: string // å…³é—­æ—¶çš„æ–‡å­—
}

// Number/Float Widget Config
interface NumberConfig {
  min?: number
  max?: number
  step?: number
  precision?: number    // ç²¾åº¦ï¼ˆå°æ•°ä½æ•°ï¼‰
  default?: number
}

// Timestamp Widget Config
interface TimestampConfig {
  format?: string       // æ˜¾ç¤ºæ ¼å¼
  default?: string
}

// Checkbox Widget Config
interface CheckboxConfig {
  options?: string[]    // é€‰é¡¹åˆ—è¡¨
  default?: string[]
}

// Radio Widget Config
interface RadioConfig {
  options?: string[]    // é€‰é¡¹åˆ—è¡¨
  default?: string
}

/**
 * æ¡ä»¶æ¸²æŸ“å’Œå­—æ®µè”åŠ¨
 * æ³¨æ„ï¼šè¿™äº›ä¸åœ¨ FieldConfig ä¸­ï¼Œè€Œæ˜¯ä» validation å­—ç¬¦ä¸²ä¸­è§£æ
 * æˆ–ç”± FormDataManager åœ¨è¿è¡Œæ—¶å¤„ç†
 */

// æ¡ä»¶æ¸²æŸ“ä» validation ä¸­è§£æ
// ä¾‹å¦‚: "required_if=type urgent" è¡¨ç¤ºå½“ type å­—æ®µç­‰äº urgent æ—¶å¿…å¡«
// ä¾‹å¦‚: "excluded_if=type software" è¡¨ç¤ºå½“ type å­—æ®µç­‰äº software æ—¶éšè—

// å­—æ®µè”åŠ¨ç”± FormDataManager çš„ watch æœºåˆ¶å¤„ç†
// ä¾‹å¦‚: formManager.watch('province', () => formManager.setValue('city', null))
```

---

## 2. ç»„ä»¶åŒ–æ¶æ„ï¼ˆOOP è®¾è®¡ï¼‰

### 2.1 ç»„ä»¶ç»§æ‰¿ä½“ç³»

**è¯¦è§ `æ¶æ„è®¾è®¡-äº‹ä»¶é©±åŠ¨ä¸ç»„ä»¶èŒè´£.md`**

```typescript
/**
 * Widget åŸºç±»
 * æ‰€æœ‰ç»„ä»¶éƒ½ç»§æ‰¿æ­¤ç±»
 */
abstract class BaseWidget {
  protected field: FieldConfig
  protected fieldPath: string
  protected value: FieldValue
  protected formManager: ReactiveFormDataManager
  protected onChange: (value: FieldValue) => void
  
  constructor(props: WidgetRenderProps) {
    this.field = props.field
    this.fieldPath = props.currentFieldPath
    this.value = props.value
    this.formManager = props.formManager
    this.onChange = props.onChange
  }
  
  /**
   * æ¸²æŸ“æ–¹æ³•ï¼ˆå­ç±»å¿…é¡»å®ç°ï¼‰
   */
  abstract render(): VNode
  
  /**
   * å‘å‡ºäº‹ä»¶
   */
  protected emit(eventType: string, payload: any): void {
    this.formManager.emit(eventType, {
      ...payload,
      fieldPath: this.fieldPath
    })
  }
  
  /**
   * é€šç”¨æ–¹æ³•ï¼šéå†å­å­—æ®µ
   */
  protected findChildFieldsByType(types: string[]): FieldConfig[] {
    if (!this.field.sub_fields) return []
    return this.field.sub_fields.filter(field => 
      types.includes(field.widget.type)
    )
  }
}

/**
 * Widgetæ¸²æŸ“å±æ€§
 * è¯¦è§ æ¶æ„è®¾è®¡-å“åº”å¼æ•°æ®æµä¸ç»„ä»¶è”åŠ¨.md
 * è¯¦è§ æ¶æ„è®¾è®¡-äº‹ä»¶é©±åŠ¨ä¸ç»„ä»¶èŒè´£.md
 */
interface WidgetRenderProps {
  // å½“å‰å­—æ®µé…ç½®
  field: FieldConfig
  
  // å½“å‰å­—æ®µè·¯å¾„ï¼ˆå”¯ä¸€æ ‡è¯†ï¼‰
  currentFieldPath: string
  
  // å½“å‰å­—æ®µå€¼
  value: FieldValue
  
  // æ›´æ–°å½“å‰å­—æ®µ
  onChange: (value: FieldValue) => void
  
  // ========== æ•°æ®è®¿é—®ï¼ˆä¸»è¦ç”¨äºè¯»å–ï¼‰ ==========
  
  /**
   * æ•°æ®ç®¡ç†å™¨å¼•ç”¨
   * ç»„ä»¶å¯ä»¥è®¿é—®è¡¨å•æ•°æ®ï¼Œä½†åº”é¿å…ç›´æ¥æ›´æ–°å…¶ä»–ç»„ä»¶
   */
  formManager: ReactiveFormDataManager
  
  /**
   * ä¾¿æ·æ–¹æ³•ï¼šè·å–å…¶ä»–å­—æ®µçš„å€¼ï¼ˆåªè¯»ï¼‰
   */
  getFieldValue: (fieldPath: string) => FieldValue | undefined
  
  /**
   * ä¾¿æ·æ–¹æ³•ï¼šç›‘å¬å…¶ä»–å­—æ®µå˜åŒ–
   */
  watchField: (fieldPath: string, callback: WatchCallback) => () => void
  
  // ========== çˆ¶çº§è®¿é—®ï¼ˆList/Struct åµŒå¥—åœºæ™¯ï¼‰ ==========
  
  /**
   * çˆ¶çº§è¡¨å•æ•°æ®ç®¡ç†å™¨ï¼ˆå½“å‰ç»„ä»¶åœ¨ List/Struct å†…æ—¶å¯ç”¨ï¼‰
   */
  parentFormManager?: ReactiveFormDataManager
  
  // ========== å…¶ä»– ==========
  
  disabled?: boolean
  readonly?: boolean
  required?: boolean
}

/**
 * å­—æ®µå˜åŒ–ç›‘å¬å›è°ƒ
 */
type WatchCallback = (
  newValue: FieldValue,
  oldValue: FieldValue | undefined,
  code: string
) => void

/**
 * Widgetå·¥å‚
 * è´Ÿè´£åˆ›å»ºå’Œç®¡ç† Widget å®ä¾‹
 */
class WidgetFactory {
  private widgetClasses: Map<string, typeof BaseWidget> = new Map()
  
  /**
   * æ³¨å†Œç»„ä»¶ç±»
   */
  register(type: string, widgetClass: typeof BaseWidget): void {
    this.widgetClasses.set(type, widgetClass)
  }
  
  /**
   * è·å–ç»„ä»¶ç±»
   */
  getWidgetClass(type: string): typeof BaseWidget {
    const widgetClass = this.widgetClasses.get(type)
    
    if (!widgetClass) {
      console.warn(`Widget type "${type}" not found, using default`)
      return InputWidget  // é»˜è®¤ä½¿ç”¨ InputWidget
    }
    
    return widgetClass
  }
  
  /**
   * åˆ›å»ºç»„ä»¶å®ä¾‹
   */
  create(field: FieldConfig, props: WidgetRenderProps): BaseWidget {
    const WidgetClass = this.getWidgetClass(field.widget.type)
    return new WidgetClass(props)
  }
}

// å…¨å±€å·¥å‚å®ä¾‹
export const widgetFactory = new WidgetFactory()

// æ³¨å†Œæ‰€æœ‰ç»„ä»¶
widgetFactory.register('input', InputWidget)
widgetFactory.register('select', SelectWidget)
widgetFactory.register('multiselect', MultiSelectWidget)
widgetFactory.register('number', NumberWidget)
widgetFactory.register('text_area', TextAreaWidget)
widgetFactory.register('list', ListWidget)
// ... å…¶ä»–ç»„ä»¶
```

### 2.2 å…·ä½“ç»„ä»¶å®ç°ç¤ºä¾‹

#### InputWidgetï¼ˆè¾“å…¥æ¡†ç»„ä»¶ï¼‰

```typescript
const InputWidget: IWidget = {
  type: 'input',
  supportedCallbacks: ['OnInputFuzzy'],
  
  render(props: WidgetRenderProps) {
    const { field, value, onChange, disabled } = props
    
    return h(ElInput, {
      modelValue: value.display,
      placeholder: field.widget.config.placeholder || `è¯·è¾“å…¥${field.name}`,
      disabled,
      onInput: (val: string) => {
        onChange({
          raw: val,
          display: val,
          meta: { dataType: field.data.type }
        })
      }
    })
  },
  
  validate(value: FieldValue, field: FieldConfig): ValidationResult {
    // å®ç°éªŒè¯é€»è¾‘
  }
}
```

#### SelectWidgetï¼ˆä¸‹æ‹‰é€‰æ‹©ç»„ä»¶ï¼‰

```typescript
const SelectWidget: IWidget = {
  type: 'select',
  supportedCallbacks: ['OnSelectFuzzy'],
  
  render(props: WidgetRenderProps) {
    const { field, value, onChange } = props
    
    // å¦‚æœæœ‰ OnSelectFuzzy å›è°ƒï¼Œä½¿ç”¨æ¨¡ç³Šæœç´¢å¯¹è¯æ¡†
    if (this.hasCallback(field, 'OnSelectFuzzy')) {
      return this.renderFuzzySearch(props)
    }
    
    // å¦åˆ™ä½¿ç”¨æ™®é€šä¸‹æ‹‰æ¡†
    return this.renderNormalSelect(props)
  },
  
  renderFuzzySearch(props: WidgetRenderProps) {
    const { field, value, onChange } = props
    
    return h('div', { class: 'select-fuzzy' }, [
      h(ElInput, {
        modelValue: value.display,
        readonly: true,
        placeholder: `è¯·é€‰æ‹©${field.name}`,
        onClick: () => {
          // æ‰“å¼€æ¨¡ç³Šæœç´¢å¯¹è¯æ¡†
          openFuzzyDialog(field, (selected: SelectOption) => {
            onChange({
              raw: selected.value,
              display: selected.label,
              meta: {
                option: selected,
                displayInfo: selected.displayInfo,
                dataType: field.data.type,
                fromCallback: true
              }
            })
          })
        }
      })
    ])
  }
}
```

#### ListWidgetï¼ˆåˆ—è¡¨ç»„ä»¶ - é€’å½’æ¸²æŸ“ï¼‰

```typescript
const ListWidget: IWidget = {
  type: 'list',
  supportedCallbacks: [],
  
  render(props: WidgetRenderProps) {
    const { field, value, onChange } = props
    
    // è·å–å­å­—æ®µå®šä¹‰
    const subFields = this.getSubFields(field)
    
    // åˆ—è¡¨æ•°æ®
    const listData = Array.isArray(value.raw) ? value.raw : []
    
    return h('div', { class: 'list-widget' }, [
      // è¡¨æ ¼å¤´éƒ¨
      this.renderTableHeader(field, listData, onChange),
      
      // æ•°æ®è¡¨æ ¼
      h(ElTable, {
        data: listData
      }, {
        default: () => [
          // åŠ¨æ€æ¸²æŸ“åˆ—
          ...subFields.map(subField => 
            h(ElTableColumn, {
              label: subField.name,
              prop: subField.code
            }, {
              default: ({ row, $index }) => {
                // ğŸ”¥ å…³é”®ï¼šé€’å½’æ¸²æŸ“å­å­—æ®µ
                // è¿™é‡Œå¤ç”¨ WidgetFactory æ¥æ¸²æŸ“å­å­—æ®µ
                return widgetFactory.create(subField, {
                  field: subField,
                  value: this.getSubFieldValue(row, subField),
                  onChange: (newValue: FieldValue) => {
                    this.updateListItem(listData, $index, subField.code, newValue)
                    onChange({
                      raw: listData,
                      display: `${listData.length} é¡¹`,
                      meta: { dataType: 'array' }
                    })
                  }
                })
              }
            })
          ),
          
          // æ“ä½œåˆ—
          this.renderActionColumn(listData, onChange)
        ]
      })
    ])
  },
  
  /**
   * è·å–å­å­—æ®µçš„å€¼
   */
  getSubFieldValue(row: any, field: FieldConfig): FieldValue {
    const value = row[field.code]
    
    // å¦‚æœå·²ç»æ˜¯ FieldValue æ ¼å¼
    if (value && typeof value === 'object' && 'raw' in value) {
      return value
    }
    
    // è§„èŒƒåŒ–ä¸º FieldValue
    return {
      raw: value,
      display: this.formatValue(value),
      meta: { dataType: field.data.type }
    }
  }
}
```

---

## 3. å›è°ƒç³»ç»Ÿè®¾è®¡

### æ ¸å¿ƒæœºåˆ¶ï¼šè‡ªåŠ¨ä¼ é€’å®Œæ•´è¡¨å•çŠ¶æ€ ğŸ”¥

å›è°ƒç³»ç»Ÿçš„æ ¸å¿ƒè®¾è®¡ç†å¿µï¼š**æ¯ä¸ªç»„ä»¶åœ¨è§¦å‘å›è°ƒæ—¶ï¼Œéƒ½ä¼šè‡ªåŠ¨ä¼ é€’å½“å‰è¡¨å•çš„å®Œæ•´æäº¤æ•°æ®ç»™åç«¯**ã€‚

#### ä¸ºä»€ä¹ˆéœ€è¦ä¼ é€’å®Œæ•´è¡¨å•çŠ¶æ€ï¼Ÿ

åœ¨å®é™…ä¸šåŠ¡åœºæ™¯ä¸­ï¼Œç»„ä»¶çš„å›è°ƒæ•°æ®å¾€å¾€ä¾èµ–äºå…¶ä»–å­—æ®µçš„å€¼ï¼š

1. **ä¼šå‘˜å¡åœºæ™¯**ï¼šé€‰æ‹©å•†å“æ—¶ï¼Œéœ€è¦æ ¹æ®å½“å‰é€‰æ‹©çš„ä¼šå‘˜å¡è¿”å›ä¸åŒçš„ä»·æ ¼
   - ç”¨æˆ·é€‰æ‹©äº†"ä¼šå‘˜å¡1" â†’ è¿”å›ä¼šå‘˜ä»·å•†å“åˆ—è¡¨
   - ç”¨æˆ·é€‰æ‹©äº†"ä¼šå‘˜å¡2" â†’ è¿”å›VIPä»·å•†å“åˆ—è¡¨

2. **éƒ¨é—¨-ç”¨æˆ·åœºæ™¯**ï¼šé€‰æ‹©ç”¨æˆ·æ—¶ï¼Œéœ€è¦æ ¹æ®å½“å‰é€‰æ‹©çš„éƒ¨é—¨è¿”å›è¯¥éƒ¨é—¨çš„ç”¨æˆ·
   - ç”¨æˆ·é€‰æ‹©äº†"æŠ€æœ¯éƒ¨" â†’ è¿”å›æŠ€æœ¯éƒ¨çš„å‘˜å·¥åˆ—è¡¨
   - ç”¨æˆ·é€‰æ‹©äº†"é”€å”®éƒ¨" â†’ è¿”å›é”€å”®éƒ¨çš„å‘˜å·¥åˆ—è¡¨

3. **çœå¸‚åŒºçº§è”åœºæ™¯**ï¼šé€‰æ‹©åŸå¸‚æ—¶ï¼Œéœ€è¦æ ¹æ®å½“å‰é€‰æ‹©çš„çœä»½è¿”å›è¯¥çœä»½çš„åŸå¸‚
   - ç”¨æˆ·é€‰æ‹©äº†"å¹¿ä¸œçœ" â†’ è¿”å›å¹¿ä¸œçœçš„åŸå¸‚åˆ—è¡¨
   - ç”¨æˆ·é€‰æ‹©äº†"æµ™æ±Ÿçœ" â†’ è¿”å›æµ™æ±Ÿçœçš„åŸå¸‚åˆ—è¡¨

#### å®ç°æ–¹å¼

```typescript
// å‰ç«¯ï¼šç”¨æˆ·ç‚¹å‡» Select ç»„ä»¶
SelectWidget.handleOpenDialog() {
  // ğŸ”¥ æ ¸å¿ƒï¼šè·å–å½“å‰è¡¨å•çš„å®Œæ•´æäº¤æ•°æ®
  const request = formManager.prepareSubmitData()
  // {
  //   member_card_id: 1,        // å½“å‰é€‰æ‹©çš„ä¼šå‘˜å¡
  //   products: [
  //     { product_id: null, quantity: 2 }
  //   ]
  // }
  
  // è°ƒç”¨å›è°ƒï¼Œä¼ é€’å®Œæ•´è¡¨å•çŠ¶æ€
  await callbackManager.executeSelectFuzzy(
    field,
    searchKeyword,
    formManager  // CallbackManager ä¼šè‡ªåŠ¨è°ƒç”¨ prepareSubmitData()
  )
}

// åç«¯ï¼šæ ¹æ®è¡¨å•çŠ¶æ€è¿”å›é’ˆå¯¹æ€§æ•°æ®
func OnSelectFuzzy(ctx *runner.Context, req *OnSelectFuzzyReq) (*OnSelectFuzzyResp, error) {
    // ğŸ”¥ åç«¯å¯ä»¥è®¿é—®ç”¨æˆ·çš„å®Œæ•´è¡¨å•çŠ¶æ€
    memberCardID := req.Request["member_card_id"]
    
    // æ ¹æ®ä¼šå‘˜å¡è¿”å›ä¸åŒçš„å•†å“åˆ—è¡¨
    if memberCardID == 1 {
        // è¿”å›ä¼šå‘˜ä»·å•†å“åˆ—è¡¨
        products = getProductsWithMemberPrice(memberCardID)
    } else if memberCardID == 2 {
        // è¿”å›VIPä»·å•†å“åˆ—è¡¨
        products = getProductsWithVIPPrice(memberCardID)
    }
    
    return &OnSelectFuzzyResp{
        Values: products,
        Statistics: map[string]interface{}{
            "å•†å“åŸä»·(å…ƒ)": "sum(ä»·æ ¼,*quantity)",
            "ä¼šå‘˜ä»·æ ¼(å…ƒ)": "sum(ä»·æ ¼,*quantity,*0.9)",
        },
    }, nil
}
```

#### ä¼˜åŠ¿

âœ… **ç»„ä»¶æ— éœ€å…³å¿ƒä¾èµ–å…³ç³»**ï¼šç»„ä»¶ä¸éœ€è¦æ‰‹åŠ¨æŒ‡å®šä¾èµ–å“ªäº›å­—æ®µï¼ŒCallbackManager è‡ªåŠ¨ä¼ é€’æ‰€æœ‰æ•°æ®
âœ… **åç«¯çµæ´»å†³ç­–**ï¼šåç«¯æ ¹æ®å®é™…ä¸šåŠ¡é€»è¾‘ï¼Œè‡ªç”±é€‰æ‹©ä½¿ç”¨å“ªäº›å­—æ®µ
âœ… **æ”¯æŒå¤æ‚åœºæ™¯**ï¼šå¤šå±‚çº§è”ã€å¤šå­—æ®µè”åŠ¨ï¼Œéƒ½å¯ä»¥è½»æ¾å®ç°
âœ… **ä¾¿äºæ‰©å±•**ï¼šæ–°å¢å­—æ®µä¾èµ–ï¼Œå‰ç«¯ä»£ç æ— éœ€ä¿®æ”¹

---

### 3.1 å›è°ƒç®¡ç†å™¨ï¼ˆCallbackManagerï¼‰

```typescript
/**
 * å›è°ƒç»“æœçš„æ ‡å‡†æ ¼å¼
 */
interface CallbackResult {
  // å•é€‰ï¼švaluesåŒ…å«ä¸€ä¸ªé€‰é¡¹
  // å¤šé€‰ï¼švaluesåŒ…å«å¤šä¸ªé€‰é¡¹
  values: SelectOption[]
  
  // èšåˆç»Ÿè®¡ä¿¡æ¯ï¼ˆç”¨äºlistå†…çš„selectå¤šé€‰ï¼‰
  statistics?: Record<string, string>
  
  // æ˜¯å¦å¤šé€‰
  multiple: boolean
}

/**
 * å›è°ƒç®¡ç†å™¨
 */
class CallbackManager {
  /**
   * æ‰§è¡Œ OnSelectFuzzy å›è°ƒ
   * @param field å­—æ®µé…ç½®
   * @param searchValue æœç´¢å€¼ï¼ˆå¯é€‰ï¼‰
   * @param formManager è¡¨å•æ•°æ®ç®¡ç†å™¨ï¼ˆè‡ªåŠ¨æå– prepareSubmitData()ï¼‰
   */
  async executeSelectFuzzy(
    field: FieldConfig,
    searchValue?: string,
    formManager?: ReactiveFormDataManager
  ): Promise<CallbackResult> {
    
    // ğŸ”¥ æ ¸å¿ƒï¼šè‡ªåŠ¨æå–å½“å‰è¡¨å•çš„å®Œæ•´æäº¤æ•°æ®
    const request = formManager ? formManager.prepareSubmitData() : {}
    
    console.log('[CallbackManager] OnSelectFuzzy å›è°ƒè¯·æ±‚:', {
      field: field.code,
      searchValue: searchValue,
      formState: request  // åç«¯å¯ä»¥çœ‹åˆ°ç”¨æˆ·å½“å‰çš„å®Œæ•´è¡¨å•çŠ¶æ€
    })
    
    const requestData = {
      code: field.code,
      value: searchValue || '',
      request: request,  // ğŸ”¥ ä¼ é€’æ•´ä¸ªè¡¨å•æ•°æ®ä½œä¸ºä¸Šä¸‹æ–‡
      input_type: searchValue ? undefined : 'by_field_value'
    }
    
    const response = await post(
      `/api/v1/callback${router}?_type=OnSelectFuzzy&_method=${method}`,
      requestData
    )
    
    return {
      values: response.data.values || [],
      statistics: response.data.statistics,  // ğŸ”¥ èšåˆè¡¨è¾¾å¼é…ç½®ï¼ˆListåœºæ™¯ï¼‰
      multiple: response.multiple || false
    }
  }
  
  /**
   * by_values å›æƒ³åŠŸèƒ½
   * é€šè¿‡ value åæŸ¥æ˜¾ç¤ºä¿¡æ¯
   */
  async recallByValue(
    field: FieldConfig,
    value: any,
    context?: Record<string, any>
  ): Promise<SelectOption | undefined> {
    
    const result = await this.executeSelectFuzzy(field, undefined, {
      ...context,
      [field.code]: value
    })
    
    return result.values[0]
  }
}
```

---

## 4. èšåˆç»Ÿè®¡ç³»ç»Ÿ

### æ ¸å¿ƒæœºåˆ¶ï¼šä»å›è°ƒå“åº”è·å–èšåˆé…ç½® ğŸ”¥

èšåˆç»Ÿè®¡ç³»ç»Ÿç”¨äº **Select/MultiSelect ç»„ä»¶**ï¼Œå®ç°å®æ—¶çš„æ•°æ®èšåˆè®¡ç®—ï¼ˆå¦‚å•†å“æ€»ä»·ã€æ€»æ•°é‡ã€å¹³å‡ä»·æ ¼ç­‰ï¼‰ã€‚

#### æ”¯æŒçš„å››ç§èšåˆåœºæ™¯

1. **é¡¶å±‚ MultiSelect èšåˆ** - ç”¨æˆ·ç›´æ¥å¤šé€‰å•†å“
   - åœºæ™¯ï¼šè¡¨å•ä¸­ç›´æ¥æœ‰ä¸€ä¸ªå¤šé€‰å­—æ®µï¼Œä¾‹å¦‚ `æ¨èå•†å“`
   - æ•°æ®æºï¼šé€‰ä¸­çš„å¤šä¸ªé€‰é¡¹çš„ `displayInfo`
   - èšåˆå±‚çº§ï¼šå•å±‚
   - æ˜¾ç¤ºä½ç½®ï¼šåœ¨ MultiSelect ç»„ä»¶ä¸‹æ–¹æˆ–æ—è¾¹

2. **Struct å†… MultiSelect èšåˆ** - Struct å†…çš„å¤šé€‰å­—æ®µ
   - åœºæ™¯ï¼šåœ¨ Structï¼ˆForm ç»„ä»¶ï¼‰å†…æœ‰ä¸€ä¸ªå¤šé€‰å­—æ®µ
   - æ•°æ®æºï¼šé€‰ä¸­çš„å¤šä¸ªé€‰é¡¹çš„ `displayInfo`
   - èšåˆå±‚çº§ï¼šå•å±‚
   - æ˜¾ç¤ºä½ç½®ï¼šåœ¨ Struct å†…çš„ MultiSelect ä¸‹æ–¹

3. **List å†… Select èšåˆ** - List ä¸­æ¯è¡Œé€‰æ‹©å•†å“
   - åœºæ™¯ï¼šList ç»„ä»¶ï¼Œæ¯è¡Œå•é€‰ä¸€ä¸ªå•†å“ï¼ˆå¦‚æ”¶é“¶å°å•†å“æ¸…å•ï¼‰
   - æ•°æ®æºï¼šæ‰€æœ‰è¡Œçš„ `displayInfo` + åŒè¡Œå…¶ä»–å­—æ®µï¼ˆå¦‚æ•°é‡ï¼‰
   - èšåˆå±‚çº§ï¼šå•å±‚ï¼ˆList å±‚ï¼‰
   - æ˜¾ç¤ºä½ç½®ï¼šåœ¨ List åº•éƒ¨

4. **List å†… MultiSelect èšåˆï¼ˆæœ€å¤æ‚ï¼‰** - List ä¸­æ¯è¡Œå¤šé€‰å•†å“ï¼Œ**ä¸¤å±‚èšåˆ**
   - åœºæ™¯ï¼šç”¨æˆ·é‡‡è´­ç™»è®°ï¼Œæ¯è¡Œæ˜¯ä¸€ä¸ªç”¨æˆ·ï¼Œæ¯ä¸ªç”¨æˆ·å¤šé€‰å•†å“
   - æ•°æ®æºï¼š
     - ç¬¬ä¸€å±‚ï¼ˆè¡Œå†…ï¼‰ï¼šé€‰ä¸­çš„å¤šä¸ªé€‰é¡¹çš„ `displayInfo`
     - ç¬¬äºŒå±‚ï¼ˆListï¼‰ï¼šæ‰€æœ‰è¡Œçš„è¡Œå†…ç»Ÿè®¡ç»“æœ
   - èšåˆå±‚çº§ï¼š**ä¸¤å±‚**
     - ç¬¬ä¸€å±‚ï¼šMultiSelect è‡ªå·±èšåˆï¼ˆè®¡ç®—è¿™ä¸ªç”¨æˆ·çš„å•†å“æ•°ã€æ€»ä»·ï¼‰
     - ç¬¬äºŒå±‚ï¼šListWidget èšåˆæ‰€æœ‰è¡Œï¼ˆè®¡ç®—æ‰€æœ‰ç”¨æˆ·çš„å•†å“æ•°ã€æ€»ä»·ï¼‰
   - æ˜¾ç¤ºä½ç½®ï¼š
     - è¡Œå†…ç»Ÿè®¡ï¼šåœ¨æ¯ä¸ª MultiSelect ä¸‹æ–¹
     - List ç»Ÿè®¡ï¼šåœ¨ List åº•éƒ¨

#### å·¥ä½œæµç¨‹

1. **åç«¯è¿”å›èšåˆè¡¨è¾¾å¼é…ç½®**
   - åç«¯åœ¨ `OnSelectFuzzy` å›è°ƒå“åº”ä¸­è¿”å› `statistics` å­—æ®µ
   - `statistics` åŒ…å«èšåˆè¡¨è¾¾å¼

2. **å‰ç«¯ä¿å­˜å¹¶ç›‘å¬**
   - **MultiSelect åœºæ™¯**ï¼šMultiSelect ç»„ä»¶ä¿å­˜ `statistics`ï¼Œç›‘å¬è‡ªå·±çš„å€¼å˜åŒ–
   - **List åœºæ™¯**ï¼šListWidget ä¿å­˜ `statistics`ï¼Œç›‘å¬æ‰€æœ‰è¡Œæ•°æ®å˜åŒ–

3. **å®æ—¶è®¡ç®—å’Œæ˜¾ç¤º**
   - å½“æ•°æ®å˜åŒ–æ—¶ï¼Œè‡ªåŠ¨é‡æ–°è®¡ç®—èšåˆç»Ÿè®¡
   - **MultiSelect**ï¼šæ˜¾ç¤ºåœ¨ç»„ä»¶ä¸‹æ–¹/æ—è¾¹
   - **List**ï¼šæ˜¾ç¤ºåœ¨ List åº•éƒ¨

#### ç¤ºä¾‹ 1ï¼šé¡¶å±‚ MultiSelect èšåˆ

```typescript
// åœºæ™¯ï¼šç”¨æˆ·åœ¨è¡¨å•ä¸­å¤šé€‰æ¨èå•†å“ï¼ˆä¸åœ¨ List å†…ï¼‰
{
  user_profile: {
    relationship: ["family", "friend"],
    preferences: ["music", "sports"],
    recommended_products: [101, 102, 103]  // ğŸ”¥ MultiSelectï¼Œé€‰ä¸­3ä¸ªå•†å“
  }
}

// åç«¯å›è°ƒå“åº”
{
  "values": [
    {
      "value": 101,
      "label": "å•†å“A - Â¥5.00",
      "displayInfo": {
        "å•†å“åç§°": "å•†å“A",
        "ä»·æ ¼": 5.0,        // ğŸ”¥ å‚ä¸èšåˆè®¡ç®—
        "åº“å­˜": 100
      }
    },
    {
      "value": 102,
      "label": "å•†å“B - Â¥8.00",
      "displayInfo": {
        "å•†å“åç§°": "å•†å“B",
        "ä»·æ ¼": 8.0,
        "åº“å­˜": 50
      }
    },
    {
      "value": 103,
      "label": "å•†å“C - Â¥3.00",
      "displayInfo": {
        "å•†å“åç§°": "å•†å“C",
        "ä»·æ ¼": 3.0,
        "åº“å­˜": 80
      }
    }
  ],
  "statistics": {
    // ğŸ”¥ é’ˆå¯¹é€‰ä¸­çš„å¤šä¸ªå•†å“è¿›è¡Œèšåˆ
    "æ¨èå•†å“æ•°": "count(ä»·æ ¼)",           // 3
    "æ€»ä»·å€¼": "sum(ä»·æ ¼)",                // 16.0
    "å¹³å‡ä»·æ ¼": "avg(ä»·æ ¼)",              // 5.33
    "ä»·æ ¼åŒºé—´": "min(ä»·æ ¼) - max(ä»·æ ¼)"   // 3.0 - 8.0
  }
}

// å‰ç«¯ MultiSelect ç»„ä»¶
const MultiSelectWidget = {
  render(props) {
    const selectedValues = ref([101, 102, 103])
    const statistics = ref<Record<string, any>>({})
    const statisticsConfig = ref<Record<string, string>>({})
    
    // ğŸ”¥ ç›‘å¬é€‰ä¸­å€¼å˜åŒ–ï¼Œè‡ªåŠ¨é‡æ–°è®¡ç®—ç»Ÿè®¡
    watch(
      () => selectedValues.value,
      () => {
        updateStatistics()
      },
      { deep: true }
    )
    
    const updateStatistics = () => {
      // ä»å·²é€‰æ‹©çš„é€‰é¡¹ä¸­æå– displayInfo
      const selectedOptions = options.value.filter(opt => 
        selectedValues.value.includes(opt.value)
      )
      
      const data = selectedOptions.map(opt => opt.displayInfo)
      // data = [
      //   { å•†å“åç§°: "å•†å“A", ä»·æ ¼: 5.0, åº“å­˜: 100 },
      //   { å•†å“åç§°: "å•†å“B", ä»·æ ¼: 8.0, åº“å­˜: 50 },
      //   { å•†å“åç§°: "å•†å“C", ä»·æ ¼: 3.0, åº“å­˜: 80 }
      // ]
      
      const result: Record<string, any> = {}
      for (const [label, expression] of Object.entries(statisticsConfig.value)) {
        // ğŸ”¥ ä½¿ç”¨è¡¨è¾¾å¼è§£æå™¨è®¡ç®—
        result[label] = parser.evaluate(expression, data)
      }
      
      statistics.value = result
      // { "æ¨èå•†å“æ•°": 3, "æ€»ä»·å€¼": 16.0, "å¹³å‡ä»·æ ¼": 5.33, "ä»·æ ¼åŒºé—´": "3.0 - 8.0" }
    }
    
    return h('div', [
      h(ElSelect, {
        modelValue: selectedValues.value,
        multiple: true,
        onChange: (val) => selectedValues.value = val
      }),
      
      // ğŸ”¥ æ˜¾ç¤ºç»Ÿè®¡ä¿¡æ¯ï¼ˆåœ¨ MultiSelect ä¸‹æ–¹ï¼‰
      h('div', { class: 'multiselect-statistics' },
        Object.entries(statistics.value).map(([label, value]) =>
          h('div', { class: 'stat-item' }, [
            h('span', { class: 'stat-label' }, label + ':'),
            h('span', { class: 'stat-value' }, value)
          ])
        )
      )
    ])
  }
}
```

#### ç¤ºä¾‹ 2ï¼šList å†… Select èšåˆï¼ˆå¸¦æ•°é‡ï¼‰

```typescript
// åç«¯å“åº”ç¤ºä¾‹
{
  "values": [
    {
      "value": 101,
      "label": "å•†å“A - Â¥5.00",
      "displayInfo": {
        "å•†å“åç§°": "å•†å“A",
        "ä»·æ ¼": 5.0,        // ğŸ”¥ è¿™ä¸ªä»·æ ¼ä¼šå‚ä¸èšåˆè®¡ç®—
        "åº“å­˜": 100,
        "åˆ†ç±»": "ç”µå­äº§å“"
      }
    }
  ],
  "statistics": {
    // ğŸ”¥ èšåˆè¡¨è¾¾å¼é…ç½®
    "å•†å“åŸä»·(å…ƒ)": "sum(ä»·æ ¼,*quantity)",      // ä»·æ ¼ * æ•°é‡ï¼Œæ±‚å’Œ
    "ä¼šå‘˜ä»·æ ¼(å…ƒ)": "sum(ä»·æ ¼,*quantity,*0.9)", // ä»·æ ¼ * æ•°é‡ * 0.9ï¼Œæ±‚å’Œ
    "ä¼˜æƒ é‡‘é¢(å…ƒ)": "sum(ä»·æ ¼,*quantity,*0.1)", // ä»·æ ¼ * æ•°é‡ * 0.1ï¼Œæ±‚å’Œ
    "å•†å“ç§ç±»": "count(ä»·æ ¼)",                   // å•†å“ç§ç±»æ•°
    "å•†å“æ€»æ•°": "sum(quantity)"                  // æ•°é‡æ±‚å’Œ
  }
}

// å‰ç«¯ä½¿ç”¨ç¤ºä¾‹
const ListWidget = {
  render(props) {
    // ç›‘å¬æ‰€æœ‰è¡Œæ•°æ®å˜åŒ–
    watch(
      () => this.getAllRowsData(),
      () => {
        // ğŸ”¥ è‡ªåŠ¨é‡æ–°è®¡ç®—èšåˆç»Ÿè®¡
        this.updateStatistics()
      },
      { deep: true }
    )
    
    // ...
    
    // åœ¨ List åº•éƒ¨æ˜¾ç¤ºç»Ÿè®¡
    return h('div', [
      this.renderTable(),
      this.renderStatistics()  // å•†å“åŸä»·: Â¥100.00, ä¼šå‘˜ä»·æ ¼: Â¥90.00, ...
    ])
  },
  
  updateStatistics() {
    const config = this.statisticsConfig  // ä»å›è°ƒå“åº”è·å–çš„é…ç½®
    const result: Record<string, any> = {}
    
    for (const [label, expression] of Object.entries(config)) {
      // ğŸ”¥ ä½¿ç”¨è¡¨è¾¾å¼è§£æå™¨è®¡ç®—
      result[label] = parser.evaluate(expression, this.getAllRowsData())
    }
    
    this.statistics.value = result
  }
}
```

#### æ•°æ®æ¥æºï¼šdisplayInfo å’Œå­—æ®µå€¼

èšåˆè®¡ç®—æ—¶ï¼Œæ•°æ®å¯ä»¥æ¥è‡ªä¸¤ä¸ªåœ°æ–¹ï¼š

1. **displayInfo**ï¼šå›è°ƒè¿”å›çš„é¢å¤–ä¿¡æ¯ï¼ˆå¦‚ä»·æ ¼ã€åº“å­˜ï¼‰
   - å­˜å‚¨åœ¨ `FieldValue.meta.displayInfo`
   - ä¾‹å¦‚ï¼šé€‰æ‹©å•†å“åï¼ŒdisplayInfo åŒ…å« `{ ä»·æ ¼: 5.0, åº“å­˜: 100 }`

2. **å­—æ®µå€¼**ï¼šç”¨æˆ·è¾“å…¥çš„å€¼ï¼ˆå¦‚æ•°é‡ï¼‰
   - å­˜å‚¨åœ¨ `FieldValue.raw`
   - ä¾‹å¦‚ï¼šç”¨æˆ·è¾“å…¥çš„ `quantity: 2`

è¡¨è¾¾å¼è§£æå™¨ä¼šåˆå¹¶è¿™ä¸¤ä¸ªæ•°æ®æºï¼Œç„¶åè¿›è¡Œè®¡ç®—ï¼š

```typescript
// æ¯ä¸€è¡Œçš„æ•°æ®
{
  price: 5.0,      // ğŸ”¥ æ¥è‡ª displayInfo
  stock: 100,      // ğŸ”¥ æ¥è‡ª displayInfo
  quantity: 2      // ğŸ”¥ æ¥è‡ªç”¨æˆ·è¾“å…¥
}

// è®¡ç®—è¡¨è¾¾å¼ï¼šsum(ä»·æ ¼,*quantity)
// ç»“æœï¼š5.0 * 2 = 10.0
```

---

### 4.1 ç»Ÿè®¡è¡¨è¾¾å¼è§£æå™¨

```typescript
/**
 * ç»Ÿè®¡è¡¨è¾¾å¼è§£æå™¨
 * è§£æç±»ä¼¼ "sum(ä»·æ ¼,*quantity,*0.9)" çš„è¡¨è¾¾å¼
 */
class StatisticsExpressionParser {
  /**
   * è§£æè¡¨è¾¾å¼
   * @param expr è¡¨è¾¾å¼ï¼Œå¦‚ "sum(ä»·æ ¼,*quantity,*0.9)"
   * @param dataSource æ•°æ®æºï¼ˆlistçš„æ‰€æœ‰è¡Œï¼‰
   * @param currentRow å½“å‰è¡Œï¼ˆç”¨äºè·å–åŒçº§å­—æ®µï¼‰
   * @returns è®¡ç®—ç»“æœ
   */
  evaluate(
    expr: string,
    dataSource: any[],
    currentRow?: any
  ): number {
    
    // è§£æå‡½æ•°åå’Œå‚æ•°
    const match = expr.match(/^(\w+)\((.*)\)$/)
    if (!match) {
      throw new Error(`Invalid expression: ${expr}`)
    }
    
    const [, funcName, argsStr] = match
    const args = argsStr.split(',').map(s => s.trim())
    
    // æ ¹æ®å‡½æ•°åæ‰§è¡Œä¸åŒçš„èšåˆé€»è¾‘
    switch (funcName) {
      case 'sum':
        return this.evaluateSum(args, dataSource, currentRow)
      
      case 'avg':
        return this.evaluateAvg(args, dataSource, currentRow)
      
      case 'count':
        return dataSource.length
      
      case 'max':
        return this.evaluateMax(args, dataSource, currentRow)
      
      case 'min':
        return this.evaluateMin(args, dataSource, currentRow)
      
      default:
        throw new Error(`Unknown function: ${funcName}`)
    }
  }
  
  /**
   * è®¡ç®— sum
   * ä¾‹å¦‚ï¼šsum(ä»·æ ¼,*quantity,*0.9)
   * è¡¨ç¤ºï¼šå¯¹æ¯è¡Œè®¡ç®— ä»·æ ¼ * quantity * 0.9ï¼Œç„¶åæ±‚å’Œ
   */
  private evaluateSum(
    args: string[],
    dataSource: any[],
    currentRow?: any
  ): number {
    
    let total = 0
    
    for (const row of dataSource) {
      let rowValue = 1
      
      for (const arg of args) {
        if (arg.startsWith('*')) {
          // ä¹˜æ³•è¿ç®—ç¬¦
          const factor = parseFloat(arg.substring(1))
          if (!isNaN(factor)) {
            rowValue *= factor
          } else {
            // æ˜¯å­—æ®µå
            const fieldName = arg.substring(1)
            const fieldValue = this.getFieldValue(row, fieldName)
            rowValue *= fieldValue
          }
        } else {
          // å­—æ®µå
          const fieldValue = this.getFieldValue(row, arg)
          rowValue *= fieldValue
        }
      }
      
      total += rowValue
    }
    
    return total
  }
  
  /**
   * è·å–å­—æ®µå€¼
   * æ”¯æŒä» display_info æˆ–å½“å‰è¡Œè·å–
   */
  private getFieldValue(row: any, fieldName: string): number {
    // å…ˆä» display_info æŸ¥æ‰¾
    const displayInfo = row._displayInfo || {}
    if (fieldName in displayInfo) {
      return parseFloat(displayInfo[fieldName]) || 0
    }
    
    // å†ä»å½“å‰è¡ŒæŸ¥æ‰¾
    const value = row[fieldName]
    
    // å¦‚æœæ˜¯ FieldValue æ ¼å¼ï¼Œæå– raw
    if (value && typeof value === 'object' && 'raw' in value) {
      return parseFloat(value.raw) || 0
    }
    
    return parseFloat(value) || 0
  }
}
```

### 4.2 åœ¨ ListWidget ä¸­é›†æˆç»Ÿè®¡

```typescript
const ListWidget: IWidget = {
  render(props: WidgetRenderProps) {
    const { field, value, onChange } = props
    const listData = Array.isArray(value.raw) ? value.raw : []
    
    // è®¡ç®—ç»Ÿè®¡ä¿¡æ¯
    const statistics = this.calculateStatistics(field, listData)
    
    return h('div', { class: 'list-widget' }, [
      // è¡¨æ ¼
      this.renderTable(field, listData, onChange),
      
      // ç»Ÿè®¡ä¿¡æ¯å±•ç¤º
      statistics && h('div', { class: 'statistics-panel' }, [
        Object.entries(statistics).map(([key, value]) =>
          h('div', { class: 'stat-item' }, [
            h('span', { class: 'stat-label' }, key),
            h('span', { class: 'stat-value' }, value)
          ])
        )
      ])
    ])
  },
  
  calculateStatistics(
    field: FieldConfig,
    listData: any[]
  ): Record<string, string> | undefined {
    
    // ä»æœ€åä¸€æ¬¡å›è°ƒç»“æœä¸­è·å–ç»Ÿè®¡è¡¨è¾¾å¼
    const statisticsConfig = field._lastCallbackResult?.statistics
    if (!statisticsConfig) {
      return undefined
    }
    
    const parser = new StatisticsExpressionParser()
    const result: Record<string, string> = {}
    
    for (const [label, expr] of Object.entries(statisticsConfig)) {
      try {
        const value = parser.evaluate(expr, listData)
        result[label] = this.formatStatValue(value)
      } catch (error) {
        console.error(`Failed to evaluate statistics: ${expr}`, error)
        result[label] = 'N/A'
      }
    }
    
    return result
  }
}
```

---

## 5. URLå‚æ•°æŒä¹…åŒ–

### 5.1 URLå‚æ•°ç®¡ç†å™¨

```typescript
/**
 * URLå‚æ•°ç®¡ç†å™¨
 * å®ç°è¡¨å•æ•°æ®ä¸URLå‚æ•°çš„åŒå‘åŒæ­¥
 */
class UrlParamsManager {
  /**
   * å°†è¡¨å•æ•°æ®åºåˆ—åŒ–åˆ°URL
   * @param formData è¡¨å•æ•°æ®ï¼ˆæ¥è‡ª FormDataManagerï¼‰
   */
  serializeToUrl(formData: Record<string, FieldValue>): void {
    const params = new URLSearchParams()
    
    for (const [code, fieldValue] of Object.entries(formData)) {
      // å°† FieldValue åºåˆ—åŒ–ä¸ºå­—ç¬¦ä¸²
      const serialized = this.serializeFieldValue(fieldValue)
      if (serialized !== null) {
        params.set(code, serialized)
      }
    }
    
    // æ›´æ–°URLï¼ˆä¸åˆ·æ–°é¡µé¢ï¼‰
    const url = `${location.pathname}?${params.toString()}`
    history.replaceState(null, '', url)
  }
  
  /**
   * ä»URLæ¢å¤è¡¨å•æ•°æ®
   * @param manager FormDataManagerå®ä¾‹
   */
  async deserializeFromUrl(manager: FormDataManager): Promise<void> {
    const params = new URLSearchParams(location.search)
    
    for (const [code, value] of params) {
      // ååºåˆ—åŒ–å¹¶åŠ è½½åˆ°è¡¨å•
      await manager.loadFromUrlParam(code, value)
    }
  }
  
  /**
   * åºåˆ—åŒ– FieldValue
   */
  private serializeFieldValue(fieldValue: FieldValue): string | null {
    // åªåºåˆ—åŒ– raw å€¼
    const raw = fieldValue.raw
    
    if (raw === null || raw === undefined || raw === '') {
      return null
    }
    
    // å¯¹äºå¯¹è±¡å’Œæ•°ç»„ï¼Œä½¿ç”¨JSONåºåˆ—åŒ–
    if (typeof raw === 'object') {
      return JSON.stringify(raw)
    }
    
    return String(raw)
  }
}
```

---

## 6. æ•´ä½“æ•°æ®æµ

```
ç”¨æˆ·è¾“å…¥
  â†“
Widgetç»„ä»¶å¤„ç†
  â†“
è½¬æ¢ä¸º FieldValue
  â†“
FormDataManager.setValue()
  â†“
[å¯é€‰] è§¦å‘å›è°ƒ â†’ CallbackManager
  â†“
[å¯é€‰] æ›´æ–°ç»Ÿè®¡ â†’ StatisticsExpressionParser
  â†“
æ›´æ–°UIæ˜¾ç¤º
  â†“
ç”¨æˆ·ç‚¹å‡»æäº¤
  â†“
FormDataManager.prepareSubmitData()
  â†“
ç±»å‹è½¬æ¢ + éªŒè¯
  â†“
æäº¤åˆ°åç«¯
```

---

## 7. ç›®å½•ç»“æ„

```
web/src/
â”œâ”€â”€ components/
â”‚   â”œâ”€â”€ form/
â”‚   â”‚   â”œâ”€â”€ FormRenderer.vue          # ä¸»æ¸²æŸ“å™¨ï¼ˆè½»é‡çº§ï¼Œåªè´Ÿè´£å¸ƒå±€ï¼‰
â”‚   â”‚   â”œâ”€â”€ widgets/                  # æ‰€æœ‰widgetç»„ä»¶
â”‚   â”‚   â”‚   â”œâ”€â”€ InputWidget.vue
â”‚   â”‚   â”‚   â”œâ”€â”€ SelectWidget.vue
â”‚   â”‚   â”‚   â”œâ”€â”€ NumberWidget.vue
â”‚   â”‚   â”‚   â”œâ”€â”€ ListWidget.vue        # æ”¯æŒé€’å½’æ¸²æŸ“
â”‚   â”‚   â”‚   â”œâ”€â”€ TextAreaWidget.vue
â”‚   â”‚   â”‚   â”œâ”€â”€ FileUploadWidget.vue
â”‚   â”‚   â”‚   â””â”€â”€ index.ts              # Widgetå·¥å‚
â”‚   â”‚   â”œâ”€â”€ dialogs/                  # å¯¹è¯æ¡†ç»„ä»¶
â”‚   â”‚   â”‚   â”œâ”€â”€ FuzzySearchDialog.vue # æ¨¡ç³Šæœç´¢å¯¹è¯æ¡†
â”‚   â”‚   â”‚   â””â”€â”€ ListItemDialog.vue    # Listé¡¹ç¼–è¾‘å¯¹è¯æ¡†
â”‚   â”‚   â””â”€â”€ shared/                   # å…±äº«ç»„ä»¶
â”‚   â”‚       â”œâ”€â”€ FieldLabel.vue
â”‚   â”‚       â””â”€â”€ ValidationMessage.vue
â”‚   â””â”€â”€ table/
â”‚       â”œâ”€â”€ TableRenderer.vue
â”‚       â””â”€â”€ ...
â”œâ”€â”€ core/
â”‚   â”œâ”€â”€ form/
â”‚   â”‚   â”œâ”€â”€ FormDataManager.ts        # è¡¨å•æ•°æ®ç®¡ç†å™¨
â”‚   â”‚   â”œâ”€â”€ FieldValue.ts             # FieldValueç±»å‹å®šä¹‰
â”‚   â”‚   â”œâ”€â”€ TypeConverter.ts          # ç±»å‹è½¬æ¢å™¨
â”‚   â”‚   â””â”€â”€ Validator.ts              # éªŒè¯å™¨
â”‚   â”œâ”€â”€ callback/
â”‚   â”‚   â”œâ”€â”€ CallbackManager.ts        # å›è°ƒç®¡ç†å™¨
â”‚   â”‚   â””â”€â”€ types.ts
â”‚   â”œâ”€â”€ statistics/
â”‚   â”‚   â”œâ”€â”€ ExpressionParser.ts       # è¡¨è¾¾å¼è§£æå™¨
â”‚   â”‚   â””â”€â”€ Calculator.ts             # è®¡ç®—å™¨
â”‚   â””â”€â”€ url/
â”‚       â””â”€â”€ UrlParamsManager.ts       # URLå‚æ•°ç®¡ç†å™¨
â””â”€â”€ types/
    â”œâ”€â”€ form.ts                       # è¡¨å•ç›¸å…³ç±»å‹
    â”œâ”€â”€ widget.ts                     # Widgetæ¥å£å®šä¹‰
    â””â”€â”€ callback.ts                   # å›è°ƒç›¸å…³ç±»å‹
```

---

## 8. å®æ–½æ­¥éª¤

### é˜¶æ®µ1ï¼šæ ¸å¿ƒåŸºç¡€ï¼ˆ1å‘¨ï¼‰
- [ ] å®šä¹‰ FieldValue ç±»å‹
- [ ] å®ç° FormDataManager
- [ ] å®ç° TypeConverter
- [ ] ç¼–å†™æµ‹è¯•ç”¨ä¾‹

### é˜¶æ®µ2ï¼šç»„ä»¶å·¥å‚ï¼ˆ1å‘¨ï¼‰
- [ ] å®šä¹‰ IWidget æ¥å£
- [ ] å®ç° WidgetFactory
- [ ] é‡æ„ç°æœ‰çš„ç®€å•ç»„ä»¶ï¼ˆInputã€Numberã€Selectï¼‰
- [ ] æµ‹è¯•ç»„ä»¶æ¸²æŸ“

### é˜¶æ®µ3ï¼šå›è°ƒç³»ç»Ÿï¼ˆ1å‘¨ï¼‰
- [ ] å®ç° CallbackManager
- [ ] å®ç° FuzzySearchDialog
- [ ] æ”¹é€  SelectWidget æ”¯æŒå›è°ƒ
- [ ] æµ‹è¯•å›è°ƒåŠŸèƒ½

### é˜¶æ®µ4ï¼šé€’å½’æ¸²æŸ“ï¼ˆ1-2å‘¨ï¼‰
- [ ] å®ç° ListWidget
- [ ] æ”¯æŒåµŒå¥—å­—æ®µæ¸²æŸ“
- [ ] æµ‹è¯•å¤æ‚åµŒå¥—åœºæ™¯

### é˜¶æ®µ5ï¼šèšåˆç»Ÿè®¡ï¼ˆ1å‘¨ï¼‰
- [ ] å®ç° ExpressionParser
- [ ] é›†æˆåˆ° ListWidget
- [ ] æµ‹è¯•ç»Ÿè®¡è®¡ç®—

### é˜¶æ®µ6ï¼šURLæŒä¹…åŒ–ï¼ˆ3å¤©ï¼‰
- [ ] å®ç° UrlParamsManager
- [ ] é›†æˆåˆ° FormRenderer
- [ ] æµ‹è¯•URLåˆ†äº«åŠŸèƒ½

### é˜¶æ®µ7ï¼šé›†æˆæµ‹è¯•ï¼ˆ1å‘¨ï¼‰
- [ ] ç«¯åˆ°ç«¯æµ‹è¯•
- [ ] æ€§èƒ½ä¼˜åŒ–
- [ ] æ–‡æ¡£å®Œå–„

---

## 9. å…³é”®ä¼˜åŠ¿

### vs æ—§ç‰ˆæœ¬

| å¯¹æ¯”é¡¹ | æ—§ç‰ˆæœ¬ | æ–°ç‰ˆæœ¬ |
|-------|-------|-------|
| æ ¸å¿ƒæ–‡ä»¶è¡Œæ•° | ~5000è¡Œ | <500è¡Œ |
| æ•°æ®ç»“æ„ | æ··ä¹± | ç»Ÿä¸€çš„FieldValue |
| ç±»å‹è½¬æ¢ | æ•£è½å„å¤„ | ç»Ÿä¸€åœ¨TypeConverter |
| ç»„ä»¶æ‰©å±• | å›°éš¾ | å®ç°IWidgetæ¥å£å³å¯ |
| é€’å½’æ¸²æŸ“ | é€»è¾‘å¤æ‚ | WidgetFactoryè‡ªåŠ¨å¤„ç† |
| å¯æµ‹è¯•æ€§ | å·® | æ¯ä¸ªæ¨¡å—ç‹¬ç«‹æµ‹è¯• |
| å¯ç»´æŠ¤æ€§ | å·® | èŒè´£æ¸…æ™° |

### æ ¸å¿ƒä¼˜åŠ¿

1. **æ•°æ®ç»“æ„æ¸…æ™°**ï¼šæ‰€æœ‰æ•°æ®éƒ½ç”¨ FieldValue è¡¨ç¤º
2. **èŒè´£åˆ†ç¦»**ï¼šæ¯ä¸ªç±»åªåšä¸€ä»¶äº‹
3. **æ˜“äºæ‰©å±•**ï¼šæ–°å¢ç»„ä»¶åªéœ€å®ç°æ¥å£
4. **ç»Ÿä¸€è½¬æ¢**ï¼šæ‰€æœ‰ç±»å‹è½¬æ¢åœ¨ä¸€å¤„
5. **é€’å½’æ¸²æŸ“**ï¼šé€šè¿‡å·¥å‚æ¨¡å¼è‡ªåŠ¨å¤„ç†
6. **å¯æµ‹è¯•**ï¼šæ¯ä¸ªæ¨¡å—ç‹¬ç«‹ï¼Œæ˜“äºå•å…ƒæµ‹è¯•

---

## 10. ä¸‹ä¸€æ­¥

1. è¯„å®¡è¿™ä¸ªè®¾è®¡æ–¹æ¡ˆ
2. è®¨è®ºæ½œåœ¨é—®é¢˜
3. å¼€å§‹å®æ–½ç¬¬ä¸€é˜¶æ®µ

