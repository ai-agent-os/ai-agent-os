# æ¶æ„è®¾è®¡ - åˆ†äº«è§†å›¾ç³»ç»Ÿ

## æ ¸å¿ƒé—®é¢˜

### é—®é¢˜ 1ï¼šURL å›æƒ³æ–¹æ¡ˆçš„å±€é™æ€§

```
âŒ URL å›æƒ³æ–¹æ¡ˆçš„é—®é¢˜ï¼š
1. éœ€è¦å›è°ƒæ¥å£ï¼ˆOnSelectFuzzy by_field_valuesï¼‰
2. éœ€è¦ç¼“å­˜ç®¡ç†å™¨ï¼ˆRecallCacheManagerï¼‰
3. åŠ è½½æ—¶å¤šæ¬¡è¯·æ±‚ï¼ˆ10 è¡Œ â†’ 2-3 æ¬¡è¯·æ±‚ï¼‰
4. URL é•¿åº¦é™åˆ¶ï¼ˆ2KB-8KBï¼‰
5. æ— æ³•ä¿å­˜å¯Œæ–‡æœ¬ã€å¤§é‡æ•°æ®
6. æ— æ³•ä¿å­˜èšåˆç»Ÿè®¡ä¿¡æ¯
7. æ— æ³•ä¿å­˜ displayInfo
```

### é—®é¢˜ 2ï¼šç›´æ¥åœ¨ URL ä¸­è®°å½•æ‰€æœ‰ä¿¡æ¯

```
âŒ URL ç›´æ¥è®°å½•æ–¹æ¡ˆçš„é—®é¢˜ï¼š
1. URL é•¿åº¦é™åˆ¶ï¼ˆæµè§ˆå™¨é€šå¸¸é™åˆ¶ 2KB-8KBï¼‰
2. å¯Œæ–‡æœ¬ã€å¤§æ•°æ®æ— æ³•å­˜å‚¨
3. å®‰å…¨æ€§é—®é¢˜ï¼ˆæ•æ„Ÿæ•°æ®æš´éœ²åœ¨ URL ä¸­ï¼‰
4. ä¸ç¾è§‚ã€ä¸æ˜“åˆ†äº«
```

### ç¤ºä¾‹ï¼šå¤æ‚è¡¨å•çš„ URL

```typescript
// å‡è®¾ï¼š10 è¡Œå•†å“ï¼Œæ¯è¡Œæœ‰ displayInfo
const formData = {
  member_card: {
    raw: 1,
    display: "é‡‘å¡ä¼šå‘˜",
    meta: { displayInfo: { ä¼šå‘˜ç­‰çº§: "é‡‘å¡", æŠ˜æ‰£: 0.9 } }
  },
  products: [
    {
      product_id: { 
        raw: 1, 
        display: "iPhone 15 Pro - Â¥7999",
        meta: { displayInfo: { å•†å“åç§°: "iPhone 15 Pro", ä»·æ ¼: 7999, åº“å­˜: 50 } }
      },
      quantity: 2
    },
    // ... 9 è¡Œç±»ä¼¼æ•°æ®
  ],
  remarks: "è¿™æ˜¯ä¸€æ®µå¾ˆé•¿çš„å¤‡æ³¨æ–‡å­—ï¼ŒåŒ…å«å¯Œæ–‡æœ¬æ ¼å¼ï¼Œæ¢è¡Œï¼Œç‰¹æ®Šå­—ç¬¦ç­‰..."
}

// ç¼–ç åçš„ URLï¼šè¶…è¿‡ 10KB+
const url = `https://example.com/form?data=${encodeURIComponent(JSON.stringify(formData))}`
// âŒ è¶…è¿‡æµè§ˆå™¨é™åˆ¶ï¼Œæ— æ³•ä½¿ç”¨
```

---

## è§£å†³æ–¹æ¡ˆï¼šåˆ†äº«è§†å›¾ç³»ç»Ÿ âœ…

### æ ¸å¿ƒæ€è·¯

> **ç‚¹å‡»åˆ†äº« â†’ ç”Ÿæˆå¿«ç…§ â†’ ä¿å­˜åˆ°åç«¯ â†’ è¿”å› view_id â†’ URL åªè®°å½• view_id**

```typescript
// ç”¨æˆ·ç‚¹å‡»"åˆ†äº«"æŒ‰é’®
async function handleShare() {
  // 1. ç”Ÿæˆå®Œæ•´å¿«ç…§
  const snapshot = formRenderer.captureSnapshot()
  
  // 2. ä¿å­˜åˆ°åç«¯
  const viewId = await saveSharedView(snapshot)
  // viewId: "abc123xyz"
  
  // 3. ç”Ÿæˆåˆ†äº«é“¾æ¥
  const shareUrl = `https://example.com/form?view_id=abc123xyz`
  
  // 4. å¤åˆ¶åˆ°å‰ªè´´æ¿
  copyToClipboard(shareUrl)
  
  ElMessage.success('åˆ†äº«é“¾æ¥å·²å¤åˆ¶')
}

// å…¶ä»–ç”¨æˆ·æ‰“å¼€é“¾æ¥
async function loadSharedView(viewId: string) {
  // 1. ä»åç«¯åŠ è½½å¿«ç…§
  const snapshot = await getSharedView(viewId)
  
  // 2. æ¢å¤è¡¨å•çŠ¶æ€
  formRenderer.restoreSnapshot(snapshot)
  
  // âœ… ä¸€æ¬¡è¯·æ±‚æå®šï¼Œæ— éœ€å›æƒ³
}
```

---

## æ•°æ®ç»“æ„è®¾è®¡

### 1. å¿«ç…§æ•°æ®ç»“æ„

```typescript
/**
 * åˆ†äº«è§†å›¾å¿«ç…§
 * åŒ…å«è¡¨å•çš„å®Œæ•´çŠ¶æ€
 */
interface SharedViewSnapshot {
  // åŸºç¡€ä¿¡æ¯
  view_id: string                    // è§†å›¾ IDï¼ˆåç«¯ç”Ÿæˆï¼‰
  function_code: string              // å‡½æ•°ä»£ç 
  namespace: string                  // å‘½åç©ºé—´
  app_name: string                   // åº”ç”¨åç§°
  
  // è¡¨å•æ•°æ®ï¼ˆå®Œæ•´çš„ FieldValue ç»“æ„ï¼‰
  form_data: Record<string, FieldValueSnapshot>
  
  // èšåˆç»Ÿè®¡ä¿¡æ¯ï¼ˆå¦‚æœæœ‰ï¼‰
  statistics?: {
    list_statistics?: Record<string, any>    // List å±‚èšåˆ
    field_statistics?: Record<string, any>   // å­—æ®µçº§èšåˆ
  }
  
  // å…ƒæ•°æ®
  metadata: {
    created_at: string               // åˆ›å»ºæ—¶é—´
    created_by?: string              // åˆ›å»ºè€…
    expires_at?: string              // è¿‡æœŸæ—¶é—´
    title?: string                   // æ ‡é¢˜
    description?: string             // æè¿°
  }
  
  // æƒé™ï¼ˆå¯é€‰ï¼‰
  permissions?: {
    is_public: boolean               // æ˜¯å¦å…¬å¼€
    allowed_users?: string[]         // å…è®¸è®¿é—®çš„ç”¨æˆ·åˆ—è¡¨
    password?: string                // è®¿é—®å¯†ç 
  }
}

/**
 * FieldValue å¿«ç…§
 * åŒ…å« rawã€displayã€meta ç­‰å®Œæ•´ä¿¡æ¯
 */
interface FieldValueSnapshot {
  raw: any
  display: string
  meta?: {
    displayInfo?: any                // ğŸ”¥ ä¿å­˜å®Œæ•´ displayInfo
    rowStatistics?: any              // ğŸ”¥ ä¿å­˜è¡Œå†…èšåˆï¼ˆMultiSelectï¼‰
    dataType: string
    fromCallback?: boolean
  }
}
```

### 2. API æ¥å£

```typescript
/**
 * ä¿å­˜åˆ†äº«è§†å›¾
 */
interface SaveSharedViewRequest {
  function_code: string
  namespace: string
  app_name: string
  form_data: Record<string, FieldValueSnapshot>
  statistics?: any
  metadata?: {
    title?: string
    description?: string
    expires_in?: number              // è¿‡æœŸæ—¶é—´ï¼ˆç§’ï¼‰
  }
  permissions?: {
    is_public?: boolean
    allowed_users?: string[]
    password?: string
  }
}

interface SaveSharedViewResponse {
  view_id: string                    // ç”Ÿæˆçš„è§†å›¾ ID
  share_url: string                  // å®Œæ•´çš„åˆ†äº«é“¾æ¥
  expires_at?: string                // è¿‡æœŸæ—¶é—´
}

/**
 * è·å–åˆ†äº«è§†å›¾
 */
interface GetSharedViewRequest {
  view_id: string
  password?: string                  // å¦‚æœéœ€è¦å¯†ç 
}

interface GetSharedViewResponse {
  snapshot: SharedViewSnapshot       // å®Œæ•´å¿«ç…§
}
```

---

## å‰ç«¯å®ç°

### 1. FormRenderer å¿«ç…§åŠŸèƒ½

```typescript
class FormRenderer {
  /**
   * æ•è·å½“å‰è¡¨å•çš„å®Œæ•´å¿«ç…§
   * ğŸ”¥ ä¿å­˜æ‰€æœ‰ FieldValueï¼ˆåŒ…æ‹¬ displayInfoã€èšåˆç­‰ï¼‰
   */
  captureSnapshot(): SharedViewSnapshot {
    console.log('[FormRenderer] å¼€å§‹æ•è·å¿«ç…§')
    
    // 1. è·å–æ‰€æœ‰å­—æ®µçš„ FieldValue
    const formData: Record<string, FieldValueSnapshot> = {}
    
    for (const [fieldPath, fieldValue] of this.formManager.store) {
      formData[fieldPath] = {
        raw: fieldValue.raw,
        display: fieldValue.display,
        meta: fieldValue.meta  // ğŸ”¥ åŒ…å« displayInfoã€rowStatistics ç­‰
      }
    }
    
    // 2. è·å–èšåˆç»Ÿè®¡ä¿¡æ¯
    const statistics = this.captureStatistics()
    
    // 3. æ„å»ºå¿«ç…§
    const snapshot: SharedViewSnapshot = {
      view_id: '',  // åç«¯ç”Ÿæˆ
      function_code: this.functionDetail.code,
      namespace: this.namespace,
      app_name: this.appName,
      form_data: formData,
      statistics: statistics,
      metadata: {
        created_at: new Date().toISOString(),
        title: this.generateTitle(),
        description: ''
      }
    }
    
    console.log('[FormRenderer] å¿«ç…§æ•è·å®Œæˆ:', {
      fields: Object.keys(formData).length,
      size: JSON.stringify(snapshot).length
    })
    
    return snapshot
  }
  
  /**
   * æ•è·èšåˆç»Ÿè®¡ä¿¡æ¯
   */
  private captureStatistics(): any {
    const statistics: any = {}
    
    // éå†æ‰€æœ‰ ListWidgetï¼Œè·å–å…¶èšåˆç»Ÿè®¡
    for (const listWidget of this.listWidgets) {
      if (listWidget.listStatistics) {
        statistics[listWidget.fieldPath] = listWidget.listStatistics
      }
    }
    
    return Object.keys(statistics).length > 0 ? statistics : undefined
  }
  
  /**
   * æ¢å¤å¿«ç…§
   * ğŸ”¥ ç›´æ¥è®¾ç½® FieldValueï¼Œæ— éœ€å›æƒ³
   */
  async restoreSnapshot(snapshot: SharedViewSnapshot): Promise<void> {
    console.log('[FormRenderer] å¼€å§‹æ¢å¤å¿«ç…§:', snapshot.view_id)
    
    // 1. æ¢å¤è¡¨å•æ•°æ®
    for (const [fieldPath, fieldValueSnapshot] of Object.entries(snapshot.form_data)) {
      this.formManager.setValue(fieldPath, {
        raw: fieldValueSnapshot.raw,
        display: fieldValueSnapshot.display,
        meta: fieldValueSnapshot.meta
      }, true)  // silent=trueï¼Œä¸è§¦å‘ç›‘å¬å™¨
    }
    
    // 2. æ¢å¤èšåˆç»Ÿè®¡ä¿¡æ¯
    if (snapshot.statistics) {
      this.restoreStatistics(snapshot.statistics)
    }
    
    // 3. è§¦å‘é‡æ–°æ¸²æŸ“
    await nextTick()
    this.formManager.emit('snapshot:restored', { viewId: snapshot.view_id })
    
    console.log('[FormRenderer] å¿«ç…§æ¢å¤å®Œæˆ')
  }
  
  /**
   * æ¢å¤èšåˆç»Ÿè®¡ä¿¡æ¯
   */
  private restoreStatistics(statistics: any): void {
    for (const [fieldPath, stats] of Object.entries(statistics)) {
      const listWidget = this.listWidgets.find(w => w.fieldPath === fieldPath)
      if (listWidget) {
        listWidget.listStatistics = stats
      }
    }
  }
  
  /**
   * ç”Ÿæˆæ ‡é¢˜ï¼ˆç”¨äºåˆ†äº«ï¼‰
   */
  private generateTitle(): string {
    // å¯ä»¥æ ¹æ®è¡¨å•å†…å®¹ç”Ÿæˆæ ‡é¢˜
    // ä¾‹å¦‚ï¼šæ ¹æ®ç¬¬ä¸€ä¸ªå­—æ®µçš„å€¼
    const firstValue = this.formManager.store.values().next().value
    if (firstValue?.display) {
      return `è¡¨å•åˆ†äº« - ${firstValue.display}`
    }
    return `è¡¨å•åˆ†äº« - ${this.functionDetail.name}`
  }
}
```

### 2. åˆ†äº«æŒ‰é’®ç»„ä»¶

```typescript
/**
 * åˆ†äº«æŒ‰é’®ç»„ä»¶
 */
const ShareButton = defineComponent({
  props: {
    formRenderer: {
      type: Object as PropType<FormRenderer>,
      required: true
    }
  },
  
  setup(props) {
    const sharing = ref(false)
    const shareDialogVisible = ref(false)
    const shareUrl = ref('')
    
    /**
     * ç‚¹å‡»åˆ†äº«
     */
    const handleShare = async () => {
      sharing.value = true
      
      try {
        // 1. æ•è·å¿«ç…§
        const snapshot = props.formRenderer.captureSnapshot()
        
        // 2. ä¿å­˜åˆ°åç«¯
        const response = await saveSharedView({
          function_code: snapshot.function_code,
          namespace: snapshot.namespace,
          app_name: snapshot.app_name,
          form_data: snapshot.form_data,
          statistics: snapshot.statistics,
          metadata: {
            title: snapshot.metadata.title,
            expires_in: 7 * 24 * 3600  // 7 å¤©è¿‡æœŸ
          },
          permissions: {
            is_public: true  // å…¬å¼€åˆ†äº«
          }
        })
        
        // 3. ç”Ÿæˆåˆ†äº«é“¾æ¥
        shareUrl.value = response.share_url
        shareDialogVisible.value = true
        
        ElMessage.success('åˆ†äº«é“¾æ¥å·²ç”Ÿæˆ')
        
      } catch (error) {
        console.error('[ShareButton] åˆ†äº«å¤±è´¥:', error)
        ElMessage.error('åˆ†äº«å¤±è´¥ï¼Œè¯·é‡è¯•')
      } finally {
        sharing.value = false
      }
    }
    
    /**
     * å¤åˆ¶é“¾æ¥
     */
    const handleCopy = () => {
      copyToClipboard(shareUrl.value)
      ElMessage.success('é“¾æ¥å·²å¤åˆ¶åˆ°å‰ªè´´æ¿')
    }
    
    return () => h('div', { class: 'share-button-container' }, [
      // åˆ†äº«æŒ‰é’®
      h(ElButton, {
        type: 'primary',
        icon: Share,
        loading: sharing.value,
        onClick: handleShare
      }, 'åˆ†äº«'),
      
      // åˆ†äº«å¯¹è¯æ¡†
      h(ElDialog, {
        modelValue: shareDialogVisible.value,
        title: 'åˆ†äº«è¡¨å•',
        width: '500px',
        'onUpdate:modelValue': (val: boolean) => shareDialogVisible.value = val
      }, {
        default: () => h('div', [
          h('div', { class: 'share-url-container' }, [
            h(ElInput, {
              modelValue: shareUrl.value,
              readonly: true
            }),
            h(ElButton, {
              onClick: handleCopy,
              style: { marginLeft: '10px' }
            }, 'å¤åˆ¶')
          ]),
          h('div', { class: 'share-tips' }, [
            'æ­¤é“¾æ¥ 7 å¤©å†…æœ‰æ•ˆï¼Œä»»ä½•äººéƒ½å¯ä»¥è®¿é—®'
          ])
        ])
      })
    ])
  }
})
```

### 3. URL åŠ è½½é€»è¾‘

```typescript
/**
 * Workspace ç»„ä»¶åˆå§‹åŒ–
 */
class Workspace {
  async mounted() {
    // æ£€æŸ¥ URL å‚æ•°
    const urlParams = new URLSearchParams(window.location.search)
    const viewId = urlParams.get('view_id')
    
    if (viewId) {
      // ğŸ”¥ åŠ è½½åˆ†äº«è§†å›¾
      await this.loadSharedView(viewId)
    } else {
      // æ­£å¸¸åŠ è½½å‡½æ•°
      await this.loadFunction()
    }
  }
  
  /**
   * åŠ è½½åˆ†äº«è§†å›¾
   */
  async loadSharedView(viewId: string): Promise<void> {
    console.log('[Workspace] åŠ è½½åˆ†äº«è§†å›¾:', viewId)
    
    try {
      // 1. ä»åç«¯è·å–å¿«ç…§
      const response = await getSharedView({ view_id: viewId })
      const snapshot = response.snapshot
      
      // 2. åŠ è½½å‡½æ•°è¯¦æƒ…ï¼ˆç”¨äºè·å–å­—æ®µå®šä¹‰ï¼‰
      await this.loadFunction(
        snapshot.namespace,
        snapshot.app_name,
        snapshot.function_code
      )
      
      // 3. æ¢å¤å¿«ç…§
      await this.formRenderer.restoreSnapshot(snapshot)
      
      // 4. è®¾ç½®ä¸ºåªè¯»æ¨¡å¼ï¼ˆå¯é€‰ï¼‰
      this.formRenderer.setReadonly(true)
      
      ElMessage.success('åˆ†äº«è§†å›¾åŠ è½½æˆåŠŸ')
      
    } catch (error) {
      console.error('[Workspace] åŠ è½½åˆ†äº«è§†å›¾å¤±è´¥:', error)
      ElMessage.error('åˆ†äº«è§†å›¾ä¸å­˜åœ¨æˆ–å·²è¿‡æœŸ')
      
      // è·³è½¬åˆ°é¦–é¡µ
      this.$router.push('/')
    }
  }
}
```

---

## åç«¯å®ç°

### 1. æ•°æ®åº“è¡¨è®¾è®¡

```sql
-- åˆ†äº«è§†å›¾è¡¨
CREATE TABLE shared_views (
  id BIGINT PRIMARY KEY AUTO_INCREMENT,
  view_id VARCHAR(32) UNIQUE NOT NULL,        -- è§†å›¾ IDï¼ˆçŸ­ IDï¼‰
  namespace VARCHAR(100) NOT NULL,
  app_name VARCHAR(100) NOT NULL,
  function_code VARCHAR(100) NOT NULL,
  
  -- å¿«ç…§æ•°æ®ï¼ˆJSONï¼‰
  snapshot_data TEXT NOT NULL,                -- å®Œæ•´å¿«ç…§ï¼ˆå‹ç¼©åï¼‰
  
  -- å…ƒæ•°æ®
  title VARCHAR(200),
  description TEXT,
  created_by VARCHAR(100),
  created_at DATETIME NOT NULL,
  expires_at DATETIME,                        -- è¿‡æœŸæ—¶é—´
  
  -- æƒé™
  is_public BOOLEAN DEFAULT TRUE,
  allowed_users TEXT,                         -- JSON æ•°ç»„
  password_hash VARCHAR(100),                 -- è®¿é—®å¯†ç ï¼ˆå“ˆå¸Œï¼‰
  
  -- ç»Ÿè®¡
  view_count INT DEFAULT 0,                   -- è®¿é—®æ¬¡æ•°
  
  INDEX idx_view_id (view_id),
  INDEX idx_created_at (created_at),
  INDEX idx_expires_at (expires_at)
);
```

### 2. API å®ç°

```go
// ä¿å­˜åˆ†äº«è§†å›¾
func SaveSharedView(ctx *gin.Context) {
    var req SaveSharedViewRequest
    if err := ctx.ShouldBindJSON(&req); err != nil {
        ctx.JSON(400, gin.H{"error": err.Error()})
        return
    }
    
    // 1. ç”Ÿæˆ view_idï¼ˆçŸ­ IDï¼‰
    viewID := generateShortID()  // ä¾‹å¦‚: "abc123xyz"
    
    // 2. æ„å»ºå¿«ç…§
    snapshot := SharedViewSnapshot{
        ViewID:       viewID,
        FunctionCode: req.FunctionCode,
        Namespace:    req.Namespace,
        AppName:      req.AppName,
        FormData:     req.FormData,
        Statistics:   req.Statistics,
        Metadata: Metadata{
            CreatedAt:   time.Now(),
            Title:       req.Metadata.Title,
            Description: req.Metadata.Description,
        },
    }
    
    // 3. åºåˆ—åŒ–å¹¶å‹ç¼©
    snapshotJSON, _ := json.Marshal(snapshot)
    compressed := compress(snapshotJSON)  // gzip å‹ç¼©
    
    // 4. è®¡ç®—è¿‡æœŸæ—¶é—´
    expiresAt := time.Now().Add(time.Duration(req.Metadata.ExpiresIn) * time.Second)
    
    // 5. ä¿å­˜åˆ°æ•°æ®åº“
    db.Create(&SharedView{
        ViewID:       viewID,
        Namespace:    req.Namespace,
        AppName:      req.AppName,
        FunctionCode: req.FunctionCode,
        SnapshotData: string(compressed),
        Title:        req.Metadata.Title,
        Description:  req.Metadata.Description,
        CreatedAt:    time.Now(),
        ExpiresAt:    &expiresAt,
        IsPublic:     req.Permissions.IsPublic,
    })
    
    // 6. è¿”å›åˆ†äº«é“¾æ¥
    shareURL := fmt.Sprintf("%s/workspace?view_id=%s", config.BaseURL, viewID)
    
    ctx.JSON(200, SaveSharedViewResponse{
        ViewID:    viewID,
        ShareURL:  shareURL,
        ExpiresAt: expiresAt.Format(time.RFC3339),
    })
}

// è·å–åˆ†äº«è§†å›¾
func GetSharedView(ctx *gin.Context) {
    viewID := ctx.Query("view_id")
    
    // 1. æŸ¥è¯¢æ•°æ®åº“
    var sharedView SharedView
    if err := db.Where("view_id = ?", viewID).First(&sharedView).Error; err != nil {
        ctx.JSON(404, gin.H{"error": "è§†å›¾ä¸å­˜åœ¨"})
        return
    }
    
    // 2. æ£€æŸ¥è¿‡æœŸæ—¶é—´
    if sharedView.ExpiresAt != nil && time.Now().After(*sharedView.ExpiresAt) {
        ctx.JSON(410, gin.H{"error": "è§†å›¾å·²è¿‡æœŸ"})
        return
    }
    
    // 3. æ£€æŸ¥æƒé™ï¼ˆå¦‚æœéœ€è¦ï¼‰
    if !sharedView.IsPublic {
        // éªŒè¯è®¿é—®æƒé™
        // ...
    }
    
    // 4. è§£å‹ç¼©
    decompressed := decompress([]byte(sharedView.SnapshotData))
    
    // 5. ååºåˆ—åŒ–
    var snapshot SharedViewSnapshot
    json.Unmarshal(decompressed, &snapshot)
    
    // 6. æ›´æ–°è®¿é—®æ¬¡æ•°
    db.Model(&sharedView).UpdateColumn("view_count", gorm.Expr("view_count + 1"))
    
    // 7. è¿”å›å¿«ç…§
    ctx.JSON(200, GetSharedViewResponse{
        Snapshot: snapshot,
    })
}

// ç”ŸæˆçŸ­ ID
func generateShortID() string {
    // ä½¿ç”¨ nanoid æˆ–ç±»ä¼¼ç®—æ³•
    return nanoid.New()  // ä¾‹å¦‚: "V1StGXR8_Z5jdHi6B"
}
```

---

## æ–¹æ¡ˆå¯¹æ¯”

### URL å›æƒ³æ–¹æ¡ˆ vs åˆ†äº«è§†å›¾æ–¹æ¡ˆ

| ç‰¹æ€§ | URL å›æƒ³æ–¹æ¡ˆ | åˆ†äº«è§†å›¾æ–¹æ¡ˆ | ä¼˜åŠ¿ |
|------|-------------|-------------|------|
| **è¯·æ±‚æ¬¡æ•°** | å¤šæ¬¡ï¼ˆ10è¡Œâ†’2-3æ¬¡ï¼‰ | 1 æ¬¡ | âœ… åˆ†äº«è§†å›¾ |
| **åŠ è½½é€Ÿåº¦** | ~400ms | ~100ms | âœ… åˆ†äº«è§†å›¾ |
| **URL é•¿åº¦** | æœ‰é™åˆ¶ï¼ˆ2-8KBï¼‰ | æçŸ­ï¼ˆview_idï¼‰ | âœ… åˆ†äº«è§†å›¾ |
| **å¯Œæ–‡æœ¬æ”¯æŒ** | âŒ ä¸æ”¯æŒ | âœ… æ”¯æŒ | âœ… åˆ†äº«è§†å›¾ |
| **å¤§æ•°æ®æ”¯æŒ** | âŒ ä¸æ”¯æŒ | âœ… æ”¯æŒ | âœ… åˆ†äº«è§†å›¾ |
| **èšåˆä¿¡æ¯** | âŒ ä¸ä¿å­˜ | âœ… ä¿å­˜ | âœ… åˆ†äº«è§†å›¾ |
| **displayInfo** | âŒ ä¸¢å¤±ï¼Œéœ€å›æƒ³ | âœ… ä¿å­˜ | âœ… åˆ†äº«è§†å›¾ |
| **å®ç°å¤æ‚åº¦** | é«˜ï¼ˆç¼“å­˜ç®¡ç†å™¨ï¼‰ | ä½ï¼ˆç®€å•å¿«ç…§ï¼‰ | âœ… åˆ†äº«è§†å›¾ |
| **åç«¯ä¾èµ–** | å›è°ƒæ¥å£ | å­˜å‚¨æ¥å£ | æŒå¹³ |
| **æ‰©å±•åŠŸèƒ½** | æ—  | å†å²è®°å½•ã€æ”¶è—ã€æƒé™ | âœ… åˆ†äº«è§†å›¾ |
| **å®‰å…¨æ€§** | ä½ï¼ˆæ•°æ®æš´éœ²åœ¨URLï¼‰ | é«˜ï¼ˆæ•°æ®åœ¨åç«¯ï¼‰ | âœ… åˆ†äº«è§†å›¾ |
| **ç¾è§‚æ€§** | å·®ï¼ˆURLå¾ˆé•¿ï¼‰ | å¥½ï¼ˆURLå¾ˆçŸ­ï¼‰ | âœ… åˆ†äº«è§†å›¾ |

### æ€»ç»“

| æ–¹æ¡ˆ | ä¼˜ç‚¹ | ç¼ºç‚¹ | æ¨èåº¦ |
|------|------|------|-------|
| **URL å›æƒ³æ–¹æ¡ˆ** | æ— éœ€åç«¯å­˜å‚¨ | å¤šæ¬¡è¯·æ±‚ã€URL é•¿åº¦é™åˆ¶ã€æ— æ³•ä¿å­˜å¯Œæ–‡æœ¬ | â­â­ |
| **åˆ†äº«è§†å›¾æ–¹æ¡ˆ** | ä¸€æ¬¡è¯·æ±‚ã€æ— é™åˆ¶ã€æ”¯æŒå¯Œæ–‡æœ¬ã€å¯æ‰©å±• | éœ€è¦åç«¯å­˜å‚¨ | â­â­â­â­â­ |

---

## æ‰©å±•åŠŸèƒ½

### 1. å†å²è®°å½•

```typescript
/**
 * ä¿å­˜å†å²è®°å½•
 * ç”¨æˆ·æäº¤è¡¨å•åï¼Œè‡ªåŠ¨ä¿å­˜å¿«ç…§
 */
async function saveHistory() {
  const snapshot = formRenderer.captureSnapshot()
  
  await saveSharedView({
    ...snapshot,
    metadata: {
      title: `å†å²è®°å½• - ${new Date().toLocaleString()}`,
      expires_in: 30 * 24 * 3600  // 30 å¤©
    },
    permissions: {
      is_public: false,
      allowed_users: [currentUser.id]  // åªæœ‰è‡ªå·±å¯è§
    }
  })
}
```

### 2. æ”¶è—åŠŸèƒ½

```typescript
/**
 * æ”¶è—è¡¨å•
 */
async function favoriteForm() {
  const snapshot = formRenderer.captureSnapshot()
  
  await saveSharedView({
    ...snapshot,
    metadata: {
      title: `æ”¶è— - ${snapshot.metadata.title}`,
      expires_in: 365 * 24 * 3600  // 1 å¹´
    },
    permissions: {
      is_public: false,
      allowed_users: [currentUser.id]
    }
  })
}
```

### 3. è®¿é—®æƒé™

```typescript
/**
 * åˆ›å»ºç§å¯†åˆ†äº«
 */
async function createPrivateShare() {
  const snapshot = formRenderer.captureSnapshot()
  
  await saveSharedView({
    ...snapshot,
    permissions: {
      is_public: false,
      allowed_users: ['user1', 'user2'],  // æŒ‡å®šç”¨æˆ·
      password: '123456'  // è®¿é—®å¯†ç 
    }
  })
}
```

### 4. äºŒç»´ç åˆ†äº«

```typescript
/**
 * ç”ŸæˆäºŒç»´ç 
 */
async function generateQRCode(shareUrl: string) {
  const qrCode = await QRCode.toDataURL(shareUrl)
  
  // æ˜¾ç¤ºäºŒç»´ç 
  showQRCodeDialog(qrCode)
}
```

---

## å®ç°ä¼˜å…ˆçº§

### Phase 1ï¼šåŸºç¡€åˆ†äº«ï¼ˆå¿…é¡»ï¼‰
- âœ… å¿«ç…§æ•è·ï¼ˆ`captureSnapshot`ï¼‰
- âœ… å¿«ç…§æ¢å¤ï¼ˆ`restoreSnapshot`ï¼‰
- âœ… åç«¯ä¿å­˜æ¥å£ï¼ˆ`SaveSharedView`ï¼‰
- âœ… åç«¯è·å–æ¥å£ï¼ˆ`GetSharedView`ï¼‰
- âœ… åˆ†äº«æŒ‰é’®ç»„ä»¶
- âœ… URL åŠ è½½é€»è¾‘

### Phase 2ï¼šæ‰©å±•åŠŸèƒ½ï¼ˆæ¨èï¼‰
- â­ å†å²è®°å½•
- â­ æ”¶è—åŠŸèƒ½
- â­ è®¿é—®æƒé™ï¼ˆç§å¯†åˆ†äº«ã€å¯†ç ä¿æŠ¤ï¼‰
- â­ è¿‡æœŸæ—¶é—´è®¾ç½®

### Phase 3ï¼šé«˜çº§åŠŸèƒ½ï¼ˆå¯é€‰ï¼‰
- ğŸ’¡ äºŒç»´ç åˆ†äº«
- ğŸ’¡ åˆ†äº«ç»Ÿè®¡ï¼ˆè®¿é—®æ¬¡æ•°ã€è®¿é—®ç”¨æˆ·ï¼‰
- ğŸ’¡ å¿«ç…§ç‰ˆæœ¬ç®¡ç†
- ğŸ’¡ å¿«ç…§å¯¹æ¯”

---

## æ€»ç»“

### æ ¸å¿ƒä¼˜åŠ¿

âœ… **æç®€ URL**ï¼š`?view_id=abc123xyz`ï¼ˆåªæœ‰ view_idï¼‰  
âœ… **ä¸€æ¬¡åŠ è½½**ï¼šä¸€æ¬¡è¯·æ±‚è·å–å®Œæ•´å¿«ç…§  
âœ… **æ— é™åˆ¶**ï¼šæ”¯æŒå¯Œæ–‡æœ¬ã€å¤§æ•°æ®ã€èšåˆä¿¡æ¯  
âœ… **é«˜æ€§èƒ½**ï¼š~100ms åŠ è½½ï¼ˆvs å›æƒ³æ–¹æ¡ˆ ~400msï¼‰  
âœ… **æ˜“æ‰©å±•**ï¼šå†å²è®°å½•ã€æ”¶è—ã€æƒé™ã€äºŒç»´ç ç­‰  
âœ… **å®‰å…¨æ€§é«˜**ï¼šæ•°æ®åœ¨åç«¯ï¼Œä¸æš´éœ²åœ¨ URL  
âœ… **ç¾è§‚**ï¼šçŸ­é“¾æ¥ï¼Œæ˜“äºåˆ†äº«  

### æœ€ç»ˆå»ºè®®

**å¼ºçƒˆæ¨èï¼šåˆ†äº«è§†å›¾æ–¹æ¡ˆ**

- æ”¾å¼ƒ URL å›æƒ³æ–¹æ¡ˆï¼ˆå¤æ‚ã€é™åˆ¶å¤šï¼‰
- ä½¿ç”¨åˆ†äº«è§†å›¾æ–¹æ¡ˆï¼ˆç®€å•ã€å¼ºå¤§ã€å¯æ‰©å±•ï¼‰
- ç‚¹å‡»åˆ†äº« â†’ ä¿å­˜å¿«ç…§ â†’ ç”Ÿæˆ view_id
- æ‰“å¼€é“¾æ¥ â†’ åŠ è½½å¿«ç…§ â†’ ä¸€æ¬¡æå®š

**è¿™æ˜¯æœ€ä¼˜é›…ã€æœ€å¼ºå¤§çš„åˆ†äº«æ–¹æ¡ˆï¼** ğŸ‰

