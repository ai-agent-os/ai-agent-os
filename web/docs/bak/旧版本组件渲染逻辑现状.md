# æ—§ç‰ˆæœ¬ç»„ä»¶æ¸²æŸ“é€»è¾‘ç°çŠ¶

## ğŸ“Š æ¦‚è¿°

å½“å‰ä»£ç åº“ä¸­å­˜åœ¨**ä¸¤å¥—å¹¶è¡Œçš„ç»„ä»¶æ¸²æŸ“ç³»ç»Ÿ**ï¼š

1. **æ—§ç‰ˆæœ¬ï¼ˆåŸºäºç±»ï¼‰**ï¼š`web/src/core/widgets/` - åŸºäº TypeScript ç±»çš„ç»§æ‰¿ä½“ç³»
2. **æ–°ç‰ˆæœ¬ï¼ˆåŸºäº Vue ç»„ä»¶ï¼‰**ï¼š`web/src/core/widgets-v2/` - åŸºäº Vue 3 ç»„ä»¶ç³»ç»Ÿ

## ğŸ” æ—§ç‰ˆæœ¬ç³»ç»Ÿè¯¦ç»†åˆ†æ

### 1. æ¶æ„è®¾è®¡

#### æ ¸å¿ƒç±»ï¼š`BaseWidget`
- **ä½ç½®**ï¼š`web/src/core/widgets/BaseWidget.ts`
- **è®¾è®¡æ¨¡å¼**ï¼šæŠ½è±¡åŸºç±»ï¼Œæ‰€æœ‰ Widget ç»§æ‰¿æ­¤ç±»
- **æ ¸å¿ƒæ–¹æ³•**ï¼š
  - `renderTableCell()` - æ¸²æŸ“è¡¨æ ¼å•å…ƒæ ¼
  - `renderForDetail()` - æ¸²æŸ“è¯¦æƒ…å±•ç¤º
  - `renderSearchInput()` - æ¸²æŸ“æœç´¢è¾“å…¥
  - `render()` - æ¸²æŸ“è¡¨å•è¾“å…¥ï¼ˆç”¨äº FormRendererï¼‰

#### å·¥å‚æ¨¡å¼
- **WidgetFactory**ï¼šæ ¹æ® `widget.type` åŠ¨æ€åˆ›å»º Widget å®ä¾‹
- **WidgetBuilder**ï¼šç»Ÿä¸€ Widget åˆ›å»ºé€»è¾‘ï¼Œæä¾›ç±»å‹å®‰å…¨

### 2. å·²å®ç°çš„ Widget

```
web/src/core/widgets/
â”œâ”€â”€ BaseWidget.ts           # åŸºç±»
â”œâ”€â”€ InputWidget.ts          # æ–‡æœ¬è¾“å…¥
â”œâ”€â”€ NumberWidget.ts         # æ•´æ•°è¾“å…¥
â”œâ”€â”€ FloatWidget.ts          # æµ®ç‚¹æ•°è¾“å…¥
â”œâ”€â”€ TextAreaWidget.ts       # å¤šè¡Œæ–‡æœ¬
â”œâ”€â”€ SelectWidget.ts         # ä¸‹æ‹‰é€‰æ‹©ï¼ˆå•é€‰ï¼‰
â”œâ”€â”€ MultiSelectWidget.ts    # ä¸‹æ‹‰é€‰æ‹©ï¼ˆå¤šé€‰ï¼‰
â”œâ”€â”€ SwitchWidget.ts         # å¼€å…³
â”œâ”€â”€ TimestampWidget.ts      # æ—¶é—´æˆ³
â”œâ”€â”€ FilesWidget.ts          # æ–‡ä»¶ä¸Šä¼ 
â”œâ”€â”€ UserWidget.ts           # ç”¨æˆ·é€‰æ‹©
â”œâ”€â”€ TableWidget.ts          # è¡¨æ ¼ï¼ˆåµŒå¥—ï¼‰
â”œâ”€â”€ FormWidget.ts           # è¡¨å•ï¼ˆåµŒå¥—ï¼‰
â”œâ”€â”€ ResponseFormWidget.ts   # å“åº”è¡¨å•
â””â”€â”€ ResponseTableWidget.ts  # å“åº”è¡¨æ ¼
```

### 3. ä½¿ç”¨åœºæ™¯

#### âœ… æ­£åœ¨ä½¿ç”¨çš„åœ°æ–¹

**1. TableRendererï¼ˆè¡¨æ ¼æ¸²æŸ“å™¨ï¼‰**
- **æ–‡ä»¶**ï¼š`web/src/components/TableRenderer.vue`
- **ä½¿ç”¨æ–¹å¼**ï¼š
  ```typescript
  // æ¸²æŸ“è¡¨æ ¼å•å…ƒæ ¼
  const tempWidget = WidgetBuilder.createTemporary({
    field: coreField,
    value: value
  })
  const result = tempWidget.renderTableCell(value, userInfoMap.value)
  
  // æ¸²æŸ“è¯¦æƒ…å­—æ®µ
  const widget = WidgetBuilder.createTemporary({
    field: field,
    value: value
  })
  const result = widget.renderForDetail(value, context)
  ```
- **ç”¨é€”**ï¼š
  - è¡¨æ ¼å•å…ƒæ ¼æ¸²æŸ“ï¼ˆ`renderTableCell`ï¼‰
  - è¯¦æƒ…æŠ½å±‰å­—æ®µæ¸²æŸ“ï¼ˆ`renderForDetail`ï¼‰

**2. SearchInputï¼ˆæœç´¢è¾“å…¥ç»„ä»¶ï¼‰**
- **æ–‡ä»¶**ï¼š`web/src/components/SearchInput.vue`
- **ä½¿ç”¨æ–¹å¼**ï¼š
  ```typescript
  const tempWidget = WidgetBuilder.createTemporary({
    field: props.field
  })
  return tempWidget.renderSearchInput(props.searchType)
  ```
- **ç”¨é€”**ï¼š
  - è·å–æœç´¢è¾“å…¥é…ç½®ï¼ˆ`renderSearchInput`ï¼‰
  - æ ¹æ®å­—æ®µç±»å‹å’Œæœç´¢ç±»å‹è¿”å›å¯¹åº”çš„è¾“å…¥ç»„ä»¶é…ç½®

**3. åµŒå¥— Widget å†…éƒ¨**
- **TableWidget**ã€**FormWidget** ç­‰åµŒå¥—ç»„ä»¶å†…éƒ¨ä½¿ç”¨ `WidgetBuilder` åˆ›å»ºå­ Widget
- **ResponseFormWidget**ã€**ResponseTableWidget** ç”¨äºå“åº”å‚æ•°æ¸²æŸ“

### 4. æ ¸å¿ƒç‰¹æ€§

#### âœ… ä¼˜åŠ¿
1. **ç»„ä»¶è‡ªæ²»**ï¼šæ¯ä¸ª Widget è‡ªå·±å†³å®šå¦‚ä½•æ¸²æŸ“ï¼ˆè¡¨æ ¼ã€è¯¦æƒ…ã€æœç´¢ï¼‰
2. **ç±»å‹å®‰å…¨**ï¼šTypeScript ç±»å‹æ£€æŸ¥ï¼Œç¼–è¯‘æ—¶å‘ç°é”™è¯¯
3. **ç»Ÿä¸€æ¥å£**ï¼šæ‰€æœ‰ Widget å®ç°ç›¸åŒçš„æ¥å£ï¼Œæ˜“äºæ‰©å±•
4. **ä¸´æ—¶ Widget**ï¼šæ”¯æŒåˆ›å»ºä¸´æ—¶ Widgetï¼ˆæ—  formManagerï¼‰ï¼Œç”¨äºåªè¯»åœºæ™¯

#### âš ï¸ åŠ£åŠ¿
1. **åŸºäºç±»**ï¼šä¸ç¬¦åˆ Vue 3 Composition API çš„æœ€ä½³å®è·µ
2. **ä»£ç é‡å¤§**ï¼šæ¯ä¸ª Widget éƒ½æ˜¯ä¸€ä¸ªç±»æ–‡ä»¶ï¼Œä»£ç è¾ƒå¤š
3. **éš¾ä»¥å¤ç”¨**ï¼šé€»è¾‘å°è£…åœ¨ç±»ä¸­ï¼Œéš¾ä»¥åœ¨ Vue ç»„ä»¶ä¸­ç›´æ¥ä½¿ç”¨
4. **ç»´æŠ¤æˆæœ¬**ï¼šéœ€è¦ç»´æŠ¤ä¸¤å¥—ç³»ç»Ÿ

### 5. ä¸æ–°ç‰ˆæœ¬çš„å¯¹æ¯”

| ç‰¹æ€§ | æ—§ç‰ˆæœ¬ï¼ˆwidgets/ï¼‰ | æ–°ç‰ˆæœ¬ï¼ˆwidgets-v2/ï¼‰ |
|------|-------------------|---------------------|
| **æ¶æ„** | åŸºäºç±»ï¼ˆOOPï¼‰ | åŸºäº Vue ç»„ä»¶ï¼ˆComposition APIï¼‰ |
| **ä½¿ç”¨åœºæ™¯** | TableRendererã€SearchInput | FormRendererï¼ˆrenderers-v2ï¼‰ |
| **ä»£ç é‡** | è¾ƒå¤§ï¼ˆæ¯ä¸ª Widget ä¸€ä¸ªç±»ï¼‰ | è¾ƒå°ï¼ˆVue ç»„ä»¶ + composablesï¼‰ |
| **ç±»å‹å®‰å…¨** | âœ… TypeScript ç±» | âœ… TypeScript æ¥å£ |
| **å¯å¤ç”¨æ€§** | âš ï¸ éœ€è¦åˆ›å»ºå®ä¾‹ | âœ… ç›´æ¥ä½¿ç”¨ç»„ä»¶ |
| **ç»´æŠ¤æˆæœ¬** | âš ï¸ éœ€è¦ç»´æŠ¤ç±»ä½“ç³» | âœ… ç¬¦åˆ Vue æœ€ä½³å®è·µ |

## ğŸ“ å½“å‰çŠ¶æ€æ€»ç»“

### âœ… ä»åœ¨ä½¿ç”¨çš„æ—§ç‰ˆæœ¬ç»„ä»¶

1. **TableRenderer** - è¡¨æ ¼æ¸²æŸ“
   - ä½¿ç”¨ `WidgetBuilder.createTemporary()` åˆ›å»ºä¸´æ—¶ Widget
   - è°ƒç”¨ `renderTableCell()` å’Œ `renderForDetail()` æ–¹æ³•

2. **SearchInput** - æœç´¢è¾“å…¥
   - ä½¿ç”¨ `WidgetBuilder.createTemporary()` åˆ›å»ºä¸´æ—¶ Widget
   - è°ƒç”¨ `renderSearchInput()` æ–¹æ³•

3. **åµŒå¥— Widget** - è¡¨æ ¼å’Œè¡¨å•å†…çš„åµŒå¥—å­—æ®µ
   - TableWidgetã€FormWidget å†…éƒ¨ä½¿ç”¨ WidgetBuilder åˆ›å»ºå­ Widget

### âœ… å·²è¿ç§»åˆ°æ–°ç‰ˆæœ¬

1. **FormRendererï¼ˆrenderers-v2ï¼‰** - è¡¨å•æ¸²æŸ“
   - ä½¿ç”¨ `widgets-v2/` ç»„ä»¶
   - ä½¿ç”¨ `WidgetComponentFactory` åˆ›å»ºç»„ä»¶

2. **FormDialog** - è¡¨å•å¯¹è¯æ¡†
   - ä½¿ç”¨ `renderers-v2/FormRenderer.vue`

## ğŸ¯ è¿ç§»å»ºè®®

### çŸ­æœŸï¼ˆä¿ç•™ç°çŠ¶ï¼‰
- âœ… **ç»§ç»­ä½¿ç”¨æ—§ç‰ˆæœ¬**ï¼šTableRenderer å’Œ SearchInput åŠŸèƒ½æ­£å¸¸ï¼Œæš‚æ—¶ä¸éœ€è¦è¿ç§»
- âœ… **ä¿æŒä¸¤å¥—ç³»ç»Ÿå¹¶è¡Œ**ï¼šæ–°ç‰ˆæœ¬ç”¨äºè¡¨å•ï¼Œæ—§ç‰ˆæœ¬ç”¨äºè¡¨æ ¼å’Œæœç´¢

### ä¸­æœŸï¼ˆé€æ­¥è¿ç§»ï¼‰
1. **è¿ç§» TableRenderer**ï¼š
   - å°†è¡¨æ ¼å•å…ƒæ ¼æ¸²æŸ“è¿ç§»åˆ°ä½¿ç”¨ `widgets-v2/` ç»„ä»¶
   - éœ€è¦åˆ›å»ºå¯¹åº”çš„è¡¨æ ¼å•å…ƒæ ¼ç»„ä»¶

2. **è¿ç§» SearchInput**ï¼š
   - å°†æœç´¢è¾“å…¥é…ç½®è¿ç§»åˆ°ä½¿ç”¨ `widgets-v2/` ç»„ä»¶
   - éœ€è¦åˆ›å»ºå¯¹åº”çš„æœç´¢è¾“å…¥ç»„ä»¶

### é•¿æœŸï¼ˆç»Ÿä¸€ç‰ˆæœ¬ï¼‰
- æ‰€æœ‰ç»„ä»¶éƒ½ä½¿ç”¨ `widgets-v2/` ç‰ˆæœ¬
- åˆ é™¤ `widgets/` ç›®å½•å’Œç›¸å…³çš„å·¥å‚ç±»

## ğŸ“ æŠ€æœ¯ç»†èŠ‚

### WidgetBuilder.createTemporary()

```typescript
// åˆ›å»ºä¸´æ—¶ Widgetï¼ˆç”¨äºåªè¯»åœºæ™¯ï¼‰
const tempWidget = WidgetBuilder.createTemporary({
  field: FieldConfig,
  value?: FieldValue
})

// ä¸´æ—¶ Widget ç‰¹ç‚¹ï¼š
// - formManager ä¸º null
// - ç”¨äºè¡¨æ ¼å•å…ƒæ ¼ã€è¯¦æƒ…å±•ç¤ºã€æœç´¢è¾“å…¥ç­‰åªè¯»åœºæ™¯
// - ä¸éœ€è¦è¡¨å•æ•°æ®ç®¡ç†
```

### Widget æ ¸å¿ƒæ–¹æ³•

```typescript
abstract class BaseWidget {
  // æ¸²æŸ“è¡¨æ ¼å•å…ƒæ ¼
  renderTableCell(value: FieldValue, userInfoMap?: Map<string, UserInfo>): string | VNode
  
  // æ¸²æŸ“è¯¦æƒ…å±•ç¤º
  renderForDetail(value: FieldValue, context?: any): string | VNode
  
  // æ¸²æŸ“æœç´¢è¾“å…¥
  renderSearchInput(searchType: string): SearchInputConfig
  
  // æ¸²æŸ“è¡¨å•è¾“å…¥ï¼ˆç”¨äº FormRendererï¼‰
  render(props: WidgetRenderProps): VNode
}
```

## ğŸ”— ç›¸å…³æ–‡ä»¶

- **æ ¸å¿ƒç±»**ï¼š`web/src/core/widgets/BaseWidget.ts`
- **å·¥å‚**ï¼š`web/src/core/factories/WidgetFactory.ts`ã€`WidgetBuilder.ts`
- **ä½¿ç”¨ä½ç½®**ï¼š`web/src/components/TableRenderer.vue`ã€`SearchInput.vue`
- **æ–°ç‰ˆæœ¬**ï¼š`web/src/core/widgets-v2/`ã€`web/src/core/renderers-v2/`

## âœ… ç»“è®º

**æ—§ç‰ˆæœ¬ç»„ä»¶æ¸²æŸ“é€»è¾‘ç›®å‰çŠ¶æ€è‰¯å¥½**ï¼š
- âœ… åŠŸèƒ½å®Œæ•´ï¼Œæ”¯æŒè¡¨æ ¼ã€æœç´¢ã€è¯¦æƒ…ç­‰å¤šç§åœºæ™¯
- âœ… ä»£ç ç¨³å®šï¼Œå·²åœ¨ç”Ÿäº§ç¯å¢ƒä½¿ç”¨
- âœ… ç±»å‹å®‰å…¨ï¼ŒTypeScript æ”¯æŒå®Œå–„
- âš ï¸ æ¶æ„è¾ƒè€ï¼Œä¸ç¬¦åˆ Vue 3 æœ€ä½³å®è·µ
- âš ï¸ ä¸æ–°ç‰ˆæœ¬å¹¶è¡Œï¼Œéœ€è¦ç»´æŠ¤ä¸¤å¥—ç³»ç»Ÿ

**å»ºè®®**ï¼šæš‚æ—¶ä¿ç•™æ—§ç‰ˆæœ¬ï¼Œç­‰æ–°ç‰ˆæœ¬å®Œå…¨ç¨³å®šåå†é€æ­¥è¿ç§»ã€‚

