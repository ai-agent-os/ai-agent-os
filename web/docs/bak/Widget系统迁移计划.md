# Widget ç³»ç»Ÿé‡æ„è®¡åˆ’ï¼šä» widgets/ v1 åˆ° widgets-v2/

## ğŸ¯ é‡æ„ç›®æ ‡

**ä¸æ˜¯è¿ç§»ï¼Œè€Œæ˜¯é‡æ„**ï¼šæŒ‰ç…§ widgets-v2 çš„è®¾è®¡æ€è·¯å’Œé£æ ¼é‡æ–°å®ç°ï¼Œè€Œä¸æ˜¯ç®€å•å¤åˆ¶ä»£ç ã€‚

- âœ… æŒ‰ç…§ v2 çš„æ€è·¯é‡æ–°å®ç°æ‰€æœ‰åŠŸèƒ½
- âœ… ä¿è¯å¯ç”¨æ€§å’Œç»´æŠ¤æ€§
- âœ… åˆ é™¤æ—§ç‰ˆæœ¬ widgets/ ç›®å½•
- âœ… æ”¯æŒå›æ»š

## ğŸ“Š è¿ç§»ç‚¹æ¸…å•

### 1. æ ¸å¿ƒä½¿ç”¨ç‚¹ï¼ˆå¿…é¡»è¿ç§»ï¼‰

#### 1.1 TableRenderer.vue
**æ–‡ä»¶**ï¼š`web/src/components/TableRenderer.vue`

**å½“å‰ä½¿ç”¨**ï¼š
- `WidgetBuilder.createTemporary()` - åˆ›å»ºä¸´æ—¶ Widget
- `widget.renderTableCell()` - æ¸²æŸ“è¡¨æ ¼å•å…ƒæ ¼
- `widget.renderForDetail()` - æ¸²æŸ“è¯¦æƒ…å±•ç¤º

**è¿ç§»ä½ç½®**ï¼š
- ç¬¬ 263 è¡Œï¼š`import { WidgetBuilder } from '@/core/factories/WidgetBuilder'`
- ç¬¬ 537 è¡Œï¼š`renderTableCell()` å‡½æ•°
- ç¬¬ 596 è¡Œï¼š`renderDetailField()` å‡½æ•°

**è¿ç§»æ–¹æ¡ˆ**ï¼š
- ä½¿ç”¨ `widgetComponentFactory.getRequestComponent()` è·å–ç»„ä»¶
- ä½¿ç”¨ `<component :is="..." mode="table-cell" />` æ¸²æŸ“
- ä½¿ç”¨ `<component :is="..." mode="detail" />` æ¸²æŸ“è¯¦æƒ…

#### 1.2 SearchInput.vue
**æ–‡ä»¶**ï¼š`web/src/components/SearchInput.vue`

**å½“å‰ä½¿ç”¨**ï¼š
- `WidgetBuilder.createTemporary()` - åˆ›å»ºä¸´æ—¶ Widget
- `widget.renderSearchInput()` - è·å–æœç´¢è¾“å…¥é…ç½®

**è¿ç§»ä½ç½®**ï¼š
- ç¬¬ 163 è¡Œï¼š`import { WidgetBuilder } from '@/core/factories/WidgetBuilder'`
- ç¬¬ 332-355 è¡Œï¼š`inputConfig` computed

**è¿ç§»æ–¹æ¡ˆ**ï¼š
- ç›´æ¥ä½¿ç”¨ widgets-v2 ç»„ä»¶ï¼Œ`mode="search"`
- æˆ–è€…åˆ›å»ºé€‚é…å±‚ï¼Œä»ç»„ä»¶ä¸­æå–é…ç½®

### 2. å†…éƒ¨ä½¿ç”¨ç‚¹ï¼ˆéœ€è¦æ£€æŸ¥ï¼‰

#### 2.1 ResponseTableWidget.ts
**æ–‡ä»¶**ï¼š`web/src/core/widgets/ResponseTableWidget.ts`

**å½“å‰ä½¿ç”¨**ï¼š
- å†…éƒ¨ä½¿ç”¨ `WidgetBuilder.createTemporary()` å’Œ `renderTableCell()`

**è¿ç§»æ–¹æ¡ˆ**ï¼š
- å¦‚æœ ResponseTableWidget è¿˜åœ¨ä½¿ç”¨ï¼Œéœ€è¦è¿ç§»
- å¦‚æœå·²ç»åºŸå¼ƒï¼Œå¯ä»¥åˆ é™¤

#### 2.2 ResponseFormWidget.ts
**æ–‡ä»¶**ï¼š`web/src/core/widgets/ResponseFormWidget.ts`

**å½“å‰ä½¿ç”¨**ï¼š
- å†…éƒ¨ä½¿ç”¨æ—§ç‰ˆæœ¬ Widget

**è¿ç§»æ–¹æ¡ˆ**ï¼š
- æ£€æŸ¥æ˜¯å¦è¿˜åœ¨ä½¿ç”¨
- å¦‚æœä½¿ç”¨ï¼Œè¿ç§»åˆ° widgets-v2

### 3. å·¥å‚å’Œå·¥å…·ï¼ˆéœ€è¦æ£€æŸ¥ï¼‰

#### 3.1 WidgetFactory.ts
**æ–‡ä»¶**ï¼š`web/src/core/factories/WidgetFactory.ts`

**è¿ç§»æ–¹æ¡ˆ**ï¼š
- æ£€æŸ¥æ˜¯å¦è¿˜æœ‰å…¶ä»–åœ°æ–¹ä½¿ç”¨
- å¦‚æœæ²¡æœ‰ï¼Œå¯ä»¥åˆ é™¤

#### 3.2 WidgetBuilder.ts
**æ–‡ä»¶**ï¼š`web/src/core/factories/WidgetBuilder.ts`

**è¿ç§»æ–¹æ¡ˆ**ï¼š
- æ£€æŸ¥æ˜¯å¦è¿˜æœ‰å…¶ä»–åœ°æ–¹ä½¿ç”¨
- å¦‚æœæ²¡æœ‰ï¼Œå¯ä»¥åˆ é™¤

## ğŸ”„ é‡æ„ç­–ç•¥

### ç­–ç•¥ï¼šæ¸è¿›å¼é‡æ„ + åŠŸèƒ½å¼€å…³

**æ ¸å¿ƒåŸåˆ™**ï¼š
1. **ä¸æ˜¯å¤åˆ¶ä»£ç **ï¼šè¦æŒ‰ç…§ v2 çš„æ€è·¯é‡æ–°å®ç°
2. **ç†è§£è®¾è®¡ç†å¿µ**ï¼šå…ˆç†è§£ v2 çš„è®¾è®¡ï¼Œå†é‡æ„
3. **ä¿è¯å¯ç”¨æ€§**ï¼šé‡æ„åè¦ä¿è¯åŠŸèƒ½æ­£å¸¸
4. **æé«˜ç»´æŠ¤æ€§**ï¼šé‡æ„çš„ç›®æ ‡æ˜¯æé«˜ä»£ç è´¨é‡

**åŸåˆ™**ï¼š
1. **å…ˆè¿ç§»ï¼Œå†åˆ é™¤**ï¼šå…ˆå®Œæˆè¿ç§»ï¼ŒéªŒè¯åŠŸèƒ½ï¼Œå†åˆ é™¤æ—§ä»£ç 
2. **åŠŸèƒ½å¼€å…³**ï¼šä½¿ç”¨ç¯å¢ƒå˜é‡æˆ–é…ç½®å¼€å…³ï¼Œæ”¯æŒå¿«é€Ÿå›æ»š
3. **é€æ­¥éªŒè¯**ï¼šæ¯ä¸ªè¿ç§»ç‚¹å®Œæˆåç«‹å³éªŒè¯
4. **ä¿ç•™å¤‡ä»½**ï¼šè¿ç§»å‰åˆ›å»ºåˆ†æ”¯ï¼Œæ”¯æŒå›æ»š

### è¿ç§»æ­¥éª¤

#### Phase 1: å‡†å¤‡é˜¶æ®µï¼ˆ1-2å°æ—¶ï¼‰

1. **åˆ›å»ºé‡æ„åˆ†æ”¯**
   ```bash
   git checkout -b refactor/widgets-v2
   git push -u origin refactor/widgets-v2
   ```

2. **ç†è§£ v2 çš„è®¾è®¡ç†å¿µ**
   - é˜…è¯» `widgets-v2/components/UserWidget.vue` çš„å®ç°
   - ç†è§£ `mode` prop çš„ä½¿ç”¨æ–¹å¼
   - ç†è§£ composables çš„ä½¿ç”¨æ–¹å¼
   - å¯¹æ¯” v1 å’Œ v2 çš„å·®å¼‚

3. **åˆ†æé‡æ„ç‚¹**
   - åˆ†æ TableRenderer çš„é‡æ„ç‚¹
   - åˆ†æ SearchInput çš„é‡æ„ç‚¹
   - ç¡®å®šé‡æ„æ–¹æ¡ˆ

#### Phase 2: é‡æ„ TableRendererï¼ˆ2-3å°æ—¶ï¼‰

1. **é‡æ„ renderTableCell**
   - æŒ‰ç…§ v2 çš„æ€è·¯é‡æ–°å®ç°
   - ä½¿ç”¨ `widgetComponentFactory.getRequestComponent()` è·å–ç»„ä»¶
   - ä½¿ç”¨ `h()` æ¸²æŸ“ç»„ä»¶ä¸º VNode
   - ç»Ÿä¸€è¿”å› VNodeï¼ˆä¸å†éœ€è¦åŒºåˆ†å­—ç¬¦ä¸²å’Œ VNodeï¼‰

2. **é‡æ„ renderDetailField**
   - æŒ‰ç…§ v2 çš„æ€è·¯é‡æ–°å®ç°
   - ä½¿ç”¨ `mode="detail"`

3. **æµ‹è¯•éªŒè¯**
   - æµ‹è¯•è¡¨æ ¼æ¸²æŸ“
   - æµ‹è¯•è¯¦æƒ…å±•ç¤º
   - æµ‹è¯•æ‰€æœ‰ Widget ç±»å‹

#### Phase 3: é‡æ„ SearchInputï¼ˆ1-2å°æ—¶ï¼‰

1. **é‡æ„ inputConfig**
   - æ–¹æ¡ˆAï¼šç›´æ¥ä½¿ç”¨ widgets-v2 ç»„ä»¶ï¼ˆæ¨èï¼‰
   - æ–¹æ¡ˆBï¼šåˆ›å»ºé€‚é…å±‚ï¼ˆå¦‚æœéœ€è¦ï¼‰

2. **æµ‹è¯•éªŒè¯**
   - æµ‹è¯•æ‰€æœ‰æœç´¢ç±»å‹ï¼ˆeq, like, in, gte/lteï¼‰
   - æµ‹è¯•æ‰€æœ‰ Widget ç±»å‹

#### Phase 4: æ¸…ç†å’Œä¼˜åŒ–ï¼ˆ1-2å°æ—¶ï¼‰

1. **æ£€æŸ¥å…¶ä»–ä½¿ç”¨ç‚¹**
   - æ£€æŸ¥ ResponseTableWidgetã€ResponseFormWidget æ˜¯å¦è¿˜åœ¨ä½¿ç”¨
   - å¦‚æœä½¿ç”¨ï¼Œé‡æ„æˆ–åˆ é™¤

2. **åˆ é™¤æ—§ä»£ç **
   - åˆ é™¤ `web/src/core/widgets/` ç›®å½•
   - åˆ é™¤ `web/src/core/factories/WidgetFactory.ts`
   - åˆ é™¤ `web/src/core/factories/WidgetBuilder.ts`

3. **ä»£ç ä¼˜åŒ–**
   - æ£€æŸ¥æ˜¯å¦æœ‰å¯ä»¥ä¼˜åŒ–çš„åœ°æ–¹
   - ç»Ÿä¸€ä»£ç é£æ ¼

4. **å…¨é¢æµ‹è¯•**
   - æµ‹è¯•æ‰€æœ‰åŠŸèƒ½
   - æµ‹è¯•æ‰€æœ‰ Widget ç±»å‹
   - æµ‹è¯•è¾¹ç•Œæƒ…å†µ

#### Phase 5: æ–‡æ¡£å’Œæäº¤ï¼ˆ0.5å°æ—¶ï¼‰

1. **æ›´æ–°æ–‡æ¡£**
   - æ›´æ–° README
   - æ›´æ–°æ¶æ„æ–‡æ¡£

2. **æäº¤ä»£ç **
   ```bash
   git add -A
   git commit -m "refactor: é‡æ„åˆ° widgets-v2ï¼ŒæŒ‰ç…§ v2 çš„è®¾è®¡æ€è·¯é‡æ–°å®ç°"
   git push
   ```

## ğŸ›¡ï¸ é£é™©æ§åˆ¶

### 1. å›æ»šæ–¹æ¡ˆ

**æ–¹æ¡ˆAï¼šGit å›æ»š**
```bash
# å¦‚æœè¿ç§»å¤±è´¥ï¼Œå›æ»šåˆ°è¿ç§»å‰
git reset --hard <è¿ç§»å‰commit>
git push --force
```

**æ–¹æ¡ˆBï¼šåŠŸèƒ½å¼€å…³**
```typescript
// åœ¨é…ç½®ä¸­æ·»åŠ å¼€å…³
const USE_WIDGETS_V2 = import.meta.env.VITE_USE_WIDGETS_V2 !== 'false'

// åœ¨ä»£ç ä¸­ä½¿ç”¨
if (USE_WIDGETS_V2) {
  // ä½¿ç”¨æ–°ç‰ˆæœ¬
} else {
  // ä½¿ç”¨æ—§ç‰ˆæœ¬ï¼ˆå›æ»šï¼‰
}
```

### 2. æµ‹è¯•æ¸…å•

**åŠŸèƒ½æµ‹è¯•**ï¼š
- [ ] è¡¨æ ¼æ¸²æŸ“æ­£å¸¸
- [ ] è¡¨æ ¼å•å…ƒæ ¼æ˜¾ç¤ºæ­£å¸¸ï¼ˆæ‰€æœ‰ Widget ç±»å‹ï¼‰
- [ ] è¯¦æƒ…å±•ç¤ºæ­£å¸¸
- [ ] æœç´¢è¾“å…¥æ­£å¸¸ï¼ˆæ‰€æœ‰æœç´¢ç±»å‹ï¼‰
- [ ] ç”¨æˆ·é€‰æ‹©å™¨æ­£å¸¸
- [ ] æ–‡ä»¶ä¸Šä¼ æ­£å¸¸
- [ ] åµŒå¥—ç»“æ„æ­£å¸¸ï¼ˆTableWidgetã€FormWidgetï¼‰

**è¾¹ç•Œæµ‹è¯•**ï¼š
- [ ] ç©ºå€¼å¤„ç†
- [ ] é”™è¯¯å¤„ç†
- [ ] æ€§èƒ½æµ‹è¯•ï¼ˆå¤§é‡æ•°æ®ï¼‰

### 3. å…¼å®¹æ€§æ£€æŸ¥

**éœ€è¦æ£€æŸ¥çš„ Widget ç±»å‹**ï¼š
- [ ] input
- [ ] number
- [ ] float
- [ ] text_area
- [ ] select
- [ ] multiselect
- [ ] switch
- [ ] timestamp
- [ ] files
- [ ] user
- [ ] tableï¼ˆåµŒå¥—ï¼‰
- [ ] formï¼ˆåµŒå¥—ï¼‰

## ğŸ“ è¿ç§»æ£€æŸ¥æ¸…å•

### è¿ç§»å‰
- [ ] ä»£ç å·²æäº¤å¹¶æ¨é€
- [ ] åˆ›å»ºè¿ç§»åˆ†æ”¯
- [ ] æ·»åŠ åŠŸèƒ½å¼€å…³
- [ ] å¤‡ä»½å½“å‰ä»£ç 

### è¿ç§»ä¸­
- [ ] TableRenderer è¿ç§»å®Œæˆ
- [ ] SearchInput è¿ç§»å®Œæˆ
- [ ] æ‰€æœ‰åŠŸèƒ½æµ‹è¯•é€šè¿‡
- [ ] æ€§èƒ½æµ‹è¯•é€šè¿‡

### è¿ç§»å
- [ ] åˆ é™¤æ—§ä»£ç 
- [ ] æ›´æ–°æ–‡æ¡£
- [ ] ä»£ç å®¡æŸ¥
- [ ] åˆå¹¶åˆ°ä¸»åˆ†æ”¯

## ğŸš€ å¼€å§‹è¿ç§»

### ç¬¬ä¸€æ­¥ï¼šåˆ›å»ºè¿ç§»åˆ†æ”¯

```bash
# ç¡®ä¿å½“å‰ä»£ç å·²æäº¤
git status

# åˆ›å»ºè¿ç§»åˆ†æ”¯
git checkout -b migrate/widgets-v2
git push -u origin migrate/widgets-v2
```

### ç¬¬äºŒæ­¥ï¼šæ·»åŠ åŠŸèƒ½å¼€å…³ï¼ˆå¯é€‰ï¼‰

åœ¨ `web/src/core/config.ts` æˆ–ç¯å¢ƒå˜é‡ä¸­æ·»åŠ ï¼š

```typescript
export const USE_WIDGETS_V2 = true // é»˜è®¤ä½¿ç”¨æ–°ç‰ˆæœ¬
```

### ç¬¬ä¸‰æ­¥ï¼šå¼€å§‹è¿ç§»

æŒ‰ç…§ Phase 2-5 é€æ­¥è¿ç§»ã€‚

## ğŸ“š å‚è€ƒæ–‡æ¡£

- `web/docs/æ–°æ—§ç‰ˆæœ¬Widgetç³»ç»Ÿæ·±åº¦å¯¹æ¯”åˆ†æ.md` - å¯¹æ¯”åˆ†æ
- `web/docs/è¿ç§»TableRendereråˆ°widgets-v2æ–¹æ¡ˆ.md` - è¿ç§»æ–¹æ¡ˆ
- `web/src/core/widgets-v2/types.ts` - æ–°ç‰ˆæœ¬ç±»å‹å®šä¹‰
- `web/src/core/factories-v2/WidgetComponentFactory.ts` - æ–°ç‰ˆæœ¬å·¥å‚

## âš ï¸ æ³¨æ„äº‹é¡¹

1. **ä¸è¦åŒæ—¶ä¿®æ”¹å¤šä¸ªæ–‡ä»¶**ï¼šä¸€æ¬¡è¿ç§»ä¸€ä¸ªæ–‡ä»¶ï¼ŒéªŒè¯åå†ç»§ç»­
2. **ä¿ç•™æ—§ä»£ç **ï¼šè¿ç§»å®Œæˆå¹¶éªŒè¯åå†åˆ é™¤
3. **å……åˆ†æµ‹è¯•**ï¼šæ¯ä¸ªè¿ç§»ç‚¹å®Œæˆåç«‹å³æµ‹è¯•
4. **æ–‡æ¡£æ›´æ–°**ï¼šåŠæ—¶æ›´æ–°ç›¸å…³æ–‡æ¡£

