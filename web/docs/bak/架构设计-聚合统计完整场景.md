# èšåˆç»Ÿè®¡å®Œæ•´åœºæ™¯è¯´æ˜

## æ ¸å¿ƒæœºåˆ¶

èšåˆç»Ÿè®¡ç³»ç»Ÿç”¨äº **Select/MultiSelect ç»„ä»¶**ï¼Œå®ç°å®æ—¶çš„æ•°æ®èšåˆè®¡ç®—ï¼ˆå¦‚å•†å“æ€»ä»·ã€æ€»æ•°é‡ã€å¹³å‡ä»·æ ¼ç­‰ï¼‰ã€‚

**æ ¸å¿ƒæµç¨‹ï¼š**
1. åç«¯åœ¨ `OnSelectFuzzy` å›è°ƒå“åº”ä¸­è¿”å› `statistics` å­—æ®µï¼ˆèšåˆè¡¨è¾¾å¼é…ç½®ï¼‰
2. å‰ç«¯ç»„ä»¶ä¿å­˜è¿™äº›è¡¨è¾¾å¼ï¼Œç›‘å¬æ•°æ®å˜åŒ–
3. æ•°æ®å˜åŒ–æ—¶ï¼Œä½¿ç”¨ `ExpressionParser` è‡ªåŠ¨é‡æ–°è®¡ç®—ç»Ÿè®¡
4. åœ¨åˆé€‚çš„ä½ç½®æ˜¾ç¤ºç»Ÿè®¡ç»“æœ

---

## å››ç§èšåˆåœºæ™¯

### åœºæ™¯å¯¹æ¯”è¡¨

| åœºæ™¯ | ç»„ä»¶ä½ç½® | èšåˆå±‚çº§ | æ•°æ®æ¥æº | æ˜¾ç¤ºä½ç½® | å¤æ‚åº¦ |
|-----|---------|---------|---------|---------|-------|
| 1. é¡¶å±‚ MultiSelect | è¡¨å•é¡¶å±‚ | å•å±‚ | é€‰ä¸­é€‰é¡¹çš„ displayInfo | ç»„ä»¶ä¸‹æ–¹ | â­ |
| 2. Struct å†… MultiSelect | Struct å†… | å•å±‚ | é€‰ä¸­é€‰é¡¹çš„ displayInfo | Struct å†…ç»„ä»¶ä¸‹æ–¹ | â­ |
| 3. List å†… Select | List æ¯è¡Œ | å•å±‚ï¼ˆListï¼‰ | æ‰€æœ‰è¡Œçš„ displayInfo + å­—æ®µå€¼ | List åº•éƒ¨ | â­â­ |
| 4. List å†… MultiSelect | List æ¯è¡Œ | **ä¸¤å±‚** | è¡Œå†…ï¼šé€‰é¡¹çš„ displayInfo<br>Listï¼šæ‰€æœ‰è¡Œçš„ç»Ÿè®¡ç»“æœ | è¡Œå†…ï¼šç»„ä»¶ä¸‹æ–¹<br>Listï¼šList åº•éƒ¨ | â­â­â­â­â­ |

---

## åœºæ™¯ 1ï¼šé¡¶å±‚ MultiSelect èšåˆ

**æè¿°ï¼š** ç”¨æˆ·åœ¨è¡¨å•é¡¶å±‚ç›´æ¥å¤šé€‰å•†å“

**åœºæ™¯ä¸¾ä¾‹ï¼š** æ¨èå•†å“é€‰æ‹©
- ç”¨æˆ·é€‰æ‹© 3 ä¸ªæ¨èå•†å“
- è®¡ç®—ï¼šæ¨èå•†å“æ•°ã€æ€»ä»·å€¼ã€å¹³å‡ä»·æ ¼

**æ•°æ®ç»“æ„ï¼š**
```typescript
{
  recommended_products: [101, 102, 103]  // ç›´æ¥å¤šé€‰3ä¸ªå•†å“
}
```

**åç«¯å›è°ƒå“åº”ï¼š**
```json
{
  "values": [
    {
      "value": 101,
      "label": "å•†å“A - Â¥5.00",
      "displayInfo": {
        "å•†å“åç§°": "å•†å“A",
        "ä»·æ ¼": 5.0,
        "åº“å­˜": 100
      }
    },
    {
      "value": 102,
      "label": "å•†å“B - Â¥8.00",
      "displayInfo": {
        "å•†å“åç§°": "å•†å“B",
        "ä»·æ ¼": 8.0,
        "åº“å­˜": 50
      }
    },
    {
      "value": 103,
      "label": "å•†å“C - Â¥3.00",
      "displayInfo": {
        "å•†å“åç§°": "å•†å“C",
        "ä»·æ ¼": 3.0,
        "åº“å­˜": 80
      }
    }
  ],
  "statistics": {
    "æ¨èå•†å“æ•°": "count(ä»·æ ¼)",
    "æ€»ä»·å€¼": "sum(ä»·æ ¼)",
    "å¹³å‡ä»·æ ¼": "avg(ä»·æ ¼)",
    "ä»·æ ¼åŒºé—´": "min(ä»·æ ¼) - max(ä»·æ ¼)"
  }
}
```

**èšåˆè®¡ç®—ï¼š**
```typescript
// æ•°æ®ï¼šé€‰ä¸­çš„é€‰é¡¹çš„ displayInfo
[
  { å•†å“åç§°: "å•†å“A", ä»·æ ¼: 5.0, åº“å­˜: 100 },
  { å•†å“åç§°: "å•†å“B", ä»·æ ¼: 8.0, åº“å­˜: 50 },
  { å•†å“åç§°: "å•†å“C", ä»·æ ¼: 3.0, åº“å­˜: 80 }
]

// è¡¨è¾¾å¼è®¡ç®—
"count(ä»·æ ¼)" â†’ 3
"sum(ä»·æ ¼)" â†’ 5.0 + 8.0 + 3.0 = 16.0
"avg(ä»·æ ¼)" â†’ (5.0 + 8.0 + 3.0) / 3 = 5.33
```

**æ˜¾ç¤ºæ•ˆæœï¼š**
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  æ¨èå•†å“: [å•†å“A] [å•†å“B] [å•†å“C]  â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  æ¨èå•†å“æ•°: 3                       â”‚
â”‚  æ€»ä»·å€¼: Â¥16.00                     â”‚
â”‚  å¹³å‡ä»·æ ¼: Â¥5.33                    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## åœºæ™¯ 2ï¼šStruct å†… MultiSelect èšåˆ

**æè¿°ï¼š** Structï¼ˆForm ç»„ä»¶ï¼‰å†…çš„å¤šé€‰å­—æ®µ

**åœºæ™¯ä¸¾ä¾‹ï¼š** ç”¨æˆ·åå¥½é…ç½®
- åœ¨ç”¨æˆ·èµ„æ–™ï¼ˆStructï¼‰ä¸­é€‰æ‹©å¤šä¸ªæ¨èå•†å“
- è®¡ç®—ï¼šæ¨èå•†å“æ•°ã€æ€»ä»·å€¼ã€å¹³å‡ä»·æ ¼

**æ•°æ®ç»“æ„ï¼š**
```typescript
{
  user_profile: {
    relationship: ["family", "friend"],
    preferences: ["music", "sports"],
    recommended_products: [101, 102, 103]  // Struct å†…çš„ MultiSelect
  }
}
```

**åç«¯å›è°ƒå“åº”ï¼š** ä¸åœºæ™¯ 1 ç›¸åŒ

**èšåˆè®¡ç®—ï¼š** ä¸åœºæ™¯ 1 ç›¸åŒ

**æ˜¾ç¤ºæ•ˆæœï¼š** åœ¨ Struct å†…çš„ MultiSelect ç»„ä»¶ä¸‹æ–¹æ˜¾ç¤ºç»Ÿè®¡

---

## åœºæ™¯ 3ï¼šList å†… Select èšåˆ

**æè¿°ï¼š** List æ¯è¡Œå•é€‰ä¸€ä¸ªå•†å“ï¼ŒList å±‚èšåˆæ‰€æœ‰è¡Œ

**åœºæ™¯ä¸¾ä¾‹ï¼š** æ”¶é“¶å°å•†å“æ¸…å•
- ç¬¬1è¡Œï¼šé€‰æ‹©å•†å“Aï¼Œæ•°é‡2
- ç¬¬2è¡Œï¼šé€‰æ‹©å•†å“Bï¼Œæ•°é‡3
- è®¡ç®—ï¼šå•†å“æ€»ä»·ã€å•†å“æ€»æ•°

**æ•°æ®ç»“æ„ï¼š**
```typescript
{
  products: [
    { product_id: 101, quantity: 2 },  // ç¬¬1è¡Œï¼šå•†å“Aï¼Œæ•°é‡2
    { product_id: 102, quantity: 3 }   // ç¬¬2è¡Œï¼šå•†å“Bï¼Œæ•°é‡3
  ]
}
```

**åç«¯å›è°ƒå“åº”ï¼š**
```json
{
  "values": [
    {
      "value": 101,
      "label": "å•†å“A - Â¥5.00",
      "displayInfo": {
        "å•†å“åç§°": "å•†å“A",
        "ä»·æ ¼": 5.0,
        "åº“å­˜": 100
      }
    },
    {
      "value": 102,
      "label": "å•†å“B - Â¥8.00",
      "displayInfo": {
        "å•†å“åç§°": "å•†å“B",
        "ä»·æ ¼": 8.0,
        "åº“å­˜": 50
      }
    }
  ],
  "statistics": {
    "å•†å“åŸä»·(å…ƒ)": "sum(ä»·æ ¼,*quantity)",
    "ä¼šå‘˜ä»·æ ¼(å…ƒ)": "sum(ä»·æ ¼,*quantity,*0.9)",
    "å•†å“ç§ç±»": "count(ä»·æ ¼)",
    "å•†å“æ€»æ•°": "sum(quantity)"
  }
}
```

**èšåˆè®¡ç®—ï¼š**
```typescript
// æ•°æ®ï¼šæ‰€æœ‰è¡Œçš„ displayInfo + å­—æ®µå€¼
[
  {
    product_id: 101,
    quantity: 2,
    å•†å“åç§°: "å•†å“A",
    ä»·æ ¼: 5.0,    // æ¥è‡ª displayInfo
    åº“å­˜: 100
  },
  {
    product_id: 102,
    quantity: 3,
    å•†å“åç§°: "å•†å“B",
    ä»·æ ¼: 8.0,    // æ¥è‡ª displayInfo
    åº“å­˜: 50
  }
]

// è¡¨è¾¾å¼è®¡ç®—
"sum(ä»·æ ¼,*quantity)" â†’ (5.0 * 2) + (8.0 * 3) = 10.0 + 24.0 = 34.0
"sum(ä»·æ ¼,*quantity,*0.9)" â†’ (5.0 * 2 * 0.9) + (8.0 * 3 * 0.9) = 30.6
"count(ä»·æ ¼)" â†’ 2
"sum(quantity)" â†’ 2 + 3 = 5
```

**æ˜¾ç¤ºæ•ˆæœï¼š**
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  å•†å“æ¸…å•                               â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  å•†å“  â”‚ æ•°é‡ â”‚ å•ä»· â”‚ å°è®¡           â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ å•†å“A  â”‚  2   â”‚ Â¥5   â”‚ Â¥10.00         â”‚
â”‚ å•†å“B  â”‚  3   â”‚ Â¥8   â”‚ Â¥24.00         â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  ç»Ÿè®¡ä¿¡æ¯:                             â”‚
â”‚  å•†å“åŸä»·: Â¥34.00                      â”‚
â”‚  ä¼šå‘˜ä»·æ ¼: Â¥30.60                      â”‚
â”‚  å•†å“ç§ç±»: 2                           â”‚
â”‚  å•†å“æ€»æ•°: 5                           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**èšåˆå±‚çº§ï¼š**
- âœ… List å±‚èšåˆæ‰€æœ‰è¡Œ

---

## åœºæ™¯ 4ï¼šList å†… MultiSelect èšåˆï¼ˆğŸ”¥ æœ€å¤æ‚ï¼Œä¸¤å±‚èšåˆï¼‰

**æè¿°ï¼š** List æ¯è¡Œéƒ½æœ‰ MultiSelectï¼Œæ¯ä¸ª MultiSelect å¯ä»¥å¤šé€‰å•†å“

**åœºæ™¯ä¸¾ä¾‹ï¼š** ç”¨æˆ·é‡‡è´­ç™»è®°
- ç¬¬1è¡Œï¼šå¼ ä¸‰é€‰æ‹©äº† 3 ä¸ªå•†å“ï¼ˆå•†å“Aã€Bã€Cï¼‰
- ç¬¬2è¡Œï¼šæå››é€‰æ‹©äº† 2 ä¸ªå•†å“ï¼ˆå•†å“Bã€Dï¼‰
- **ç¬¬ä¸€å±‚èšåˆ**ï¼šè®¡ç®—æ¯ä¸ªç”¨æˆ·çš„å•†å“æ•°ã€æ€»ä»·
- **ç¬¬äºŒå±‚èšåˆ**ï¼šè®¡ç®—æ‰€æœ‰ç”¨æˆ·çš„å•†å“æ€»æ•°ã€æ€»ä»·

**æ•°æ®ç»“æ„ï¼š**
```typescript
{
  user_purchases: [
    {
      user_id: 1,
      user_name: "å¼ ä¸‰",
      products: [101, 102, 103]  // ğŸ”¥ MultiSelectï¼šå¼ ä¸‰é€‰äº†3ä¸ªå•†å“
    },
    {
      user_id: 2,
      user_name: "æå››",
      products: [102, 104]       // ğŸ”¥ MultiSelectï¼šæå››é€‰äº†2ä¸ªå•†å“
    }
  ]
}
```

**åç«¯å›è°ƒå“åº”ï¼ˆé’ˆå¯¹ products å­—æ®µï¼‰ï¼š**
```json
{
  "values": [
    {
      "value": 101,
      "label": "å•†å“A - Â¥5",
      "displayInfo": {
        "å•†å“åç§°": "å•†å“A",
        "ä»·æ ¼": 5.0
      }
    },
    {
      "value": 102,
      "label": "å•†å“B - Â¥8",
      "displayInfo": {
        "å•†å“åç§°": "å•†å“B",
        "ä»·æ ¼": 8.0
      }
    },
    {
      "value": 103,
      "label": "å•†å“C - Â¥3",
      "displayInfo": {
        "å•†å“åç§°": "å•†å“C",
        "ä»·æ ¼": 3.0
      }
    },
    {
      "value": 104,
      "label": "å•†å“D - Â¥6",
      "displayInfo": {
        "å•†å“åç§°": "å•†å“D",
        "ä»·æ ¼": 6.0
      }
    }
  ],
  "statistics": {
    // ğŸ”¥ ç¬¬ä¸€å±‚ï¼šè¡Œå†…èšåˆï¼ˆæ¯ä¸ª MultiSelect è‡ªå·±èšåˆï¼‰
    "ç”¨æˆ·å•†å“æ•°": "count(ä»·æ ¼)",
    "ç”¨æˆ·æ€»ä»·": "sum(ä»·æ ¼)",
    
    // ğŸ”¥ ç¬¬äºŒå±‚ï¼šList å±‚èšåˆï¼ˆèšåˆæ‰€æœ‰è¡Œçš„ MultiSelectï¼‰
    "æ‰€æœ‰ç”¨æˆ·å•†å“æ•°": "list_sum(ç”¨æˆ·å•†å“æ•°)",
    "æ‰€æœ‰ç”¨æˆ·æ€»ä»·": "list_sum(ç”¨æˆ·æ€»ä»·)"
  }
}
```

### ç¬¬ä¸€å±‚èšåˆï¼šè¡Œå†…èšåˆï¼ˆMultiSelect è‡ªå·±ï¼‰

**ç¬¬1è¡Œï¼ˆå¼ ä¸‰ï¼‰ï¼š**
```typescript
// é€‰ä¸­å•†å“: [101, 102, 103]
displayInfo æ•°æ®: [
  { å•†å“åç§°: "å•†å“A", ä»·æ ¼: 5.0 },
  { å•†å“åç§°: "å•†å“B", ä»·æ ¼: 8.0 },
  { å•†å“åç§°: "å•†å“C", ä»·æ ¼: 3.0 }
]

// è¡Œå†…èšåˆè®¡ç®—
"count(ä»·æ ¼)" â†’ 3
"sum(ä»·æ ¼)" â†’ 5.0 + 8.0 + 3.0 = 16.0

// ç»“æœ
ç”¨æˆ·å•†å“æ•°: 3
ç”¨æˆ·æ€»ä»·: 16.0
```

**ç¬¬2è¡Œï¼ˆæå››ï¼‰ï¼š**
```typescript
// é€‰ä¸­å•†å“: [102, 104]
displayInfo æ•°æ®: [
  { å•†å“åç§°: "å•†å“B", ä»·æ ¼: 8.0 },
  { å•†å“åç§°: "å•†å“D", ä»·æ ¼: 6.0 }
]

// è¡Œå†…èšåˆè®¡ç®—
"count(ä»·æ ¼)" â†’ 2
"sum(ä»·æ ¼)" â†’ 8.0 + 6.0 = 14.0

// ç»“æœ
ç”¨æˆ·å•†å“æ•°: 2
ç”¨æˆ·æ€»ä»·: 14.0
```

### ç¬¬äºŒå±‚èšåˆï¼šList å±‚èšåˆï¼ˆListWidgetï¼‰

```typescript
// æ•°æ®ï¼šæ‰€æœ‰è¡Œçš„è¡Œå†…ç»Ÿè®¡ç»“æœ
[
  {
    user_id: 1,
    user_name: "å¼ ä¸‰",
    ç”¨æˆ·å•†å“æ•°: 3,    // ğŸ”¥ æ¥è‡ªç¬¬1è¡Œ MultiSelect çš„è¡Œå†…èšåˆ
    ç”¨æˆ·æ€»ä»·: 16.0
  },
  {
    user_id: 2,
    user_name: "æå››",
    ç”¨æˆ·å•†å“æ•°: 2,    // ğŸ”¥ æ¥è‡ªç¬¬2è¡Œ MultiSelect çš„è¡Œå†…èšåˆ
    ç”¨æˆ·æ€»ä»·: 14.0
  }
]

// List å±‚èšåˆè®¡ç®—
"list_sum(ç”¨æˆ·å•†å“æ•°)" â†’ 3 + 2 = 5
"list_sum(ç”¨æˆ·æ€»ä»·)" â†’ 16.0 + 14.0 = 30.0

// ç»“æœ
æ‰€æœ‰ç”¨æˆ·å•†å“æ•°: 5
æ‰€æœ‰ç”¨æˆ·æ€»ä»·: 30.0
```

### æ˜¾ç¤ºæ•ˆæœ

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  ç”¨æˆ·é‡‡è´­ç™»è®°                                          â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  ç”¨æˆ·  â”‚  é‡‡è´­å•†å“                          â”‚  ç»Ÿè®¡   â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ å¼ ä¸‰   â”‚ [å•†å“A] [å•†å“B] [å•†å“C]           â”‚         â”‚
â”‚        â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚         â”‚
â”‚        â”‚ â”‚ ç”¨æˆ·å•†å“æ•°: 3                â”‚  â”‚         â”‚
â”‚        â”‚ â”‚ ç”¨æˆ·æ€»ä»·: Â¥16.00             â”‚  â”‚         â”‚
â”‚        â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚         â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ æå››   â”‚ [å•†å“B] [å•†å“D]                   â”‚         â”‚
â”‚        â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚         â”‚
â”‚        â”‚ â”‚ ç”¨æˆ·å•†å“æ•°: 2                â”‚  â”‚         â”‚
â”‚        â”‚ â”‚ ç”¨æˆ·æ€»ä»·: Â¥14.00             â”‚  â”‚         â”‚
â”‚        â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚         â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  æ±‡æ€»ç»Ÿè®¡:                                             â”‚
â”‚  æ‰€æœ‰ç”¨æˆ·å•†å“æ•°: 5                                     â”‚
â”‚  æ‰€æœ‰ç”¨æˆ·æ€»ä»·: Â¥30.00                                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### èŒè´£åˆ’åˆ†

| ç»„ä»¶ | èŒè´£ | æ•°æ®æ¥æº | èšåˆå‡½æ•° |
|-----|------|---------|---------|
| **MultiSelectWidget** | è¡Œå†…èšåˆ | é€‰ä¸­é€‰é¡¹çš„ displayInfo | `count()`, `sum()`, `avg()` ç­‰ |
| **ListWidget** | List å±‚èšåˆ | æ‰€æœ‰è¡Œçš„è¡Œå†…ç»Ÿè®¡ç»“æœ | `list_sum()`, `list_avg()`, `list_count()` ç­‰ |

### æ•°æ®æµ

```
1. ç”¨æˆ·åœ¨ç¬¬1è¡Œï¼ˆå¼ ä¸‰ï¼‰çš„ MultiSelect é€‰æ‹©å•†å“ [101, 102, 103]
   â†“
2. MultiSelectWidget.updateRowStatistics()
   - è®¡ç®—è¡Œå†…èšåˆ: { ç”¨æˆ·å•†å“æ•°: 3, ç”¨æˆ·æ€»ä»·: 16.0 }
   - ä¿å­˜åˆ° FieldValue.meta.rowStatistics
   â†“
3. MultiSelectWidget.onChange() æ›´æ–° rowManager
   â†“
4. ListWidget.watch è§¦å‘ï¼ˆæ£€æµ‹åˆ° rowManager å˜åŒ–ï¼‰
   â†“
5. ListWidget.getAllRowsData()
   - æ”¶é›†æ‰€æœ‰è¡Œçš„æ•°æ®ï¼ŒåŒ…æ‹¬ rowStatistics
   - [
       { user_id: 1, ç”¨æˆ·å•†å“æ•°: 3, ç”¨æˆ·æ€»ä»·: 16.0 },
       { user_id: 2, ç”¨æˆ·å•†å“æ•°: 2, ç”¨æˆ·æ€»ä»·: 14.0 }
     ]
   â†“
6. ListWidget.updateListStatistics()
   - è®¡ç®— List å±‚èšåˆ:
     - list_sum(ç”¨æˆ·å•†å“æ•°) = 3 + 2 = 5
     - list_sum(ç”¨æˆ·æ€»ä»·) = 16.0 + 14.0 = 30.0
   â†“
7. æ›´æ–°æ˜¾ç¤º:
   - ç¬¬1è¡Œ MultiSelect ä¸‹æ–¹: ç”¨æˆ·å•†å“æ•°: 3, ç”¨æˆ·æ€»ä»·: Â¥16.00
   - ç¬¬2è¡Œ MultiSelect ä¸‹æ–¹: ç”¨æˆ·å•†å“æ•°: 2, ç”¨æˆ·æ€»ä»·: Â¥14.00
   - List åº•éƒ¨: æ‰€æœ‰ç”¨æˆ·å•†å“æ•°: 5, æ‰€æœ‰ç”¨æˆ·æ€»ä»·: Â¥30.00
```

---

## è¡¨è¾¾å¼è§£æå™¨å‡½æ•°

### è¡Œå†…èšåˆå‡½æ•°ï¼ˆåœºæ™¯ 1, 2, 4 ç¬¬ä¸€å±‚ï¼‰

| å‡½æ•° | è¯´æ˜ | ç¤ºä¾‹ | ç»“æœ |
|-----|------|------|------|
| `count(å­—æ®µ)` | è®¡æ•° | `count(ä»·æ ¼)` | 3 |
| `sum(å­—æ®µ)` | æ±‚å’Œ | `sum(ä»·æ ¼)` | 16.0 |
| `avg(å­—æ®µ)` | å¹³å‡å€¼ | `avg(ä»·æ ¼)` | 5.33 |
| `min(å­—æ®µ)` | æœ€å°å€¼ | `min(ä»·æ ¼)` | 3.0 |
| `max(å­—æ®µ)` | æœ€å¤§å€¼ | `max(ä»·æ ¼)` | 8.0 |
| `sum(å­—æ®µ,*å­—æ®µ)` | ä¹˜æ³•æ±‚å’Œ | `sum(ä»·æ ¼,*quantity)` | 34.0 |
| `sum(å­—æ®µ,*ç³»æ•°)` | ç³»æ•°æ±‚å’Œ | `sum(ä»·æ ¼,*0.9)` | 14.4 |

### List å±‚èšåˆå‡½æ•°ï¼ˆåœºæ™¯ 3, 4 ç¬¬äºŒå±‚ï¼‰

| å‡½æ•° | è¯´æ˜ | ç¤ºä¾‹ | ç»“æœ |
|-----|------|------|------|
| `list_sum(å­—æ®µ)` | å¯¹æ‰€æœ‰è¡Œçš„å­—æ®µæ±‚å’Œ | `list_sum(ç”¨æˆ·æ€»ä»·)` | 30.0 |
| `list_avg(å­—æ®µ)` | å¯¹æ‰€æœ‰è¡Œçš„å­—æ®µæ±‚å¹³å‡ | `list_avg(ç”¨æˆ·æ€»ä»·)` | 15.0 |
| `list_count()` | ç»Ÿè®¡è¡Œæ•° | `list_count()` | 2 |
| `list_min(å­—æ®µ)` | å¯¹æ‰€æœ‰è¡Œçš„å­—æ®µå–æœ€å° | `list_min(ç”¨æˆ·æ€»ä»·)` | 14.0 |
| `list_max(å­—æ®µ)` | å¯¹æ‰€æœ‰è¡Œçš„å­—æ®µå–æœ€å¤§ | `list_max(ç”¨æˆ·æ€»ä»·)` | 16.0 |

**æ³¨æ„ï¼š** `list_*` å‡½æ•°åªç”¨äº List å±‚èšåˆï¼Œä½œç”¨äºæ‰€æœ‰è¡Œçš„ç»Ÿè®¡ç»“æœã€‚

---

## å®ç°è¦ç‚¹

### 1. è¡Œå†…èšåˆï¼ˆMultiSelectï¼‰

```typescript
// ä¿å­˜è¡Œå†…ç»Ÿè®¡ç»“æœåˆ° FieldValue.meta
onChange({
  raw: selectedValues.value,
  display: `å·²é€‰ ${selectedValues.value.length} é¡¹`,
  meta: {
    dataType: field.data.type,
    displayInfo: {
      selectedOptions: selectedOptions,
    },
    // ğŸ”¥ ä¿å­˜è¡Œå†…èšåˆç»“æœ
    rowStatistics: {
      ç”¨æˆ·å•†å“æ•°: 3,
      ç”¨æˆ·æ€»ä»·: 16.0
    }
  }
})
```

### 2. List å±‚èšåˆï¼ˆListWidgetï¼‰

```typescript
// è·å–æ‰€æœ‰è¡Œçš„æ•°æ®ï¼ŒåŒ…æ‹¬è¡Œå†…ç»Ÿè®¡
const getAllRowsData = () => {
  const allData: any[] = []
  
  for (const [index, rowManager] of rowManagers) {
    const row: Record<string, any> = {}
    
    for (const [code, fieldValue] of rowManager.store) {
      row[code] = fieldValue.raw
      
      // ğŸ”¥ åˆå¹¶è¡Œå†…ç»Ÿè®¡ç»“æœ
      if (fieldValue.meta?.rowStatistics) {
        Object.assign(row, fieldValue.meta.rowStatistics)
      }
    }
    
    allData.push(row)
  }
  
  return allData
}
```

### 3. è¡¨è¾¾å¼è§£æå™¨åŒºåˆ†èšåˆå±‚çº§

```typescript
class ExpressionParser {
  evaluate(expr: string, dataSource: any[]): any {
    const match = expr.match(/^(\w+)\((.*)\)$/)
    if (!match) return expr
    
    const [, funcName, argsStr] = match
    
    // ğŸ”¥ æ ¹æ®å‡½æ•°åå‰ç¼€åˆ¤æ–­èšåˆå±‚çº§
    if (funcName.startsWith('list_')) {
      // List å±‚èšåˆï¼šå¯¹æ‰€æœ‰è¡Œçš„æŸä¸ªå­—æ®µèšåˆ
      return this.evaluateListAggregation(funcName, argsStr, dataSource)
    } else {
      // è¡Œå†…èšåˆï¼šå¯¹å½“å‰è¡Œçš„å¤šä¸ªé€‰é¡¹èšåˆ
      return this.evaluateRowAggregation(funcName, argsStr, dataSource)
    }
  }
}
```

---

## æ€»ç»“

### å››ç§åœºæ™¯å¯¹æ¯”

| åœºæ™¯ | èšåˆå±‚çº§ | è°è´Ÿè´£èšåˆ | æ˜¾ç¤ºä½ç½® | å…¸å‹ç”¨ä¾‹ |
|-----|---------|-----------|---------|---------|
| 1. é¡¶å±‚ MultiSelect | å•å±‚ | MultiSelectWidget | ç»„ä»¶ä¸‹æ–¹ | æ¨èå•†å“é€‰æ‹© |
| 2. Struct å†… MultiSelect | å•å±‚ | MultiSelectWidget | Struct å†…ç»„ä»¶ä¸‹æ–¹ | ç”¨æˆ·åå¥½é…ç½® |
| 3. List å†… Select | å•å±‚ï¼ˆListï¼‰ | ListWidget | List åº•éƒ¨ | æ”¶é“¶å°å•†å“æ¸…å• |
| 4. List å†… MultiSelect | **ä¸¤å±‚** | MultiSelectWidget + ListWidget | è¡Œå†… + List åº•éƒ¨ | ç”¨æˆ·é‡‡è´­ç™»è®° |

### å…³é”®è®¾è®¡ç‚¹

âœ… **èŒè´£æ¸…æ™°**ï¼šMultiSelect è´Ÿè´£è¡Œå†…èšåˆï¼ŒListWidget è´Ÿè´£ List å±‚èšåˆ  
âœ… **æ•°æ®æµæ¸…æ™°**ï¼šè¡Œå†…ç»Ÿè®¡ä¿å­˜åˆ° `FieldValue.meta.rowStatistics`  
âœ… **è¡¨è¾¾å¼æ˜“æ‡‚**ï¼š`list_*` å‰ç¼€æ˜ç¡®è¡¨ç¤º List å±‚èšåˆ  
âœ… **è‡ªåŠ¨è®¡ç®—**ï¼šwatch ç›‘å¬æ•°æ®å˜åŒ–ï¼Œè‡ªåŠ¨é‡æ–°è®¡ç®—  
âœ… **çµæ´»æ‰©å±•**ï¼šæ˜“äºæ·»åŠ æ–°çš„èšåˆå‡½æ•°

**è¿™ä¸ªè®¾è®¡å¯ä»¥ä¼˜é›…åœ°å¤„ç†æ‰€æœ‰èšåˆåœºæ™¯ï¼ŒåŒ…æ‹¬æœ€å¤æ‚çš„ä¸¤å±‚èšåˆï¼** âœ…
