# Loki 性能优化配置示例
# 适用于多租户、动态应用场景

auth_enabled: false

server:
  http_listen_port: 3100
  grpc_listen_port: 9096
  log_level: info

# 查询性能配置
query_scheduler:
  max_outstanding_requests_per_tenant: 2048

frontend:
  max_outstanding_per_tenant: 2048
  query_stats_enabled: true

# 查询前端配置
querier:
  query_timeout: 300s
  max_concurrent: 20
  engine:
    timeout: 300s
    max_look_back_period: 30s

# 存储配置
schema_config:
  configs:
    - from: 2024-01-01
      store: tsdb
      object_store: filesystem
      schema: v13
      index:
        prefix: index_
        period: 24h

# 存储引擎配置（TSDB，性能更好）
storage_config:
  tsdb_shipper:
    active_index_directory: /loki/tsdb-index
    cache_location: /loki/tsdb-cache
    cache_ttl: 24h
    query_ready_num_days: 0

  filesystem:
    directory: /loki/chunks

# 压缩配置
compactor:
  working_directory: /loki/compactor
  shared_store: filesystem
  compaction_interval: 10m
  retention_enabled: true
  retention_delete_delay: 2h
  retention_delete_worker_count: 150

# 限制配置（防止资源耗尽）
limits_config:
  # 每个租户的限制
  ingestion_rate_mb: 10              # 每秒最大摄入 10 MB
  ingestion_burst_size_mb: 20         # 突发最大 20 MB
  max_query_length: 721h              # 最大查询时间范围
  max_query_parallelism: 32           # 最大并行查询数
  max_streams_per_user: 10000        # 每个租户最大流数
  max_line_size: 256KB                # 单行最大大小
  max_entries_limit_per_query: 10000  # 单次查询最大条目数
  
  # 保留策略
  retention_period: 168h              # 保留 7 天（可根据需要调整）
  
  # 查询限制
  max_query_series: 500               # 最大查询序列数
  query_timeout: 300s                 # 查询超时时间

# 多租户配置
auth_enabled: false  # 如果启用多租户认证，设置为 true

# 性能优化：启用查询结果缓存
query_range:
  results_cache:
    cache:
      embedded_cache:
        enabled: true
        max_size_mb: 100              # 缓存大小 100 MB

# 性能监控
instrumentation:
  trace_exporter: none
  distributor_client:
    remote_timeout: 5s




