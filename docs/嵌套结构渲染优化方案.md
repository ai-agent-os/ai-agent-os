# 嵌套结构渲染优化方案

## 问题描述

当表格中包含嵌套的 form 字段时（如 `product_detail`），在编辑模式下直接渲染会导致：
1. 表格列变得很宽，布局混乱
2. 嵌套的 form 和 table 在表格单元格中渲染会很混乱
3. 用户体验不好

## 旧版方案分析

旧版 TableWidget 的处理方式：
1. **表格单元格显示**：对于 form 类型字段，显示简化按钮（"共 X 个字段"）
2. **详情抽屉**：点击按钮后打开抽屉，在抽屉中显示完整的 form 内容
3. **编辑模式**：在表格单元格中直接渲染，但可能导致布局混乱

## 新版优化方案

### 方案 1：编辑模式也使用抽屉（推荐）

**优点**：
- 布局整洁，不会导致表格列过宽
- 用户体验好，编辑空间充足
- 避免嵌套过深导致的布局混乱

**缺点**：
- 需要点击才能编辑，不如直接编辑方便

**实现**：
- 在编辑模式下，对于 form 类型的字段，也使用简化显示 + 抽屉编辑
- 抽屉中可以编辑所有子字段

### 方案 2：根据深度决定渲染方式

**优点**：
- 浅层嵌套可以直接编辑，深层嵌套使用抽屉
- 平衡了便利性和布局整洁

**缺点**：
- 逻辑稍复杂

**实现**：
- `depth <= 2`：直接在表格单元格中编辑
- `depth > 2`：使用抽屉编辑

### 方案 3：根据嵌套复杂度决定

**优点**：
- 根据实际复杂度决定，更智能

**缺点**：
- 判断逻辑复杂

**实现**：
- 如果 form 包含嵌套的 table，使用抽屉
- 如果 form 的子字段数量 > 5，使用抽屉
- 否则直接编辑

## 推荐方案

**推荐使用方案 1**：编辑模式也使用抽屉

**理由**：
1. 布局整洁，不会导致表格列过宽
2. 编辑空间充足，特别是对于包含嵌套 table 的 form
3. 用户体验一致：查看和编辑都通过抽屉
4. 实现简单，逻辑清晰

## 实现细节

1. **TableWidget 编辑模式**：
   - 对于 form 类型的字段，在编辑状态下也使用简化显示
   - 点击按钮打开抽屉，在抽屉中编辑

2. **FormWidget 编辑模式**：
   - 在抽屉中，form 字段使用正常的编辑模式渲染
   - 支持嵌套的 table 等复杂组件

3. **数据同步**：
   - 抽屉中的编辑直接更新到 formDataStore
   - 保存时数据会自动同步

