# License æœåŠ¡è®¾è®¡æ–¹æ¡ˆï¼ˆåŸºäº NATS å¹¿æ’­ï¼‰

## ğŸ¯ æ ¸å¿ƒè®¾è®¡

**ç‹¬ç«‹çš„ License æœåŠ¡ + NATS å¹¿æ’­æœºåˆ¶**

- âœ… **ç‹¬ç«‹çš„ License æœåŠ¡**ï¼šç»Ÿä¸€ç®¡ç† License
- âœ… **NATS å¹¿æ’­**ï¼šæ‰€æœ‰å®ä¾‹é€šè¿‡ NATS è®¢é˜… License çŠ¶æ€
- âœ… **é»˜è®¤ç¤¾åŒºç‰ˆ**ï¼šå¦‚æœæ— æ³•è¿æ¥åˆ° License æœåŠ¡ï¼Œè§†ä¸ºç¤¾åŒºç‰ˆ
- âœ… **å®æ—¶åŒæ­¥**ï¼šLicense çŠ¶æ€å˜æ›´å®æ—¶é€šçŸ¥æ‰€æœ‰å®ä¾‹

---

## ğŸ—ï¸ æ¶æ„è®¾è®¡

### æ•´ä½“æ¶æ„

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    License æœåŠ¡                          â”‚
â”‚                                                         â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”‚
â”‚  â”‚  License Manager                             â”‚      â”‚
â”‚  â”‚  - è¯»å– License æ–‡ä»¶                         â”‚      â”‚
â”‚  â”‚  - éªŒè¯ Licenseï¼ˆç­¾åã€è¿‡æœŸã€éƒ¨ç½²IDç­‰ï¼‰       â”‚      â”‚
â”‚  â”‚  - ç®¡ç† License çŠ¶æ€                         â”‚      â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â”‚
â”‚                    â”‚                                    â”‚
â”‚                    â”‚ NATS å‘å¸ƒ                          â”‚
â”‚                    â†“                                    â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”‚
â”‚  â”‚  NATS ä¸»é¢˜ï¼šlicense.status                   â”‚      â”‚
â”‚  â”‚  - å‘å¸ƒ License çŠ¶æ€å˜æ›´                     â”‚      â”‚
â”‚  â”‚  - å®šæœŸå‘å¸ƒå¿ƒè·³ï¼ˆç¡®è®¤æœåŠ¡å­˜æ´»ï¼‰              â”‚      â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                    â”‚
                    â”‚ NATS è®¢é˜…
                    â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚              æ‰€æœ‰æœåŠ¡å®ä¾‹ï¼ˆè®¢é˜… License çŠ¶æ€ï¼‰            â”‚
â”‚                                                         â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”            â”‚
â”‚  â”‚app-serverâ”‚  â”‚agent-serverâ”‚ â”‚app-runtimeâ”‚            â”‚
â”‚  â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜            â”‚
â”‚       â”‚             â”‚             â”‚                   â”‚
â”‚       â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                   â”‚
â”‚                    â”‚                                   â”‚
â”‚                    â”‚ è®¢é˜…ä¸»é¢˜ï¼šlicense.status          â”‚
â”‚                    â†“                                   â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”‚
â”‚  â”‚  License Client                               â”‚     â”‚
â”‚  â”‚  - è®¢é˜… License çŠ¶æ€                         â”‚     â”‚
â”‚  â”‚  - æ›´æ–°æœ¬åœ° License çŠ¶æ€                     â”‚     â”‚
â”‚  â”‚  - å¦‚æœæ— æ³•è¿æ¥ï¼Œé»˜è®¤ç¤¾åŒºç‰ˆ                   â”‚     â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ“‹ License æœåŠ¡è®¾è®¡

### æœåŠ¡èŒè´£

1. âœ… **è¯»å– License æ–‡ä»¶**
   - ä»é…ç½®è·¯å¾„è¯»å– License æ–‡ä»¶
   - æ”¯æŒç¯å¢ƒå˜é‡æŒ‡å®šè·¯å¾„

2. âœ… **éªŒè¯ License**
   - RSA ç­¾åéªŒè¯
   - è¿‡æœŸæ—¶é—´æ£€æŸ¥
   - éƒ¨ç½²æ ‡è¯†éªŒè¯ï¼ˆå¦‚æœå¯ç”¨ï¼‰

3. âœ… **ç®¡ç† License çŠ¶æ€**
   - ç»´æŠ¤å½“å‰ License çŠ¶æ€ï¼ˆæœ‰æ•ˆ/æ— æ•ˆ/ç¤¾åŒºç‰ˆï¼‰
   - å®šæœŸæ£€æŸ¥ License æ˜¯å¦è¿‡æœŸ
   - æ”¯æŒåœ¨çº¿éªŒè¯ï¼ˆå¦‚æœå¯ç”¨ï¼‰

4. âœ… **å¹¿æ’­ License çŠ¶æ€**
   - é€šè¿‡ NATS å‘å¸ƒ License çŠ¶æ€
   - å®šæœŸå‘å¸ƒå¿ƒè·³ï¼ˆç¡®è®¤æœåŠ¡å­˜æ´»ï¼‰
   - License çŠ¶æ€å˜æ›´æ—¶ç«‹å³å¹¿æ’­

---

### License çŠ¶æ€æ¶ˆæ¯æ ¼å¼

```go
// pkg/license/message.go

// LicenseStatusMessage License çŠ¶æ€æ¶ˆæ¯
type LicenseStatusMessage struct {
    // æ¶ˆæ¯ç±»å‹
    Type string `json:"type"` // "status" | "heartbeat" | "update"
    
    // License ä¿¡æ¯
    License *License `json:"license,omitempty"` // License å¯¹è±¡ï¼ˆå¦‚æœæœ‰æ•ˆï¼‰
    
    // çŠ¶æ€ä¿¡æ¯
    IsValid    bool   `json:"is_valid"`     // License æ˜¯å¦æœ‰æ•ˆ
    IsCommunity bool  `json:"is_community"` // æ˜¯å¦ä¸ºç¤¾åŒºç‰ˆ
    Edition    string `json:"edition"`      // "community" | "enterprise"
    
    // é”™è¯¯ä¿¡æ¯ï¼ˆå¦‚æœæ— æ•ˆï¼‰
    Error      string `json:"error,omitempty"` // é”™è¯¯ä¿¡æ¯
    
    // æ—¶é—´æˆ³
    Timestamp  int64  `json:"timestamp"` // Unix æ—¶é—´æˆ³
}
```

---

### NATS ä¸»é¢˜è®¾è®¡

**ä¸»é¢˜åç§°**ï¼š`license.status`

**æ¶ˆæ¯ç±»å‹**ï¼š

1. **status** - License çŠ¶æ€æ¶ˆæ¯
   - æœåŠ¡å¯åŠ¨æ—¶å‘å¸ƒ
   - License çŠ¶æ€å˜æ›´æ—¶å‘å¸ƒ
   - åŒ…å«å®Œæ•´çš„ License ä¿¡æ¯

2. **heartbeat** - å¿ƒè·³æ¶ˆæ¯
   - å®šæœŸå‘å¸ƒï¼ˆæ¯30ç§’ï¼‰
   - ç¡®è®¤ License æœåŠ¡å­˜æ´»
   - å¦‚æœè®¢é˜…è€…æ”¶ä¸åˆ°å¿ƒè·³ï¼Œè§†ä¸ºç¤¾åŒºç‰ˆ

3. **update** - License æ›´æ–°æ¶ˆæ¯
   - License æ–‡ä»¶æ›´æ–°æ—¶å‘å¸ƒ
   - License æ¿€æ´»/æ’¤é”€æ—¶å‘å¸ƒ

---

## ğŸ”Œ License Client è®¾è®¡ï¼ˆå„æœåŠ¡å®ä¾‹ï¼‰

### å®¢æˆ·ç«¯èŒè´£

1. âœ… **è®¢é˜… License çŠ¶æ€**
   - è®¢é˜… NATS ä¸»é¢˜ `license.status`
   - æ¥æ”¶ License çŠ¶æ€æ¶ˆæ¯

2. âœ… **æ›´æ–°æœ¬åœ° License çŠ¶æ€**
   - æ ¹æ®æ”¶åˆ°çš„æ¶ˆæ¯æ›´æ–°æœ¬åœ° License çŠ¶æ€
   - æ›´æ–° `license.GetManager()` çš„çŠ¶æ€

3. âœ… **å®¹é”™å¤„ç†**
   - å¦‚æœæ— æ³•è¿æ¥åˆ° NATSï¼Œé»˜è®¤ç¤¾åŒºç‰ˆ
   - å¦‚æœæ”¶ä¸åˆ°å¿ƒè·³ï¼ˆè¶…æ—¶ï¼‰ï¼Œé™çº§åˆ°ç¤¾åŒºç‰ˆ
   - è‡ªåŠ¨é‡è¿æœºåˆ¶

---

### å®¢æˆ·ç«¯å®ç°

```go
// pkg/license/client.go

// Client License å®¢æˆ·ç«¯
type Client struct {
    conn        *nats.Conn
    subscription *nats.Subscription
    manager     *Manager
    lastHeartbeat time.Time
    heartbeatTimeout time.Duration
    mu          sync.RWMutex
}

// NewClient åˆ›å»º License å®¢æˆ·ç«¯
func NewClient(natsURL string, manager *Manager) (*Client, error) {
    // è¿æ¥ NATS
    conn, err := nats.Connect(natsURL)
    if err != nil {
        // æ— æ³•è¿æ¥ NATSï¼Œè¿”å› nilï¼ˆè§†ä¸ºç¤¾åŒºç‰ˆï¼‰
        return nil, nil
    }
    
    client := &Client{
        conn: conn,
        manager: manager,
        heartbeatTimeout: 60 * time.Second, // 60ç§’è¶…æ—¶
    }
    
    // è®¢é˜…ä¸»é¢˜
    sub, err := conn.Subscribe("license.status", client.handleMessage)
    if err != nil {
        conn.Close()
        return nil, err
    }
    
    client.subscription = sub
    
    // å¯åŠ¨å¿ƒè·³æ£€æŸ¥
    go client.startHeartbeatCheck()
    
    return client, nil
}

// handleMessage å¤„ç† License çŠ¶æ€æ¶ˆæ¯
func (c *Client) handleMessage(msg *nats.Msg) {
    var statusMsg LicenseStatusMessage
    if err := json.Unmarshal(msg.Data, &statusMsg); err != nil {
        return
    }
    
    switch statusMsg.Type {
    case "status", "update":
        // æ›´æ–° License çŠ¶æ€
        c.updateLicenseStatus(&statusMsg)
    case "heartbeat":
        // æ›´æ–°å¿ƒè·³æ—¶é—´
        c.mu.Lock()
        c.lastHeartbeat = time.Now()
        c.mu.Unlock()
    }
}

// updateLicenseStatus æ›´æ–° License çŠ¶æ€
func (c *Client) updateLicenseStatus(msg *LicenseStatusMessage) {
    c.mu.Lock()
    defer c.mu.Unlock()
    
    if msg.IsValid && msg.License != nil {
        // License æœ‰æ•ˆï¼Œæ›´æ–°åˆ° Manager
        c.manager.setLicense(msg.License)
    } else {
        // License æ— æ•ˆï¼Œæ¸…é™¤ Licenseï¼ˆé™çº§åˆ°ç¤¾åŒºç‰ˆï¼‰
        c.manager.setLicense(nil)
    }
}

// startHeartbeatCheck å¯åŠ¨å¿ƒè·³æ£€æŸ¥
func (c *Client) startHeartbeatCheck() {
    ticker := time.NewTicker(10 * time.Second)
    defer ticker.Stop()
    
    for range ticker.C {
        c.mu.RLock()
        lastHeartbeat := c.lastHeartbeat
        timeout := c.heartbeatTimeout
        c.mu.RUnlock()
        
        // å¦‚æœè¶…è¿‡è¶…æ—¶æ—¶é—´æœªæ”¶åˆ°å¿ƒè·³ï¼Œé™çº§åˆ°ç¤¾åŒºç‰ˆ
        if time.Since(lastHeartbeat) > timeout {
            c.manager.setLicense(nil)
        }
    }
}
```

---

## ğŸš€ License æœåŠ¡å®ç°

### æœåŠ¡ç»“æ„

```go
// core/license-server/server/server.go

// Server License æœåŠ¡
type Server struct {
    manager     *license.Manager
    natsConn    *nats.Conn
    licensePath string
    ticker      *time.Ticker
    mu          sync.RWMutex
}

// NewServer åˆ›å»º License æœåŠ¡
func NewServer(natsURL, licensePath string) (*Server, error) {
    // è¿æ¥ NATS
    conn, err := nats.Connect(natsURL)
    if err != nil {
        return nil, err
    }
    
    // åˆ›å»º License Manager
    manager := license.NewManager()
    
    server := &Server{
        manager: manager,
        natsConn: conn,
        licensePath: licensePath,
    }
    
    return server, nil
}

// Start å¯åŠ¨æœåŠ¡
func (s *Server) Start(ctx context.Context) error {
    // 1. åŠ è½½ License
    if err := s.loadLicense(); err != nil {
        logger.Warnf(ctx, "[License Service] Failed to load license: %v", err)
        // å³ä½¿åŠ è½½å¤±è´¥ï¼Œä¹Ÿè¦å‘å¸ƒç¤¾åŒºç‰ˆçŠ¶æ€
    }
    
    // 2. å‘å¸ƒåˆå§‹çŠ¶æ€
    s.publishStatus()
    
    // 3. å¯åŠ¨å®šæœŸä»»åŠ¡
    s.ticker = time.NewTicker(30 * time.Second)
    go s.startPeriodicTasks(ctx)
    
    return nil
}

// loadLicense åŠ è½½ License
func (s *Server) loadLicense() error {
    return s.manager.LoadLicense(s.licensePath)
}

// publishStatus å‘å¸ƒ License çŠ¶æ€
func (s *Server) publishStatus() {
    msg := s.buildStatusMessage()
    data, _ := json.Marshal(msg)
    s.natsConn.Publish("license.status", data)
}

// buildStatusMessage æ„å»ºçŠ¶æ€æ¶ˆæ¯
func (s *Server) buildStatusMessage() *license.LicenseStatusMessage {
    s.mu.RLock()
    lic := s.manager.GetLicense()
    s.mu.RUnlock()
    
    msg := &license.LicenseStatusMessage{
        Type: "status",
        Timestamp: time.Now().Unix(),
    }
    
    if lic != nil && lic.IsValid() {
        msg.License = lic
        msg.IsValid = true
        msg.IsCommunity = false
        msg.Edition = lic.Edition
    } else {
        msg.IsValid = false
        msg.IsCommunity = true
        msg.Edition = "community"
    }
    
    return msg
}

// startPeriodicTasks å¯åŠ¨å®šæœŸä»»åŠ¡
func (s *Server) startPeriodicTasks(ctx context.Context) {
    for {
        select {
        case <-s.ticker.C:
            // 1. å‘å¸ƒå¿ƒè·³
            s.publishHeartbeat()
            
            // 2. æ£€æŸ¥ License æ˜¯å¦è¿‡æœŸ
            s.checkLicenseExpiry()
            
        case <-ctx.Done():
            return
        }
    }
}

// publishHeartbeat å‘å¸ƒå¿ƒè·³
func (s *Server) publishHeartbeat() {
    msg := &license.LicenseStatusMessage{
        Type: "heartbeat",
        Timestamp: time.Now().Unix(),
    }
    data, _ := json.Marshal(msg)
    s.natsConn.Publish("license.status", data)
}

// checkLicenseExpiry æ£€æŸ¥ License æ˜¯å¦è¿‡æœŸ
func (s *Server) checkLicenseExpiry(ctx context.Context) {
    lic := s.manager.GetLicense()
    if lic != nil && !lic.IsValid() {
        // License å·²è¿‡æœŸï¼Œå‘å¸ƒæ›´æ–°æ¶ˆæ¯
        s.publishStatus()
    }
}
```

---

## ğŸ”„ å·¥ä½œæµç¨‹

### 1. License æœåŠ¡å¯åŠ¨

```
License æœåŠ¡å¯åŠ¨
  â†“
è¿æ¥ NATS
  â†“
è¯»å– License æ–‡ä»¶
  â†“
éªŒè¯ Licenseï¼ˆç­¾åã€è¿‡æœŸç­‰ï¼‰
  â†“
å‘å¸ƒåˆå§‹çŠ¶æ€æ¶ˆæ¯ï¼ˆstatusï¼‰
  â†“
å¯åŠ¨å®šæœŸä»»åŠ¡
  â”œâ”€ æ¯30ç§’å‘å¸ƒå¿ƒè·³ï¼ˆheartbeatï¼‰
  â””â”€ å®šæœŸæ£€æŸ¥ License æ˜¯å¦è¿‡æœŸ
```

---

### 2. æœåŠ¡å®ä¾‹å¯åŠ¨

```
æœåŠ¡å®ä¾‹å¯åŠ¨
  â†“
è¿æ¥ NATS
  â†“
åˆ›å»º License Client
  â”œâ”€ æˆåŠŸï¼šè®¢é˜… license.status ä¸»é¢˜
  â””â”€ å¤±è´¥ï¼šé»˜è®¤ç¤¾åŒºç‰ˆï¼ˆä¸è®¢é˜…ï¼‰
  â†“
ç­‰å¾…æ¥æ”¶ License çŠ¶æ€æ¶ˆæ¯
  â”œâ”€ æ”¶åˆ° status æ¶ˆæ¯ï¼šæ›´æ–°æœ¬åœ° License çŠ¶æ€
  â”œâ”€ æ”¶åˆ° heartbeat æ¶ˆæ¯ï¼šæ›´æ–°å¿ƒè·³æ—¶é—´
  â””â”€ è¶…æ—¶æœªæ”¶åˆ°å¿ƒè·³ï¼šé™çº§åˆ°ç¤¾åŒºç‰ˆ
```

---

### 3. License çŠ¶æ€å˜æ›´

```
License æ–‡ä»¶æ›´æ–°
  â†“
License æœåŠ¡æ£€æµ‹åˆ°å˜æ›´
  â†“
é‡æ–°åŠ è½½ License
  â†“
éªŒè¯ License
  â†“
å‘å¸ƒæ›´æ–°æ¶ˆæ¯ï¼ˆupdateï¼‰
  â†“
æ‰€æœ‰è®¢é˜…è€…æ”¶åˆ°æ¶ˆæ¯
  â†“
æ›´æ–°æœ¬åœ° License çŠ¶æ€
```

---

## ğŸ¯ ä¼˜åŠ¿åˆ†æ

### âœ… ä¼˜åŠ¿

1. **é›†ä¸­ç®¡ç†**
   - License æœåŠ¡ç»Ÿä¸€ç®¡ç† License
   - æ‰€æœ‰å®ä¾‹é€šè¿‡ NATS è®¢é˜…ï¼Œæ— éœ€å„è‡ªè¯»å–æ–‡ä»¶

2. **å®æ—¶åŒæ­¥**
   - License çŠ¶æ€å˜æ›´å®æ—¶é€šçŸ¥æ‰€æœ‰å®ä¾‹
   - æ— éœ€é‡å¯æœåŠ¡

3. **å®¹é”™æœºåˆ¶**
   - å¦‚æœæ— æ³•è¿æ¥ License æœåŠ¡ï¼Œé»˜è®¤ç¤¾åŒºç‰ˆ
   - å¦‚æœæ”¶ä¸åˆ°å¿ƒè·³ï¼Œè‡ªåŠ¨é™çº§åˆ°ç¤¾åŒºç‰ˆ

4. **é€‚åˆé›†ç¾¤**
   - æ‰€æœ‰å®ä¾‹é€šè¿‡ NATS è¿æ¥ï¼Œå¤©ç„¶æ”¯æŒé›†ç¾¤
   - æ— éœ€å…±äº«å­˜å‚¨ï¼ˆLicense æ–‡ä»¶åªéœ€åœ¨ License æœåŠ¡ä¸Šï¼‰

5. **ç®€åŒ–å®ç°**
   - å„æœåŠ¡å®ä¾‹åªéœ€è®¢é˜… NATS ä¸»é¢˜
   - æ— éœ€å„è‡ªå®ç° License éªŒè¯é€»è¾‘

---

### âš ï¸ æ³¨æ„äº‹é¡¹

1. **License æœåŠ¡é«˜å¯ç”¨**
   - License æœåŠ¡æ˜¯å•ç‚¹ï¼Œéœ€è¦ä¿è¯é«˜å¯ç”¨
   - å»ºè®®ä½¿ç”¨è¿›ç¨‹ç®¡ç†å™¨ï¼ˆsystemdã€supervisorï¼‰æˆ–å®¹å™¨ç¼–æ’ï¼ˆK8sï¼‰

2. **NATS è¿æ¥å¤±è´¥**
   - å¦‚æœ NATS è¿æ¥å¤±è´¥ï¼Œæ‰€æœ‰å®ä¾‹é™çº§åˆ°ç¤¾åŒºç‰ˆ
   - éœ€è¦ç¡®ä¿ NATS æœåŠ¡çš„é«˜å¯ç”¨

3. **å¿ƒè·³è¶…æ—¶**
   - å¦‚æœæ”¶ä¸åˆ°å¿ƒè·³ï¼Œè‡ªåŠ¨é™çº§åˆ°ç¤¾åŒºç‰ˆ
   - å¿ƒè·³è¶…æ—¶æ—¶é—´éœ€è¦åˆç†è®¾ç½®ï¼ˆå»ºè®®60ç§’ï¼‰

---

## ğŸ“‹ å®æ–½ Checklist

### License æœåŠ¡

- [ ] åˆ›å»º `core/license-server` ç›®å½•ç»“æ„
- [ ] å®ç° License æœåŠ¡ï¼ˆè¯»å–ã€éªŒè¯ã€å¹¿æ’­ï¼‰
- [ ] å®ç° NATS å‘å¸ƒé€»è¾‘
- [ ] å®ç°å®šæœŸä»»åŠ¡ï¼ˆå¿ƒè·³ã€è¿‡æœŸæ£€æŸ¥ï¼‰
- [ ] åˆ›å»ºå¯åŠ¨è„šæœ¬æˆ– systemd æœåŠ¡

### License Client

- [ ] å®ç° License Clientï¼ˆè®¢é˜… NATS ä¸»é¢˜ï¼‰
- [ ] å®ç°æ¶ˆæ¯å¤„ç†é€»è¾‘
- [ ] å®ç°å¿ƒè·³æ£€æŸ¥æœºåˆ¶
- [ ] å®ç°å®¹é”™å¤„ç†ï¼ˆè¿æ¥å¤±è´¥ã€è¶…æ—¶ï¼‰

### å„æœåŠ¡é›†æˆ

- [ ] app-server é›†æˆ License Client
- [ ] agent-server é›†æˆ License Client
- [ ] app-runtime é›†æˆ License Client
- [ ] å…¶ä»–æœåŠ¡é›†æˆ License Client

---

## ğŸ¯ æ€»ç»“

### æ ¸å¿ƒè®¾è®¡

1. **ç‹¬ç«‹çš„ License æœåŠ¡**ï¼šç»Ÿä¸€ç®¡ç† License
2. **NATS å¹¿æ’­æœºåˆ¶**ï¼šæ‰€æœ‰å®ä¾‹é€šè¿‡ NATS è®¢é˜… License çŠ¶æ€
3. **é»˜è®¤ç¤¾åŒºç‰ˆ**ï¼šå¦‚æœæ— æ³•è¿æ¥ License æœåŠ¡ï¼Œè§†ä¸ºç¤¾åŒºç‰ˆ
4. **å®æ—¶åŒæ­¥**ï¼šLicense çŠ¶æ€å˜æ›´å®æ—¶é€šçŸ¥æ‰€æœ‰å®ä¾‹

### å…³é”®ä¼˜åŠ¿

- âœ… **é›†ä¸­ç®¡ç†**ï¼šLicense æœåŠ¡ç»Ÿä¸€ç®¡ç† License
- âœ… **å®æ—¶åŒæ­¥**ï¼šLicense çŠ¶æ€å˜æ›´å®æ—¶é€šçŸ¥æ‰€æœ‰å®ä¾‹
- âœ… **å®¹é”™æœºåˆ¶**ï¼šè¿æ¥å¤±è´¥æˆ–è¶…æ—¶è‡ªåŠ¨é™çº§åˆ°ç¤¾åŒºç‰ˆ
- âœ… **é€‚åˆé›†ç¾¤**ï¼šæ‰€æœ‰å®ä¾‹é€šè¿‡ NATS è¿æ¥ï¼Œå¤©ç„¶æ”¯æŒé›†ç¾¤
- âœ… **ç®€åŒ–å®ç°**ï¼šå„æœåŠ¡å®ä¾‹åªéœ€è®¢é˜… NATS ä¸»é¢˜

---

## ğŸ“ å‚è€ƒ

- [ä¼ä¸šéƒ¨ç½²è®¾è®¡æ–¹æ¡ˆ](./ENTERPRISE_DEPLOYMENT_DESIGN.md)
- [è®¾è®¡æ–¹æ¡ˆæ€»ç»“](./DESIGN_SUMMARY.md)
