# License æ¿€æ´»æµç¨‹ï¼ˆå½“å‰å®ç°ï¼‰

## ğŸ“‹ æ•´ä½“æµç¨‹æ¦‚è§ˆ

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  è½¯ä»¶æä¾›å•†ï¼ˆä½ ï¼‰                                        â”‚
â”‚                                                         â”‚
â”‚  1. ç”Ÿæˆå¯†é’¥å¯¹ï¼ˆä¸€æ¬¡æ€§ï¼‰                                â”‚
â”‚  2. å…¬é’¥åµŒå…¥ä»£ç                                         â”‚
â”‚  3. ç¼–è¯‘ç¨‹åº                                            â”‚
â”‚  4. ä¸ºå®¢æˆ·ç”Ÿæˆ Licenseï¼ˆç”¨ç§é’¥ç­¾åï¼‰                    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                    â”‚
                    â”‚ åˆ†å‘ç¨‹åºå’Œ License
                    â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  å®¢æˆ·ç¯å¢ƒ                                               â”‚
â”‚                                                         â”‚
â”‚  1. éƒ¨ç½²ç¨‹åºï¼ˆå·²åŒ…å«å…¬é’¥ï¼‰                              â”‚
â”‚  2. æ”¾ç½® License æ–‡ä»¶                                   â”‚
â”‚  3. å¯åŠ¨ç¨‹åº                                            â”‚
â”‚  4. ç¨‹åºè‡ªåŠ¨éªŒè¯å¹¶æ¿€æ´»                                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ”§ è¯¦ç»†æ­¥éª¤

### é˜¶æ®µä¸€ï¼šè½¯ä»¶æä¾›å•†å‡†å¤‡ï¼ˆä¸€æ¬¡æ€§ï¼‰

#### æ­¥éª¤ 1ï¼šç”Ÿæˆå¯†é’¥å¯¹

```bash
cd tools/license
bash gen_keypair.sh
```

**ç”Ÿæˆçš„æ–‡ä»¶ï¼š**
- `keys/private_key.pem` - **ç§é’¥**ï¼ˆä¿å¯†ï¼Œç”¨äºç­¾å Licenseï¼‰
- `keys/public_key.pem` - **å…¬é’¥**ï¼ˆå·²åµŒå…¥ä»£ç ï¼Œæ— éœ€å•ç‹¬éƒ¨ç½²ï¼‰

**é‡è¦æç¤ºï¼š**
- âš ï¸ ç§é’¥å¿…é¡»ä¸¥æ ¼ä¿å¯†ï¼Œä¸è¦æäº¤åˆ°ä»£ç ä»“åº“
- âœ… å…¬é’¥å¯ä»¥å…¬å¼€ï¼Œå·²åµŒå…¥ä»£ç ä¸­

---

#### æ­¥éª¤ 2ï¼šå…¬é’¥åµŒå…¥ä»£ç 

**ä½ç½®ï¼š** `pkg/license/manager.go`

å…¬é’¥å·²ç»ç›´æ¥åµŒå…¥åˆ°ä»£ç ä¸­çš„ `embeddedPublicKey` å˜é‡ï¼š

```go
var embeddedPublicKey = `-----BEGIN PUBLIC KEY-----
MIIBIjANBgkqhkiG9w0BAQEFAAOCAQ8AMIIBCgKCAQEA...
-----END PUBLIC KEY-----`
```

**è¯´æ˜ï¼š**
- ç¼–è¯‘ç¨‹åºæ—¶ï¼Œå…¬é’¥ä¼šè‡ªåŠ¨åŒ…å«åœ¨äºŒè¿›åˆ¶æ–‡ä»¶ä¸­
- ç¨‹åºå¯åŠ¨æ—¶ä¼šè‡ªåŠ¨åŠ è½½åµŒå…¥çš„å…¬é’¥
- æ— éœ€å•ç‹¬éƒ¨ç½²å…¬é’¥æ–‡ä»¶

---

#### æ­¥éª¤ 3ï¼šç¼–è¯‘ç¨‹åº

```bash
# ç¼–è¯‘å„ä¸ªæœåŠ¡
go build -o app-server ./core/app-server/cmd/app
go build -o agent-server ./core/agent-server/cmd/app
go build -o control-service ./core/control-service/cmd/app
```

**ç»“æœï¼š**
- æ‰€æœ‰æœåŠ¡éƒ½åŒ…å«åµŒå…¥çš„å…¬é’¥
- å¯ä»¥éªŒè¯ License ç­¾å

---

### é˜¶æ®µäºŒï¼šä¸ºå®¢æˆ·ç”Ÿæˆ License

#### æ­¥éª¤ 4ï¼šå‡†å¤‡é…ç½®æ–‡ä»¶

```bash
cd tools/license
cp license_config.example.json customer_license_config.json
```

**ç¼–è¾‘é…ç½®æ–‡ä»¶ï¼š**

```json
{
  "license": {
    "id": "license-enterprise-001",
    "edition": "enterprise",
    "customer": "å®¢æˆ·å…¬å¸åç§°",
    "expires_at": "2026-12-31 23:59:59",
    "max_apps": 100,
    "max_users": 50,
    "hardware_id": ""
  },
  "output": "license.json"
}
```

**é…ç½®è¯´æ˜ï¼š**
- `id`: License å”¯ä¸€æ ‡è¯†
- `edition`: ç‰ˆæœ¬ï¼ˆprofessional, enterprise, flagshipï¼‰
- `customer`: å®¢æˆ·åç§°
- `expires_at`: æˆªæ­¢æ—¥æœŸï¼ˆæ¨èä½¿ç”¨ `time.DateTime` æ ¼å¼ï¼š`2006-01-02 15:04:05`ï¼‰
- `expires_days`: æœ‰æ•ˆæœŸå¤©æ•°ï¼ˆä»…åœ¨ `expires_at` ä¸ºç©ºæ—¶ä½¿ç”¨ï¼‰
- `max_apps`: æœ€å¤§åº”ç”¨æ•°é‡ï¼ˆ0 è¡¨ç¤ºæ— é™åˆ¶ï¼‰
- `max_users`: æœ€å¤§ç”¨æˆ·æ•°é‡ï¼ˆ0 è¡¨ç¤ºæ— é™åˆ¶ï¼‰
- `hardware_id`: ç¡¬ä»¶ç»‘å®šIDï¼ˆå¯é€‰ï¼‰

---

#### æ­¥éª¤ 5ï¼šç”Ÿæˆ License æ–‡ä»¶

```bash
cd tools/license
go build -o sign_license sign_license.go

./sign_license \
  -config customer_license_config.json \
  -private-key keys/private_key.pem
```

**ç”Ÿæˆçš„æ–‡ä»¶ï¼š**
- `license.json` - åŒ…å« License æ•°æ®å’Œ RSA ç­¾åçš„æ–‡ä»¶

**License æ–‡ä»¶æ ¼å¼ï¼š**

```json
{
  "license": {
    "id": "license-enterprise-001",
    "edition": "enterprise",
    "issued_at": "2025-12-13T00:00:00Z",
    "expires_at": "2026-12-31T23:59:59Z",
    "customer": "å®¢æˆ·å…¬å¸åç§°",
    "max_apps": 100,
    "max_users": 50,
    "features": {
      "operate_log": true
    }
  },
  "signature": "RSAç­¾åï¼ˆBase64ç¼–ç ï¼‰"
}
```

**ç­¾åè¿‡ç¨‹ï¼š**
1. å°† License æ•°æ®åºåˆ—åŒ–ä¸º JSON
2. è®¡ç®— SHA-256 å“ˆå¸Œ
3. ä½¿ç”¨ç§é’¥å¯¹å“ˆå¸Œè¿›è¡Œ RSA ç­¾å
4. å°†ç­¾å Base64 ç¼–ç åæ·»åŠ åˆ° License æ–‡ä»¶

---

### é˜¶æ®µä¸‰ï¼šå®¢æˆ·éƒ¨ç½²å’Œæ¿€æ´»

#### æ­¥éª¤ 6ï¼šéƒ¨ç½² License æ–‡ä»¶

å°†ç”Ÿæˆçš„ `license.json` æ–‡ä»¶éƒ¨ç½²åˆ°å®¢æˆ·ç¯å¢ƒï¼Œæ”¾åœ¨ä»¥ä¸‹ä»»ä¸€ä½ç½®ï¼š

**ä¼˜å…ˆçº§é¡ºåºï¼š**
1. ç¯å¢ƒå˜é‡ `LICENSE_PATH` æŒ‡å®šçš„è·¯å¾„
2. `./license.json`ï¼ˆå½“å‰å·¥ä½œç›®å½•ï¼‰
3. `~/.ai-agent-os/license.json`ï¼ˆç”¨æˆ·ç›®å½•ï¼‰

**ç¤ºä¾‹ï¼š**

```bash
# æ–¹å¼ä¸€ï¼šæ”¾åœ¨å½“å‰ç›®å½•
cp license.json /path/to/app-server/

# æ–¹å¼äºŒï¼šæ”¾åœ¨ç”¨æˆ·ç›®å½•
mkdir -p ~/.ai-agent-os
cp license.json ~/.ai-agent-os/

# æ–¹å¼ä¸‰ï¼šä½¿ç”¨ç¯å¢ƒå˜é‡
export LICENSE_PATH=/path/to/license.json
```

---

#### æ­¥éª¤ 7ï¼šå¯åŠ¨ç¨‹åºï¼ˆè‡ªåŠ¨æ¿€æ´»ï¼‰

```bash
# å¯åŠ¨æœåŠ¡
./app-server
./agent-server
```

**ç¨‹åºè‡ªåŠ¨æ‰§è¡Œï¼š**

1. **åŠ è½½ License æ–‡ä»¶**
   ```go
   manager := license.GetManager()
   err := manager.LoadLicense("")
   ```

2. **éªŒè¯ç­¾å**
   - è¯»å–åµŒå…¥çš„å…¬é’¥
   - è§£æ License æ–‡ä»¶
   - è®¡ç®— License æ•°æ®çš„ SHA-256 å“ˆå¸Œ
   - ä½¿ç”¨å…¬é’¥éªŒè¯ç­¾å
   - å¦‚æœç­¾åæ— æ•ˆ â†’ è¿”å›é”™è¯¯

3. **æ£€æŸ¥æœ‰æ•ˆæ€§**
   - æ£€æŸ¥æ˜¯å¦è¿‡æœŸï¼ˆ`expires_at`ï¼‰
   - æ£€æŸ¥ç¡¬ä»¶ç»‘å®šï¼ˆå¦‚æœå¯ç”¨ï¼‰
   - å¦‚æœæ— æ•ˆ â†’ è¿”å›é”™è¯¯

4. **æ¿€æ´»ä¼ä¸šç‰ˆ**
   - å¦‚æœéªŒè¯é€šè¿‡ â†’ è®¾ç½® License çŠ¶æ€
   - æ¿€æ´»ä¼ä¸šç‰ˆåŠŸèƒ½ï¼ˆå¦‚ `operate_log`ï¼‰
   - åº”ç”¨èµ„æºé™åˆ¶ï¼ˆ`max_apps`, `max_users`ï¼‰

5. **æ—¥å¿—è¾“å‡º**
   ```
   [License] License loaded successfully: Edition=enterprise, Customer=å®¢æˆ·å…¬å¸åç§°, ExpiresAt=2026-12-31 23:59:59
   ```

---

## ğŸ” å®‰å…¨æœºåˆ¶

### 1. RSA ç­¾åéªŒè¯

**åŸç†ï¼š**
- **ç§é’¥**ï¼šåªæœ‰è½¯ä»¶æä¾›å•†æœ‰ï¼Œç”¨äºç­¾å License
- **å…¬é’¥**ï¼šåµŒå…¥åœ¨ç¨‹åºä¸­ï¼Œç”¨äºéªŒè¯ç­¾å
- **ç­¾å**ï¼šLicense æ•°æ®çš„ SHA-256 å“ˆå¸Œ + RSA ç§é’¥ç­¾å
- **éªŒè¯**ï¼šä½¿ç”¨å…¬é’¥éªŒè¯ç­¾åï¼Œç¡®ä¿ License æœªè¢«ç¯¡æ”¹

**å®‰å…¨æ€§ï¼š**
- âœ… æ— æ³•ä¼ªé€ ï¼šæ²¡æœ‰ç§é’¥ï¼Œæ— æ³•ç”Ÿæˆæœ‰æ•ˆç­¾å
- âœ… é˜²ç¯¡æ”¹ï¼šä»»ä½•ä¿®æ”¹éƒ½ä¼šå¯¼è‡´ç­¾åéªŒè¯å¤±è´¥
- âœ… å…¬é’¥å…¬å¼€ï¼šå…¬é’¥å¯ä»¥å®‰å…¨åœ°ç¼–è¯‘åˆ°ç¨‹åºä¸­

---

### 2. è¿‡æœŸæ£€æŸ¥

**æœºåˆ¶ï¼š**
- License åŒ…å« `expires_at` å­—æ®µ
- ç¨‹åºå¯åŠ¨æ—¶æ£€æŸ¥å½“å‰æ—¶é—´æ˜¯å¦è¶…è¿‡è¿‡æœŸæ—¶é—´
- å¦‚æœè¿‡æœŸ â†’ è‡ªåŠ¨é™çº§ä¸ºç¤¾åŒºç‰ˆ

---

### 3. ç¡¬ä»¶ç»‘å®šï¼ˆå¯é€‰ï¼‰

**æœºåˆ¶ï¼š**
- License å¯ä»¥åŒ…å« `hardware_id` å­—æ®µ
- ç¨‹åºå¯åŠ¨æ—¶æ£€æŸ¥å½“å‰ç¡¬ä»¶IDæ˜¯å¦åŒ¹é…
- å¦‚æœä¸åŒ¹é… â†’ è¿”å›é”™è¯¯

**æ³¨æ„ï¼š** å½“å‰å®ç°ä¸­ï¼Œç¡¬ä»¶ç»‘å®šåŠŸèƒ½å·²ç®€åŒ–ï¼ˆé›†ç¾¤éƒ¨ç½²åœºæ™¯ï¼‰ã€‚

---

## ğŸ“Š æ¿€æ´»çŠ¶æ€æ£€æŸ¥

### ç¨‹åºä¸­çš„ä½¿ç”¨

```go
// è·å– License ç®¡ç†å™¨
manager := license.GetManager()

// æ£€æŸ¥æ˜¯å¦æ˜¯ä¼ä¸šç‰ˆ
if manager.IsEnterprise() {
    // ä¼ä¸šç‰ˆåŠŸèƒ½
}

// æ£€æŸ¥æ˜¯å¦æœ‰æŸä¸ªåŠŸèƒ½
if manager.HasFeature("operate_log") {
    // æ“ä½œæ—¥å¿—åŠŸèƒ½
}

// æ£€æŸ¥èµ„æºé™åˆ¶
if err := manager.CheckAppLimit(currentAppCount); err != nil {
    // è¶…è¿‡é™åˆ¶
}
```

---

## ğŸ¯ å®Œæ•´ç¤ºä¾‹

### è½¯ä»¶æä¾›å•†æ“ä½œ

```bash
# 1. ç”Ÿæˆå¯†é’¥å¯¹ï¼ˆä»…éœ€ä¸€æ¬¡ï¼‰
cd tools/license
bash gen_keypair.sh

# 2. å…¬é’¥å·²åµŒå…¥ä»£ç ï¼ˆæ— éœ€æ“ä½œï¼‰

# 3. ç¼–è¯‘ç¨‹åº
go build -o app-server ./core/app-server/cmd/app

# 4. ä¸ºå®¢æˆ·ç”Ÿæˆ License
cp license_config.example.json customer_abc.json
# ç¼–è¾‘ customer_abc.jsonï¼Œå¡«å†™å®¢æˆ·ä¿¡æ¯

go build -o sign_license sign_license.go
./sign_license -config customer_abc.json -private-key keys/private_key.pem

# 5. å°† license.json å‘é€ç»™å®¢æˆ·
```

---

### å®¢æˆ·æ“ä½œ

```bash
# 1. éƒ¨ç½²ç¨‹åºï¼ˆå·²åŒ…å«å…¬é’¥ï¼‰
# æ— éœ€é¢å¤–æ“ä½œ

# 2. æ”¾ç½® License æ–‡ä»¶
cp license.json /path/to/app-server/

# 3. å¯åŠ¨ç¨‹åº
cd /path/to/app-server
./app-server

# 4. æŸ¥çœ‹æ—¥å¿—ç¡®è®¤æ¿€æ´»
# åº”è¯¥çœ‹åˆ°ï¼šLicense loaded successfully
```

---

## âš ï¸ æ³¨æ„äº‹é¡¹

### 1. ç§é’¥å®‰å…¨

- âŒ **ä¸è¦**æäº¤ç§é’¥åˆ°ä»£ç ä»“åº“
- âŒ **ä¸è¦**å°†ç§é’¥æ”¾åœ¨é…ç½®æ–‡ä»¶ä¸­
- âœ… **åº”è¯¥**å°†ç§é’¥å­˜å‚¨åœ¨å®‰å…¨çš„å¯†é’¥ç®¡ç†ç³»ç»Ÿä¸­
- âœ… **åº”è¯¥**å®šæœŸå¤‡ä»½ç§é’¥åˆ°å®‰å…¨çš„åœ°æ–¹

### 2. License æ–‡ä»¶

- âœ… License æ–‡ä»¶å¯ä»¥å®‰å…¨åœ°å‘é€ç»™å®¢æˆ·ï¼ˆåŒ…å«ç­¾åï¼Œæ— æ³•ç¯¡æ”¹ï¼‰
- âœ… å®¢æˆ·å¯ä»¥è‡ªç”±éƒ¨ç½² License æ–‡ä»¶
- âŒ å®¢æˆ·æ— æ³•ä¿®æ”¹ License å†…å®¹ï¼ˆç­¾åéªŒè¯ä¼šå¤±è´¥ï¼‰

### 3. å¯†é’¥è½®æ¢

å¦‚æœéœ€è¦æ›´æ¢å¯†é’¥å¯¹ï¼š

1. ç”Ÿæˆæ–°çš„å¯†é’¥å¯¹
2. æ›´æ–°ä»£ç ä¸­çš„å…¬é’¥
3. é‡æ–°ç¼–è¯‘ç¨‹åº
4. ä½¿ç”¨æ–°ç§é’¥ä¸ºæ‰€æœ‰å®¢æˆ·é‡æ–°ç”Ÿæˆ License

---

## ğŸ”„ å½“å‰å®ç°ç‰¹ç‚¹

### âœ… å·²å®ç°

1. **å…¬é’¥åµŒå…¥ä»£ç ** - ç®€åŒ–éƒ¨ç½²ï¼Œæ— éœ€å•ç‹¬å…¬é’¥æ–‡ä»¶
2. **JSON é…ç½®æ–‡ä»¶** - æ–¹ä¾¿ç”Ÿæˆ Licenseï¼Œæ”¯æŒ `expires_at` å’Œ `expires_days`
3. **è‡ªåŠ¨éªŒè¯** - ç¨‹åºå¯åŠ¨æ—¶è‡ªåŠ¨åŠ è½½å’ŒéªŒè¯ License
4. **ç­¾åéªŒè¯** - RSA ç­¾åç¡®ä¿ License æœªè¢«ç¯¡æ”¹
5. **è¿‡æœŸæ£€æŸ¥** - è‡ªåŠ¨æ£€æŸ¥ License æ˜¯å¦è¿‡æœŸ
6. **åŠŸèƒ½å¼€å…³** - æ”¯æŒæŒ‰åŠŸèƒ½å¯ç”¨/ç¦ç”¨ï¼ˆå½“å‰åªæœ‰ `operate_log`ï¼‰

### ğŸš§ å¯é€‰åŠŸèƒ½ï¼ˆå½“å‰æœªå¯ç”¨ï¼‰

1. **ç¡¬ä»¶ç»‘å®š** - ä»£ç å·²æ”¯æŒï¼Œä½†å½“å‰å®ç°ä¸ºå ä½ç¬¦
2. **åœ¨çº¿éªŒè¯** - å·²ç§»é™¤ï¼Œç®€åŒ–å®ç°
3. **Control Service åˆ†å‘** - å·²è®¾è®¡ï¼Œä½†å½“å‰ä½¿ç”¨æœ¬åœ°æ–‡ä»¶æ–¹å¼

---

## ğŸ“ æ€»ç»“

### æ ¸å¿ƒæµç¨‹

1. **ç”Ÿæˆå¯†é’¥å¯¹**ï¼ˆä¸€æ¬¡æ€§ï¼‰
2. **å…¬é’¥åµŒå…¥ä»£ç **ï¼ˆç¼–è¯‘æ—¶ï¼‰
3. **ç”Ÿæˆ License**ï¼ˆç”¨ç§é’¥ç­¾åï¼‰
4. **éƒ¨ç½² License**ï¼ˆå®¢æˆ·ç¯å¢ƒï¼‰
5. **è‡ªåŠ¨æ¿€æ´»**ï¼ˆç¨‹åºå¯åŠ¨æ—¶éªŒè¯ï¼‰

### å…³é”®ç‚¹

- âœ… **ç®€å•**ï¼šå®¢æˆ·åªéœ€æ”¾ç½® License æ–‡ä»¶
- âœ… **å®‰å…¨**ï¼šRSA ç­¾åé˜²æ­¢ä¼ªé€ å’Œç¯¡æ”¹
- âœ… **è‡ªåŠ¨**ï¼šæ— éœ€æ‰‹åŠ¨æ¿€æ´»æ“ä½œ
- âœ… **çµæ´»**ï¼šæ”¯æŒè¿‡æœŸæ—¶é—´ã€èµ„æºé™åˆ¶ã€åŠŸèƒ½å¼€å…³

---

## ğŸ“š ç›¸å…³æ–‡æ¡£

- [æ¿€æ´»æŒ‡å—](./ACTIVATION_GUIDE.md) - è¯¦ç»†çš„æ¦‚å¿µè¯´æ˜å’Œæœ€ä½³å®è·µ
- [å®ç°æ€»ç»“](./ACTIVATION_IMPLEMENTATION.md) - æŠ€æœ¯å®ç°ç»†èŠ‚
- [å·¥å…·ä½¿ç”¨](./tools/license/README.md) - License å·¥å…·ä½¿ç”¨è¯´æ˜



